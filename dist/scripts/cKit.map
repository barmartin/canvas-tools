{"version":3,"file":"cKit.js","sources":["../../build/scripts/cKit.js"],"names":["constants","PI","Math","SCENE_NORMAL","SCENE_GIF","EDIT_SHAPE","EDIT_TRANSFORM","EDIT_NONE","TWOPIDIV360","TWOPI","MAX_OBJECTS","DEFAULT_RAYS","DEFAULT_INNER_RADIUS_SCALAR","DEFAULT_OUTER_RADIUS_SCALAR","CONTROL_POINT_RADIUS","DEFAULT_LENGTH","BACKGROUND_COLOR","BACKGROUND_ALPHA","LINE_COLOR","BODY_BACKGROUND_COLOR","MAX_CLICK_DISTANCE","SOURCE_MODES","lighter","darker","xor","source-atop","source-out","source-over","destination-atop","destination-out","util","require","getPosition","e","canvas","rect","getBoundingClientRect","x","clientX","left","y","clientY","top","clone","obj","copy","constructor","attr","hasOwnProperty","dnexist","item","exists","encodeToHex","floatString","parseInt","toString","decodeFromHex","str","parseIntOrDefault","i","def","Number","isInteger","parseFloatOrDefault","f","parseFloat","isNaN","degreesToRadians","angle","toRGB","this","substring","msTime","Date","getTime","each","func","length","keys","window","kit","_u","getKeys","key","push","range","st","end","r","indexOf","console","log","removeArrayEntry","arr","index","splice","debugConsole","document","getElementById","Vector","create","multiply","vector","scaleFactor","add","vector1","vector2","getPoint","centerX","centerY","radius","thisX","sin","thisY","cos","nP","getPolarPoint","center","rotate","point","thisAngle","cosTheta","sinTheta","xNew","yNew","distance","pointA","pointB","xDist","yDist","sqrt","getRadians","xDelta","yDelta","rads","atan2","getDegrees","degrees","zeroVector","reflectMatrix","theta","CPoint","parentObject","inDrag","draw","realPoint","editMode","rotation","anchorPoint","points","shapePoints","transformPoints","context","beginPath","moveTo","lineTo","stroke","arc","controlPointRadius","closePath","lineWidth","fillStyle","fill","mouseInside","scale","Transform","position","prototype","getMatrix","PetalFlower","u","petals","radialAccent","innerRadius","outerRadius","petalCount","allPetals","firstPetal","increment","firstInnerAngle","scaleDistance","midWidth","lastScale","cp","cp2","cp3","cp4","secondCPRadius","rotatePoint","midHeight","createPetals","flower","Petal","bezierCurveTo","rotated","fillImageExists","globalCompositeOperation","sourceMode","clip","fillImage","toggleCurveColor","newPetal","thisPoint","updatePetal","newPoint","newCoords","updateTransform","transform","translateTranform","reverseTransformPoint","actual","setScale","xPosition","resetScalePoint","updateFirstPetal","setControlPoint","updateRadialPoint","keyFrames","keyFrame","selectedObject","newPosition","accentRadialPoint","drawShapePoints","save","controlPoint","restore","drawTransformPoints","getState","cps","setState","state","redraw","core","initialized","updateMode","animationMode","segmentStartTime","segment","loopStartTime","setTime","pauseTime","frameDelay","gifFramerate","delta","sceneMode","encoder","delayTime","initList","pattern","bodybg","backgroundColor","lineColor","backgroundAlpha","canvasWidth","canvasHeight","maxRadius","seamlessAnimation","fieldFocus","settingShelf","objList","objTypes","resourceList","backgroundImageExists","debugMode","initializeCanvas","getContext","bindEvents","build","dataz","getSampleJSON","loadData","digest","initFrame","setTransform","clearRect","width","height","strokeStyle","drawImage","backgroundImage","rgb","fillRect","FillImage","src","page","label","image","Image","onload","object","sweepFrom","sweepTo","temp_canvas","createElement","tempContext","reflectionMatrix","translate","matrix","getRotationMatrix","canvasEvents","addEventListener","startDrag","endDrag","move","event","actualPosition","canvasMode","positionInsideObject","angleVector","setRotation","newX","constrain","sceneEvents","sceneLoop","stopScene","lastStartTime","timing","GIF","gifComplete","updateSegment","addFrame","setTimeout","processTime","max","keyTo","sig","objIndex","ob","newCps","obFrom","newY","newState","fromRotation","toRotation","del","abs","segmentLoop","ind","storeFrame","clearScene","removeKeyframe","removeLast","gifInit","setRepeat","setDelay","setSize","start","loopInit","finish","binary_gif","stream","getData","data_url","encode64","open","setTempModes","restoreModes","sceneReset","selectFirst","selectPrev","selectNext","selectLast","objectEvents","value","getRotation","rotationDegrees","floor","val","addFillImage","fillImageSource","addBackgroundImage","backgroundImageSource","updatePetalCount","updateRadialAccent","radialScalar","thisObject","selectObject","addObject","removeObject","getImage","toDataURL","settingsEvents","getSettings","data","options","currentSelector","setColor","SOURCE_MODE","src_app","_globalInit","initKeyboard","GIFEncoder","initInterface","readyState"],"mappings":"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","sourcesContent":["/*! cKit.js v0.0.0 November 23, 2014 */\nvar constants = function (require) {\n    var PI = Math.PI;\n    return {\n      SCENE_NORMAL: 0,\n      SCENE_GIF: 1,\n      EDIT_SHAPE: 0,\n      EDIT_TRANSFORM: 1,\n      EDIT_NONE: 2,\n      PI: PI,\n      TWOPIDIV360: 2 * Math.PI / 360,\n      TWOPI: 2 * Math.PI,\n      MAX_OBJECTS: 4,\n      DEFAULT_RAYS: 6,\n      DEFAULT_INNER_RADIUS_SCALAR: 17,\n      DEFAULT_OUTER_RADIUS_SCALAR: 2.2,\n      CONTROL_POINT_RADIUS: 6,\n      DEFAULT_LENGTH: 1.5,\n      BACKGROUND_COLOR: '010201',\n      BACKGROUND_ALPHA: '1',\n      LINE_COLOR: '9fb4f4',\n      BODY_BACKGROUND_COLOR: '020202',\n      MAX_CLICK_DISTANCE: 2,\n      SOURCE_MODES: {\n        'lighter': 'lighter',\n        'darker': 'darker',\n        'xor': 'xor',\n        'source-atop': 'atop',\n        'source-out': 'out',\n        'source-over': 'over',\n        'destination-atop': 'bottom',\n        'destination-out': 'bottom-out'\n      }\n    };\n  }({});\nvar util = function (require, constants) {\n    \n    var constants = constants;\n    return {\n      getPosition: function (e, canvas) {\n        var rect = canvas.getBoundingClientRect();\n        return {\n          x: e.clientX - rect.left,\n          y: e.clientY - rect.top\n        };\n      },\n      clone: function (obj) {\n        if (obj == null || 'object' !== typeof obj) {\n          return obj;\n        }\n        var copy = obj.constructor();\n        for (var attr in obj) {\n          if (obj.hasOwnProperty(attr)) {\n            copy[attr] = obj[attr];\n          }\n        }\n        return copy;\n      },\n      dnexist: function (item) {\n        return typeof item === 'undefined';\n      },\n      exists: function (item) {\n        return typeof item !== 'undefined';\n      },\n      encodeToHex: function (floatString) {\n        return parseInt(255 * floatString).toString(16);\n      },\n      decodeFromHex: function (str) {\n        return parseInt(str, 16);\n      },\n      parseIntOrDefault: function (i, def) {\n        i = parseInt(i);\n        if (Number.isInteger(i)) {\n          return i;\n        } else {\n          return def;\n        }\n      },\n      parseFloatOrDefault: function (f, def) {\n        f = parseFloat(f);\n        if (isNaN(f)) {\n          return def;\n        } else {\n          return f;\n        }\n      },\n      degreesToRadians: function (angle) {\n        return constants.TWOPIDIV360 * angle;\n      },\n      toRGB: function (str) {\n        return [\n          this.decodeFromHex(str.substring(0, 2)),\n          this.decodeFromHex(str.substring(2, 4)),\n          this.decodeFromHex(str.substring(4, 6))\n        ];\n      },\n      msTime: function () {\n        return new Date().getTime();\n      },\n      each: function (obj, func) {\n        if (obj == null) {\n          return obj;\n        }\n        var i, length = obj.length;\n        if (length === +length) {\n          for (i = 0; i < length; i++) {\n            func(obj[i], i, obj);\n          }\n        } else {\n          var keys = window.kit._u.getKeys(obj);\n          for (i = 0, length = keys.length; i < length; i++) {\n            func(obj[keys[i]], keys[i], obj);\n          }\n        }\n        return obj;\n      },\n      getKeys: function (obj) {\n        var keys = [];\n        for (var key in obj) {\n          if (obj.hasOwnProperty(key)) {\n            keys.push(key);\n          }\n        }\n        return keys;\n      },\n      range: function (st, end) {\n        var r = [];\n        for (var i = st; i < end; i++) {\n          r.push(i);\n        }\n        return r;\n      },\n      indexOf: function (obj, item) {\n        for (var i = 0; i < obj.length; i++) {\n          if (obj[i] === item) {\n            return i;\n          }\n        }\n        console.log('There is a bug with a call to indexOf');\n        return -1;\n      },\n      removeArrayEntry: function (arr, index) {\n        arr.splice(index, 1);\n      },\n      debugConsole: function (text) {\n        var HUD = document.getElementById('console');\n      }\n    };\n  }({}, constants);\nvar Vector = function (require, constants) {\n    \n    var constants = constants;\n    return {\n      create: function (x, y) {\n        return {\n          'x': x,\n          'y': y\n        };\n      },\n      multiply: function (vector, scaleFactor) {\n        vector.x *= scaleFactor;\n        vector.y *= scaleFactor;\n        return vector;\n      },\n      add: function (vector1, vector2) {\n        vector1.x += vector2.x;\n        vector1.y += vector2.y;\n        return vector1;\n      },\n      getPoint: function (centerX, centerY, radius, angle) {\n        var thisX = centerX + radius * Math.sin(angle);\n        var thisY = centerY - radius * Math.cos(angle);\n        var nP = this.create(thisX, thisY);\n        return nP;\n      },\n      getPolarPoint: function (center, radius, angle) {\n        var thisX = center.x + radius * Math.sin(angle);\n        var thisY = center.y - radius * Math.cos(angle);\n        var nP = this.create(thisX, thisY);\n        return nP;\n      },\n      rotate: function (centerX, centerY, point, thisAngle) {\n        var cosTheta = Math.cos(thisAngle);\n        var sinTheta = Math.sin(thisAngle);\n        var xNew = cosTheta * (point.x - centerX) - sinTheta * (point.y - centerY) + centerX;\n        var yNew = sinTheta * (point.x - centerX) + cosTheta * (point.y - centerY) + centerY;\n        return this.create(xNew, yNew);\n      },\n      distance: function (pointA, pointB) {\n        var xDist = pointA.x - pointB.x;\n        var yDist = pointA.y - pointB.y;\n        return Math.sqrt(xDist * xDist + yDist * yDist);\n      },\n      getRadians: function (center, point) {\n        var xDelta = point.x - center.x;\n        var yDelta = center.y - point.y;\n        var rads = Math.atan2(xDelta, yDelta);\n        if (rads < 0) {\n          rads += constants.TWOPI;\n        }\n        return rads;\n      },\n      getDegrees: function (center, point) {\n        var xDelta = point.x - center.x;\n        var yDelta = center.y - point.y;\n        var degrees = Math.atan2(xDelta, yDelta) * constants.TWOPIDIV360;\n        if (degrees < 0) {\n          degrees += 360;\n        }\n        return degrees;\n      },\n      zeroVector: function () {\n        return {\n          'x': 0,\n          'y': 0\n        };\n      },\n      reflectMatrix: function (theta) {\n        return [\n          Math.cos(2 * theta),\n          Math.sin(2 * theta),\n          Math.sin(2 * theta),\n          -Math.cos(2 * theta)\n        ];\n      }\n    };\n  }({}, constants);\nvar CPoint = function (require, constants, Vector) {\n    \n    var constants = constants;\n    var Vector = Vector;\n    var CPoint = function (kit, x, y, parentObject, index) {\n      this.kit = kit;\n      this.x = x;\n      this.y = y;\n      this.parentObject = parentObject;\n      this.index = index;\n      this.inDrag = false;\n      this.draw = function () {\n        var realPoint;\n        if (this.kit.editMode !== constants.EDIT_TRANSFORM || this.index !== 2) {\n          realPoint = Vector.rotate(0, 0, this, parentObject.rotation);\n        } else {\n          realPoint = this;\n        }\n        if (this.inDrag) {\n          var anchorPoint;\n          var points = parentObject.shapePoints;\n          if (this.kit.editMode === constants.EDIT_TRANSFORM) {\n            points = parentObject.transformPoints;\n          }\n          if (this.index === 1) {\n            anchorPoint = Vector.rotate(0, 0, points[0], parentObject.rotation);\n            this.kit.context.beginPath();\n            this.kit.context.moveTo(realPoint.x, realPoint.y);\n            this.kit.context.lineTo(anchorPoint.x, anchorPoint.y);\n            this.kit.context.stroke();\n          } else if (this.index === 2) {\n            if (this.kit.editMode === constants.EDIT_TRANSFORM) {\n              anchorPoint = points[0];\n            } else {\n              anchorPoint = Vector.rotate(0, 0, points[3], parentObject.rotation);\n            }\n            this.kit.context.beginPath();\n            this.kit.context.moveTo(realPoint.x, realPoint.y);\n            this.kit.context.lineTo(anchorPoint.x, anchorPoint.y);\n            this.kit.context.stroke();\n          }\n        }\n        this.kit.context.beginPath();\n        this.kit.context.arc(realPoint.x, realPoint.y, this.kit.controlPointRadius, 0, Math.PI * 2, true);\n        this.kit.context.closePath();\n        this.kit.context.lineWidth = 1;\n        if (this.inDrag) {\n          this.kit.context.fillStyle = '#999999';\n          this.kit.context.fill();\n        } else {\n          this.kit.context.fillStyle = '#FFFFFF';\n          this.kit.context.fill();\n        }\n        this.kit.context.stroke();\n      };\n      this.mouseInside = function (point) {\n        return this.kit.controlPointRadius + constants.MAX_CLICK_DISTANCE > Vector.distance(point, this) * this.parentObject.scale;\n      };\n    };\n    return CPoint;\n  }({}, constants, Vector);\nvar Transform = function (require) {\n    \n    var Transform = function (position, scale, rotation) {\n      this.position = position;\n      this.scale = scale;\n      this.rotation = rotation;\n    };\n    Transform.prototype.getMatrix = function () {\n      var cos = Math.cos(this.rotation);\n      var sin = Math.sin(this.rotation);\n      return [\n        this.scale * cos,\n        sin,\n        -sin,\n        this.scale * cos,\n        this.position.x,\n        this.position.y\n      ];\n    };\n    return Transform;\n  }({});\nvar PetalFlower = function (require, CPoint, Vector, Transform, util) {\n    \n    var CPoint = CPoint;\n    var Vector = Vector;\n    var Transform = Transform;\n    var u = util;\n    var PetalFlower = function (kit, petals, radialAccent, innerRadius, outerRadius, center) {\n      this.kit = kit;\n      this.petalCount = petals;\n      this.radialAccent = radialAccent;\n      this.allPetals = [];\n      this.firstPetal = [];\n      this.thisAngle = 0;\n      this.increment = 2 * Math.PI / petals;\n      this.firstInnerAngle = -0.5 * this.increment * radialAccent;\n      this.shapePoints = [];\n      this.transformPoints = [];\n      this.rotation = 0;\n      this.center = center;\n      this.scaleDistance = this.kit.midWidth / 2;\n      this.scale = 1;\n      this.lastScale = 1;\n      var cp, cp2, cp3, cp4;\n      cp = Vector.getPoint(0, 0, innerRadius, this.firstInnerAngle);\n      var secondCPRadius = (outerRadius - innerRadius) / 2 + innerRadius;\n      cp2 = Vector.getPoint(0, 0, secondCPRadius, this.firstInnerAngle);\n      cp3 = Vector.getPoint(0, 0, outerRadius, 0);\n      cp3.x = cp3.x - 40;\n      cp4 = Vector.getPoint(0, 0, outerRadius, 0);\n      this.firstPetal.push(cp);\n      this.shapePoints.push(new CPoint(kit, cp.x, cp.y, this, 0));\n      this.shapePoints.push(new CPoint(kit, cp2.x, cp2.y, this, 1));\n      this.firstPetal.push(cp2);\n      this.shapePoints.push(new CPoint(kit, cp3.x, cp3.y, this, 2));\n      this.firstPetal.push(cp3);\n      this.shapePoints.push(new CPoint(kit, cp4.x, cp4.y, this, 3));\n      this.firstPetal.push(cp4);\n      this.firstPetal.push(Vector.create(-cp3.x, cp3.y));\n      this.firstPetal.push(Vector.create(-cp2.x, cp2.y));\n      this.firstPetal.push(Vector.create(-cp.x, cp.y));\n      this.transformPoints.push(new CPoint(this.kit, 0, 0, this, 0));\n      var rotatePoint = Vector.create(0, -this.kit.midHeight / 2.5);\n      Vector.rotate(0, 0, rotatePoint, this.rotation);\n      this.transformPoints.push(new CPoint(this.kit, rotatePoint.x, rotatePoint.y, this, 1));\n      this.transformPoints.push(new CPoint(this.kit, this.scaleDistance, 0, this, 2));\n      this.createPetals();\n    };\n    PetalFlower.prototype.draw = function () {\n      var index = 0;\n      var flower = this;\n      var kit = this.kit;\n      kit.context.beginPath();\n      u.each(this.allPetals, function (Petal) {\n        if (flower.rotation === 0) {\n          kit.context.moveTo(Petal[0].x, Petal[0].y);\n          kit.context.bezierCurveTo(Petal[1].x, Petal[1].y, Petal[2].x, Petal[2].y, Petal[3].x, Petal[3].y);\n          kit.context.bezierCurveTo(Petal[4].x, Petal[4].y, Petal[5].x, Petal[5].y, Petal[6].x, Petal[6].y);\n          kit.context.moveTo(Petal[6].x, Petal[6].y);\n          kit.context.lineTo(Petal[0].x, Petal[0].y);\n        } else {\n          var rotated = [];\n          for (var i = 0; i < Petal.length; i++) {\n            rotated.push(Vector.rotate(0, 0, Petal[i], flower.rotation));\n          }\n          kit.context.moveTo(rotated[0].x, rotated[0].y);\n          kit.context.bezierCurveTo(rotated[1].x, rotated[1].y, rotated[2].x, rotated[2].y, rotated[3].x, rotated[3].y);\n          kit.context.bezierCurveTo(rotated[4].x, rotated[4].y, rotated[5].x, rotated[5].y, rotated[6].x, rotated[6].y);\n          kit.context.moveTo(rotated[6].x, rotated[6].y);\n          kit.context.lineTo(rotated[0].x, rotated[0].y);\n        }\n        index++;\n      });\n      kit.context.closePath();\n      if (kit.fillImageExists) {\n        kit.context.globalCompositeOperation = kit.sourceMode;\n        kit.context.clip();\n        kit.fillImage.draw(new Transform(this.center, this.scale, this.rotation), this);\n        if (kit.toggleCurveColor === true) {\n          kit.context.globalCompositeOperation = 'source-over';\n          kit.context.lineWidth = 1.9;\n          kit.context.stroke();\n        }\n      } else {\n        kit.context.globalCompositeOperation = 'source-over';\n        kit.context.stroke();\n      }\n    };\n    PetalFlower.prototype.createPetals = function () {\n      this.allPetals.push(this.firstPetal);\n      for (var i = 1; i < this.petalCount; i++) {\n        var newPetal = [];\n        var thisAngle = i * this.increment;\n        u.each(this.firstPetal, function (point) {\n          var thisPoint = Vector.rotate(0, 0, point, thisAngle);\n          newPetal.push(thisPoint);\n        });\n        this.allPetals.push(newPetal);\n      }\n    };\n    PetalFlower.prototype.updatePetal = function (index, newPoint) {\n      var newCoords = Vector.create(newPoint.x, newPoint.y);\n      if (index === 3) {\n        newCoords.x = 0;\n        this.firstPetal[3].x = 0;\n        this.firstPetal[index].y = newPoint.y;\n      } else if (index === 0) {\n        var innerRadius = Vector.distance(Vector.create(0, 0), Vector.create(newPoint.x, newPoint.y));\n        newCoords = Vector.getPoint(0, 0, innerRadius, this.firstInnerAngle);\n        this.firstPetal[0].x = newCoords.x;\n        this.firstPetal[0].y = newCoords.y;\n        this.firstPetal[6].x = -newCoords.x;\n        this.firstPetal[6].y = newCoords.y;\n      } else {\n        this.firstPetal[index].x = newPoint.x;\n        this.firstPetal[6 - index].x = -newPoint.x;\n        this.firstPetal[6 - index].y = newPoint.y;\n        this.firstPetal[index].y = newPoint.y;\n      }\n      this.allPetals = [];\n      this.createPetals();\n      this.shapePoints[index].x = newCoords.x;\n      this.shapePoints[index].y = newCoords.y;\n    };\n    PetalFlower.prototype.updateTransform = function (index, newPoint) {\n      var newCoords = Vector.create(newPoint.x, newPoint.y);\n      if (index === 1) {\n      }\n      this.transformPoints[index].x = newCoords.x;\n      this.transformPoints[index].y = newCoords.y;\n    };\n    PetalFlower.prototype.transform = function () {\n      this.kit.context.transform(this.scale, 0, 0, this.scale, this.center.x, this.center.y);\n    };\n    PetalFlower.prototype.translateTranform = function () {\n      this.kit.context.transform(1, 0, 0, 1, this.center.x, this.center.y);\n    };\n    PetalFlower.prototype.reverseTransformPoint = function (point) {\n      var actual = Vector.create(point.x - this.center.x, point.y - this.center.y);\n      actual.x /= this.scale;\n      actual.y /= this.scale;\n      actual = Vector.rotate(0, 0, actual, -this.rotation);\n      return actual;\n    };\n    PetalFlower.prototype.setScale = function (xPosition) {\n      this.scale = this.lastScale * xPosition / this.scaleDistance;\n    };\n    PetalFlower.prototype.resetScalePoint = function (xPosition) {\n      this.transformPoints[2].x = this.scaleDistance;\n    };\n    PetalFlower.prototype.updateFirstPetal = function () {\n      this.firstPetal[0].x = this.shapePoints[0].x;\n      this.firstPetal[0].y = this.shapePoints[0].y;\n      this.firstPetal[1].x = this.shapePoints[1].x;\n      this.firstPetal[1].y = this.shapePoints[1].y;\n      this.firstPetal[2].x = this.shapePoints[2].x;\n      this.firstPetal[2].y = this.shapePoints[2].y;\n      this.firstPetal[3].x = this.shapePoints[3].x;\n      this.firstPetal[3].y = this.shapePoints[3].y;\n      this.firstPetal[4].x = -this.shapePoints[2].x;\n      this.firstPetal[4].y = this.shapePoints[2].y;\n      this.firstPetal[5].x = -this.shapePoints[1].x;\n      this.firstPetal[5].y = this.shapePoints[1].y;\n      this.firstPetal[6].x = -this.shapePoints[0].x;\n      this.firstPetal[6].y = this.shapePoints[0].y;\n    };\n    PetalFlower.prototype.setControlPoint = function (point, newPoint) {\n      this.shapePoints[this.kit.indexOf(this.shapePoints, point)] = newPoint;\n    };\n    PetalFlower.prototype.updateRadialPoint = function () {\n      this.increment = 2 * Math.PI / this.petalCount;\n      this.firstInnerAngle = -0.5 * this.increment * this.radialAccent;\n      var kit = this.kit;\n      var flower = this;\n      u.each(kit.keyFrames, function (keyFrame) {\n        var point = keyFrame.obj[kit.selectedObject].shapePoints[0];\n        var radius = Vector.distance(Vector.zeroVector(), Vector.create(point.x, point.y));\n        var newPosition = Vector.getPolarPoint(Vector.zeroVector(), radius, flower.firstInnerAngle);\n        point.x = newPosition.x;\n        point.y = newPosition.y;\n      });\n    };\n    PetalFlower.prototype.accentRadialPoint = function (scale) {\n      this.radialAccent = scale;\n      this.increment = 2 * Math.PI / this.petalCount;\n      this.firstInnerAngle = -0.5 * this.increment * scale;\n      var kit = this.kit;\n      var flower = this;\n      u.each(kit.keyFrames, function (keyFrame) {\n        var point = keyFrame.obj[kit.selectedObject].shapePoints[0];\n        var radius = Vector.distance(Vector.zeroVector(), Vector.create(point.x, point.y));\n        var newPosition = Vector.getPolarPoint(Vector.zeroVector(), radius, flower.firstInnerAngle);\n        point.x = newPosition.x;\n        point.y = newPosition.y;\n      });\n    };\n    PetalFlower.prototype.drawShapePoints = function () {\n      this.kit.context.save();\n      this.kit.context.transform(1, 0, 0, 1, this.center.x, this.center.y);\n      var flower = this;\n      u.each(this.shapePoints, function (controlPoint) {\n        var newPoint = new CPoint(flower.kit, controlPoint.x * flower.scale, controlPoint.y * flower.scale, flower, controlPoint.index);\n        newPoint.draw();\n      });\n      this.kit.context.restore();\n    };\n    PetalFlower.prototype.drawTransformPoints = function () {\n      this.kit.context.save();\n      this.translateTranform();\n      this.transformPoints[0].draw();\n      this.transformPoints[1].draw();\n      this.transformPoints[2].draw();\n      this.kit.context.restore();\n    };\n    PetalFlower.prototype.getState = function () {\n      var cps = [];\n      u.each(this.shapePoints, function (point) {\n        cps.push(Vector.create(point.x, point.y));\n      });\n      return {\n        'shapePoints': cps,\n        'rotation': this.rotation,\n        'scale': this.scale,\n        'position': this.center\n      };\n    };\n    PetalFlower.prototype.setState = function (state) {\n      var kit = this.kit;\n      this.rotation = state.rotation;\n      this.center = state.position;\n      this.scale = state.scale;\n      kit.index = 0;\n      u.each(this.shapePoints, function (cp) {\n        cp.x = state.shapePoints[kit.index].x;\n        cp.y = state.shapePoints[kit.index].y;\n        kit.index++;\n      });\n      this.allPetals = [];\n      this.updateFirstPetal();\n      this.createPetals();\n      kit.redraw();\n    };\n    return PetalFlower;\n  }({}, CPoint, Vector, Transform, util);\nvar core = function (require, constants, util, PetalFlower, Vector) {\n    \n    var constants = constants;\n    var _u = util;\n    var PetalFlower = PetalFlower;\n    var Vector = Vector;\n    var kit = function () {\n      this.constants = constants;\n      this._u = _u;\n      this.initialized = false;\n      this.keyFrames = [];\n      this.updateMode = false;\n      this.animationMode = false;\n      this.segmentStartTime = 0;\n      this.segment = 0;\n      this.loopStartTime = 0;\n      this.setTime = 0;\n      this.pauseTime = 0;\n      this.frameDelay = 60;\n      this.gifFramerate = 200;\n      this.delta = -this.frameDelay;\n      this.sceneMode = constants.SCENE_NORMAL;\n      this.encoder = '';\n      this.delayTime = 0;\n      this.initList = ['flower'];\n      this.pattern = null;\n      this.bodybg = constants.BODY_BACKGROUND_COLOR;\n      this.backgroundColor = constants.BACKGROUND_COLOR;\n      this.lineColor = constants.LINE_COLOR;\n      this.backgroundAlpha = constants.BACKGROUND_ALPHA;\n      var key = this._u.getKeys(constants.SOURCE_MODES)[0];\n      this.sourceMode = constants.SOURCE_MODES[key];\n      this.canvasWidth = 500;\n      this.canvasHeight = 500;\n      this.midWidth = this.canvasWidth / 2;\n      this.midHeight = this.canvasHeight / 2;\n      this.maxRadius = Math.sqrt(this.midWidth * this.midWidth + this.midHeight * this.midHeight);\n      this.controlPointRadius = constants.CONTROL_POINT_RADIUS;\n      this.editMode = constants.EDIT_SHAPE;\n      this.toggleCurveColor = false;\n      this.seamlessAnimation = true;\n      this.fieldFocus = false;\n      this.settingShelf = {\n        'toggleCurveColor': this.toggleCurveColor,\n        'editMode': this.editMode\n      };\n      this.objList = [];\n      this.objTypes = [];\n      this.selectedObject = 0;\n      this.resourceList = {};\n      this.backgroundImageExists = false;\n      this.fillImageExists = false;\n      this.debugMode = true;\n      this.initializeCanvas = function () {\n        this.canvas = document.getElementById('canvas');\n        this.context = this.canvas.getContext('2d');\n        this.bindEvents();\n        this.build();\n        if (this.debugMode === true) {\n          var dataz = window.getSampleJSON();\n          this.loadData(dataz, false);\n        }\n        this.initialized = true;\n        this.redraw();\n      };\n    };\n    kit.prototype.digest = function () {\n    };\n    kit.prototype.build = function () {\n      var kit = this;\n      _u.each(_u.range(0, this.initList.length), function (i) {\n        if (kit.initList[i] === 'flower') {\n          kit.objList.push(new PetalFlower(kit, constants.DEFAULT_RAYS, 1, kit.canvasHeight / constants.DEFAULT_INNER_RADIUS_SCALAR, kit.canvasHeight / constants.DEFAULT_OUTER_RADIUS_SCALAR, Vector.create(kit.midWidth, kit.midHeight)));\n          kit.objTypes.push([\n            'flower',\n            constants.DEFAULT_RAYS,\n            1\n          ]);\n        }\n      });\n      this.initFrame();\n    };\n    kit.prototype.redraw = function () {\n      if (!this.initialized) {\n        return;\n      }\n      this.context.save();\n      this.context.setTransform(1, 0, 0, 1, 0, 0);\n      this.context.clearRect(0, 0, this.canvas.width, this.canvas.height);\n      this.context.restore();\n      this.context.strokeStyle = '#' + this.lineColor;\n      if (this.backgroundImageExists) {\n        this.context.drawImage(this.backgroundImage, 0, 0, this.canvasWidth, this.canvasHeight);\n      } else {\n        var rgb = _u.toRGB(this.backgroundColor);\n        this.context.fillStyle = 'rgba(' + rgb[0] + ', ' + rgb[1] + ', ' + rgb[2] + ', ' + this.backgroundAlpha + ')';\n        this.context.fillRect(0, 0, this.canvasWidth, this.canvasHeight);\n      }\n      var kit = this;\n      _u.each(this.objList, function (item) {\n        kit.context.save();\n        item.transform();\n        item.draw();\n        kit.context.restore();\n      });\n      if (this.editMode === constants.EDIT_SHAPE) {\n        this.objList[kit.selectedObject].drawShapePoints();\n      }\n      if (this.editMode === constants.EDIT_TRANSFORM) {\n        this.objList[kit.selectedObject].drawTransformPoints();\n      }\n    };\n    return kit;\n  }({}, constants, util, PetalFlower, Vector);\nvar FillImage = function (require, Vector, constants) {\n    \n    var Vector = Vector;\n    var constants = constants;\n    var FillImage = function (src, page, label) {\n      this.src = src;\n      this.page = page;\n      this.label = label;\n      this.image = new Image();\n      this.image.onload = function () {\n        window.kit.fillImageExists = true;\n        window.kit.redraw();\n      };\n      this.image.src = this.src;\n    };\n    FillImage.prototype.draw = function (transform, object) {\n      var kit = object.kit;\n      var sweepFrom = Vector.getPolarPoint(Vector.create(0, 0), kit.maxRadius, object.firstInnerAngle / object.radialAccent + transform.rotation);\n      var sweepTo = Vector.getPolarPoint(Vector.create(0, 0), kit.maxRadius, transform.rotation);\n      var temp_canvas = document.createElement('canvas');\n      temp_canvas.width = kit.canvasWidth;\n      temp_canvas.height = kit.canvasHeight;\n      var tempContext = temp_canvas.getContext('2d');\n      tempContext.setTransform(1, 0, 0, 1, object.center.x, object.center.y);\n      tempContext.save();\n      tempContext.beginPath();\n      tempContext.moveTo(0, 0);\n      tempContext.lineTo(sweepFrom.x, sweepFrom.y);\n      tempContext.lineTo(sweepTo.x, sweepTo.y);\n      tempContext.closePath();\n      tempContext.clip();\n      tempContext.drawImage(this.image, -kit.midWidth, -kit.midHeight, kit.canvasWidth, kit.canvasHeight);\n      tempContext.stroke();\n      tempContext.restore();\n      tempContext.save();\n      var reflectionMatrix = Vector.reflectMatrix(transform.rotation);\n      tempContext.setTransform(reflectionMatrix[0], reflectionMatrix[1], reflectionMatrix[2], reflectionMatrix[3], object.center.x, object.center.y);\n      tempContext.beginPath();\n      tempContext.moveTo(0, 0);\n      tempContext.lineTo(sweepFrom.x, sweepFrom.y);\n      tempContext.lineTo(sweepTo.x, sweepTo.y);\n      tempContext.closePath();\n      tempContext.clip();\n      tempContext.drawImage(this.image, -kit.midWidth, -kit.midHeight, kit.canvasWidth, kit.canvasHeight);\n      tempContext.stroke();\n      tempContext.restore();\n      kit.context.save();\n      kit.context.translate(-object.center.x, -object.center.y);\n      for (var i = 0; i < object.petalCount; i++) {\n        var matrix = kit.getRotationMatrix(constants.TWOPI / object.petalCount);\n        kit.context.transform(matrix[0], matrix[1], matrix[2], matrix[3], object.center.x, object.center.y);\n        kit.context.translate(-object.center.x, -object.center.y);\n        kit.context.drawImage(temp_canvas, 0, 0);\n      }\n      kit.context.restore();\n    };\n    return FillImage;\n  }({}, Vector, constants);\nvar canvasEvents = function (require, core, Vector, constants, util, CPoint) {\n    \n    var kit = core;\n    var Vector = Vector;\n    var constants = constants;\n    var _u = util;\n    var CPoint = CPoint;\n    kit.prototype.bindEvents = function () {\n      this.canvas.addEventListener('touchstart', this.startDrag, false);\n      this.canvas.addEventListener('touchend', this.endDrag, false);\n      this.canvas.addEventListener('touchmove', this.move, false);\n      this.canvas.addEventListener('mousedown', this.startDrag, false);\n      this.canvas.addEventListener('mouseup', this.endDrag, false);\n      this.canvas.addEventListener('mousemove', this.move, false);\n    };\n    kit.prototype.startDrag = function (event) {\n      var kit = window.kit;\n      if (kit.animationMode === true) {\n        return;\n      }\n      var position = _u.getPosition(event, kit.canvas);\n      var object = kit.objList[kit.selectedObject];\n      if (kit.editMode === constants.EDIT_SHAPE) {\n        _u.each(object.shapePoints, function (thisPoint) {\n          var actualPosition = object.reverseTransformPoint(position);\n          if (thisPoint.mouseInside(actualPosition)) {\n            thisPoint.inDrag = true;\n            kit.canvasMode = 'cpDrag';\n            kit.redraw();\n            return;\n          }\n        });\n      } else if (kit.editMode === constants.EDIT_TRANSFORM) {\n        _u.each(object.transformPoints, function (thisPoint) {\n          var positionInsideObject;\n          if (thisPoint.index !== 2) {\n            positionInsideObject = Vector.create(position.x - object.center.x, position.y - object.center.y);\n            positionInsideObject = Vector.rotate(0, 0, positionInsideObject, -object.rotation);\n          } else {\n            object.lastScale = object.scale;\n            positionInsideObject = Vector.create(position.x - object.center.x, position.y - object.center.y);\n          }\n          if (thisPoint.mouseInside(positionInsideObject)) {\n            thisPoint.inDrag = true;\n            kit.canvasMode = 'cpDrag';\n            kit.redraw();\n            return;\n          }\n        });\n      }\n    };\n    kit.prototype.endDrag = function (event) {\n      var kit = window.kit;\n      if (kit.animationMode === true) {\n        return;\n      }\n      kit.canvasMode = 'static';\n      kit.position = _u.getPosition(event, kit.canvas);\n      var object = kit.objList[kit.selectedObject];\n      if (kit.editMode === constants.EDIT_SHAPE) {\n        _u.each(object.shapePoints, function (thisPoint) {\n          if (thisPoint.inDrag === true) {\n            thisPoint.inDrag = false;\n            kit.redraw();\n          }\n        });\n      } else if (kit.editMode === constants.EDIT_TRANSFORM) {\n        _u.each(object.transformPoints, function (thisPoint) {\n          if (thisPoint.inDrag === true) {\n            thisPoint.inDrag = false;\n            if (thisPoint.index === 2) {\n              thisPoint.x = object.scaleDistance;\n            }\n            kit.redraw();\n          }\n        });\n      }\n      kit.getState();\n      kit.digest();\n    };\n    kit.prototype.move = function (event) {\n      var kit = window.kit;\n      if (kit.canvasMode !== 'cpDrag' || kit.animationMode === true) {\n        return;\n      }\n      var object = kit.objList[kit.selectedObject];\n      var position = _u.getPosition(event, kit.canvas);\n      var actualPosition = object.reverseTransformPoint(position);\n      var index = 0;\n      if (kit.editMode === kit.constants.EDIT_SHAPE) {\n        _u.each(object.shapePoints, function (thisPoint) {\n          if (thisPoint.inDrag) {\n            var newPoint = new CPoint(kit, actualPosition.x, actualPosition.y, object, index);\n            newPoint.inDrag = true;\n            object.updatePetal(index, newPoint);\n            kit.redraw();\n            return;\n          }\n          index++;\n        });\n      } else if (kit.editMode === kit.constants.EDIT_TRANSFORM) {\n        _u.each(object.transformPoints, function (thisPoint) {\n          if (thisPoint.inDrag) {\n            if (index === 0) {\n              object.center = position;\n            } else if (index === 1) {\n              var angleVector = Vector.create(position.x - object.center.x, position.y - object.center.y);\n              var angle = Vector.getRadians(Vector.create(0, 0), angleVector);\n              kit.setRotation(angle);\n              kit._u.debugConsole(angle);\n            } else if (index === 2) {\n              var newX = position.x - object.center.x;\n              object.setScale(newX);\n              thisPoint.x = newX;\n            }\n            kit.redraw();\n            return;\n          }\n          index++;\n        });\n      }\n    };\n    kit.prototype.constrain = function (point) {\n      if (point.x < 0) {\n        point.x = 0;\n      } else if (point.x > this.canvasWidth) {\n        point.x = this.canvasWidth;\n      }\n      if (point.y < 0) {\n        point.y = 0;\n      } else if (point.y > this.canvasHeight) {\n        point.y = this.canvasHeight;\n      }\n    };\n    return kit;\n  }({}, core, Vector, constants, util, CPoint);\nvar sceneEvents = function (require, core, constants, util, PetalFlower, CPoint, Vector) {\n    \n    var kit = core;\n    var constants = constants;\n    var _u = util;\n    var PetalFlower = PetalFlower;\n    var CPoint = CPoint;\n    var Vector = Vector;\n    kit.prototype.sceneLoop = function () {\n      if (!this.animationMode || this.keyFrames.length < 2) {\n        this.stopScene();\n        this.digest();\n        return;\n      }\n      if (this.sceneMode === constants.SCENE_GIF) {\n        this.delta += this.gifFramerate;\n      } else {\n        this.delta = _u.msTime() - this.segmentStartTime;\n      }\n      var lastStartTime = _u.msTime();\n      if (this.segment === 0 && this.delta >= this.pauseTime) {\n        this.segment = 1;\n        this.delta = 0;\n        this.segmentStartTime = _u.msTime();\n      } else if (this.segment !== 0) {\n        if (this.delta > this.keyFrames[this.segment - 1].timing * 1000) {\n          if (this.segment === this.keyFrames.length - 1 && this.seamlessAnimation === false) {\n            this.segment = 0;\n            this.setState();\n            this.segment = 1;\n            this.delta = 0;\n            this.segmentStartTime = _u.msTime();\n          } else if (this.segment < this.keyFrames.length) {\n            this.setState();\n            this.segment++;\n            if (this.sceneMode === this.GIF) {\n              this.delta = 0;\n            } else {\n              this.segmentStartTime = _u.msTime();\n            }\n          } else {\n            if (this.sceneMode === constants.SCENE_GIF) {\n              this.gifComplete();\n              return;\n            }\n            this.segment = 0;\n            this.setState();\n            this.segmentStartTime = _u.msTime();\n          }\n        } else {\n          this.updateSegment(this.delta);\n        }\n      }\n      this.digest();\n      if (this.sceneMode === constants.SCENE_GIF) {\n        this.encoder.addFrame(this.context);\n        setTimeout(function () {\n          window.kit.sceneLoop();\n        }, 0.01);\n      } else {\n        var processTime = _u.msTime() - lastStartTime;\n        setTimeout(function () {\n          window.kit.sceneLoop();\n        }, Math.max(0, window.kit.frameDelay - processTime));\n      }\n    };\n    kit.prototype.updateSegment = function (delta) {\n      var keyTo = this.segment;\n      if (this.segment === this.keyFrames.length) {\n        keyTo = 0;\n      }\n      var sig = delta / (this.keyFrames[keyTo].timing * 1000);\n      var objIndex = 0;\n      var kit = this;\n      _u.each(this.keyFrames[keyTo].obj, function (ob) {\n        var index = 0;\n        var newCps = [];\n        var obFrom = kit.keyFrames[kit.segment - 1].obj[objIndex];\n        _u.each(ob.shapePoints, function (cp) {\n          var newX = obFrom.shapePoints[index].x * (1 - sig) + cp.x * sig;\n          var newY = obFrom.shapePoints[index].y * (1 - sig) + cp.y * sig;\n          var newPoint = new CPoint(kit, newX, newY, kit.objList[objIndex], index);\n          newCps.push(newPoint);\n          index++;\n        });\n        var newState = { shapePoints: newCps };\n        var fromRotation = obFrom.rotation;\n        var toRotation = ob.rotation;\n        var del = toRotation - fromRotation;\n        if (Math.abs(del) > Math.PI) {\n          if (del < 0) {\n            toRotation += 2 * Math.PI;\n          } else {\n            fromRotation += 2 * Math.PI;\n          }\n        }\n        newState.rotation = (fromRotation * (1 - sig) + toRotation * sig) % 360;\n        newState.position = Vector.create(obFrom.position.x * (1 - sig) + ob.position.x * sig, obFrom.position.y * (1 - sig) + ob.position.y * sig);\n        newState.scale = obFrom.scale * (1 - sig) + ob.scale * sig;\n        kit.objList[objIndex].setState(newState);\n        objIndex++;\n      });\n    };\n    kit.prototype.segmentLoop = function () {\n      if (!this.animationMode || this.segment === 0) {\n        this.setState();\n        this.digest();\n        return;\n      }\n      var delta = _u.msTime() - this.loopStartTime - this.pauseTime;\n      if (delta < 0) {\n        if (this.setTime !== 0) {\n          this.segment--;\n          this.setState();\n          this.segment++;\n          this.setTime = 0;\n        }\n      } else if (delta > this.keyFrames[this.segment].timing * 1000) {\n        if (delta > this.keyFrames[this.segment].timing * 1000 + this.pauseTime) {\n          this.loopStartTime = _u.msTime();\n          this.segment--;\n          this.setState();\n          this.segment++;\n          this.setTime = 0;\n        } else if (this.setTime !== this.keyFrames[this.segment].timing * 1000) {\n          this.setState();\n          this.setTime = this.keyFrames[this.segment].timing * 1000;\n        }\n      } else {\n        var sig = delta / (this.keyFrames[this.segment].timing * 1000);\n        var objIndex = 0;\n        var kit = this;\n        _u.each(this.keyFrames[this.segment].obj, function (ob) {\n          var index = 0;\n          var newCps = [];\n          _u.each(ob.shapePoints, function (cp) {\n            var newX = kit.keyFrames[kit.segment - 1].obj[objIndex].shapePoints[index].x * (1 - sig) + cp.x * sig;\n            var newY = kit.keyFrames[kit.segment - 1].obj[objIndex].shapePoints[index].y * (1 - sig) + cp.y * sig;\n            var newPoint = new CPoint(kit, newX, newY, kit.objList[objIndex], index);\n            newCps.push(newPoint);\n            index++;\n          });\n          var newState = { shapePoints: newCps };\n          var obFrom = kit.keyFrames[kit.segment - 1].obj[objIndex];\n          var fromRotation = obFrom.rotation;\n          var toRotation = ob.rotation;\n          var del = toRotation - fromRotation;\n          if (Math.abs(del) > 180) {\n            if (del < 0) {\n              toRotation += 360;\n            } else {\n              fromRotation += 360;\n            }\n          }\n          newState.rotation = (fromRotation * (1 - sig) + toRotation * sig) % 360;\n          newState.position = Vector.create(obFrom.center.x * (1 - sig) + ob.center.x * sig, obFrom.center.y * (1 - sig) + ob.center.y * sig);\n          newState.scale = obFrom.scale * (1 - sig) + ob.scale * sig;\n          kit.objList[objIndex].setState(newState);\n          objIndex++;\n        });\n      }\n      setTimeout(function () {\n        window.kit.segmentLoop();\n      }, window.kit.frameDelay);\n    };\n    kit.prototype.initFrame = function () {\n      this.keyFrames[this.segment] = {};\n      this.keyFrames[this.segment].obj = [];\n      if (this.segment > 0) {\n        this.keyFrames[this.segment].timing = this.keyFrames[this.segment - 1].timing;\n        for (var i = 0; i < this.objList; i++) {\n          this.keyFrames[this.segment].obj[i].rotation = this.keyFrames[this.segment - 1].obj[i].rotation;\n          this.keyFrames[this.segment].obj[i].center = this.keyFrames[this.segment - 1].obj[i].center;\n          this.keyFrames[this.segment].obj[i].scale = this.keyFrames[this.segment - 1].obj[i].scale;\n        }\n      } else {\n        this.keyFrames[this.segment].timing = constants.DEFAULT_LENGTH;\n        for (var ind = 0; ind < this.objList; ind++) {\n          this.keyFrames[this.segment].obj[ind].rotation = 0;\n          this.keyFrames[this.segment].obj[ind].position = new Vector(this.objList[0].center.x, this.objList[0].center.y);\n          this.keyFrames[this.segment].obj[ind].scale = 1;\n        }\n      }\n      this.storeFrame();\n    };\n    kit.prototype.clearScene = function () {\n      this.objList = [];\n      this.objTypes = [];\n      this.resourceList = {};\n      this.backgroundImageExists = false;\n      this.fillImageExists = false;\n      this.keyFrames = [];\n      this.segment = 0;\n      this.objList.push(new PetalFlower(this, constants.DEFAULT_RAYS, 1, this.canvasHeight / constants.DEFAULT_INNER_RADIUS_SCALAR, this.canvasHeight / constants.DEFAULT_OUTER_RADIUS_SCALAR, Vector.create(this.midWidth, this.midHeight)));\n      this.objTypes.push([\n        'flower',\n        constants.DEFAULT_RAYS,\n        1\n      ]);\n      this.selectedObject = 0;\n      this.initFrame();\n      this.redraw();\n      this.digest();\n    };\n    kit.prototype.storeFrame = function () {\n      for (var i = 0; i < this.objList.length; i++) {\n        this.keyFrames[this.segment].obj[i] = this.objList[i].getState();\n      }\n      var val = this.objList[this.selectedObject].rotation;\n    };\n    kit.prototype.removeKeyframe = function () {\n      if (this.keyFrames.length < 2) {\n        return;\n      }\n      _u.removeArrayEntry(this.keyFrames, this.segment);\n      if (this.segment === this.keyFrames.length) {\n        this.segment--;\n      }\n      this.setState();\n      this.redraw();\n      this.digest();\n    };\n    kit.prototype.removeLast = function () {\n      if (this.keyFrames.length < 2) {\n        return;\n      }\n      _u.removeArrayEntry(this.keyFrames, this.keyFrames.length - 1);\n      if (this.segment === this.keyFrames.length) {\n        this.segment--;\n      }\n      this.setState();\n      this.redraw();\n      this.digest();\n    };\n    kit.prototype.gifInit = function () {\n      this.encoder.setRepeat(-1);\n      this.encoder.setDelay(this.gifFramerate);\n      this.encoder.setSize(this.canvasWidth, this.canvasHeight);\n      this.encoder.start();\n      this.sceneMode = constants.SCENE_GIF;\n      this.loopInit();\n      this.redraw();\n    };\n    kit.prototype.gifComplete = function () {\n      this.encoder.finish();\n      var binary_gif = this.encoder.stream().getData();\n      var data_url = 'data:image/gif;base64,' + window.encode64(binary_gif);\n      window.open(data_url, '_blank');\n      this.sceneMode = constants.SCENE_NORMAL;\n      this.stopScene();\n    };\n    kit.prototype.loopInit = function () {\n      this.animationMode = true;\n      this.segment = 0;\n      this.loopStartTime = _u.msTime();\n      this.segmentStartTime = this.loopStartTime;\n      this.setTempModes(constants.EDIT_NONE, false);\n    };\n    kit.prototype.stopScene = function () {\n      this.restoreModes();\n      this.sceneReset();\n    };\n    kit.prototype.sceneReset = function () {\n      this.animationMode = false;\n      this.segment = 0;\n      this.setState();\n      this.redraw();\n    };\n    kit.prototype.setState = function () {\n      for (var i = 0; i < this.objList.length; i++) {\n        this.objList[i].setState(this.keyFrames[this.segment].obj[i]);\n      }\n    };\n    kit.prototype.selectFirst = function () {\n      this.segment = 0;\n      this.setState();\n    };\n    kit.prototype.selectPrev = function () {\n      if (this.segment > 0) {\n        this.segment--;\n        for (var i = 0; i < this.objList.length; i++) {\n          this.objList[i].setState(this.keyFrames[this.segment].obj[i]);\n        }\n      }\n    };\n    kit.prototype.selectNext = function () {\n      this.segment++;\n      if (this.segment >= this.keyFrames.length) {\n        this.initFrame();\n      } else {\n        this.setState();\n      }\n    };\n    kit.prototype.selectLast = function () {\n      this.segment = this.keyFrames.length - 1;\n      this.setState();\n    };\n    return kit;\n  }({}, core, constants, util, PetalFlower, CPoint, Vector);\nvar objectEvents = function (require, core, constants, util, Vector, PetalFlower, FillImage) {\n    \n    var kit = core;\n    var constants = constants;\n    var _u = util;\n    var Vector = Vector;\n    var PetalFlower = PetalFlower;\n    var FillImage = FillImage;\n    kit.prototype.setState = function () {\n      for (var i = 0; i < this.objList.length; i++) {\n        this.objList[i].setState(this.keyFrames[this.segment].obj[i]);\n      }\n    };\n    kit.prototype.getState = function () {\n      for (var i = 0; i < this.objList.length; i++) {\n        this.keyFrames[this.segment].obj[i] = this.objList[i].getState();\n      }\n      this.keyFrames[this.segment].timing = parseFloat(document.getElementById('length').value);\n    };\n    kit.prototype.getRotation = function () {\n      var rotationDegrees = this.keyFrames[this.segment].obj[this.selectedObject].rotation / this.constants.TWOPIDIV360;\n      return Math.floor(rotationDegrees * 100) / 100;\n    };\n    kit.prototype.getRotationMatrix = function (angle) {\n      var cos = Math.cos(angle);\n      var sin = Math.sin(angle);\n      return [\n        cos,\n        sin,\n        -sin,\n        cos,\n        0,\n        0\n      ];\n    };\n    kit.prototype.setRotation = function (val) {\n      this.objList[this.selectedObject].rotation = val;\n      this.keyFrames[this.segment].obj[this.selectedObject].rotation = val;\n      this.objList[this.selectedObject].allPetals = [];\n      this.objList[this.selectedObject].createPetals();\n      this.redraw();\n    };\n    kit.prototype.addFillImage = function (src) {\n      this.fillImage = new FillImage(src);\n      this.resourceList.fillImageSource = src;\n    };\n    kit.prototype.addBackgroundImage = function (src) {\n      this.backgroundImage = new Image();\n      this.backgroundImage.onload = function () {\n        window.kit.backgroundImageExists = true;\n        window.kit.redraw();\n      };\n      this.backgroundImage.src = src;\n      this.resourceList.backgroundImageSource = src;\n    };\n    kit.prototype.updatePetalCount = function (petals) {\n      var object = this.objList[this.selectedObject];\n      if (object instanceof PetalFlower) {\n        this.objList[this.selectedObject] = new PetalFlower(this, petals, object.radialAccent, this.canvasHeight / constants.DEFAULT_INNER_RADIUS_SCALAR, this.canvasHeight / constants.DEFAULT_OUTER_RADIUS_SCALAR, Vector.create(this.midWidth, this.midHeight));\n        this.objTypes[this.selectedObject][1] = petals;\n        this.objList[this.selectedObject].updateRadialPoint();\n        this.setState();\n        this.redraw();\n      }\n    };\n    kit.prototype.updateRadialAccent = function (radialScalar) {\n      this.objTypes[this.selectedObject][2] = radialScalar;\n      var thisObject = this.objList[this.selectedObject];\n      if (radialScalar > 0 && radialScalar < thisObject.petalCount) {\n        thisObject.accentRadialPoint(radialScalar);\n        this.setState();\n        this.redraw();\n      }\n    };\n    kit.prototype.selectObject = function (obj) {\n      obj = parseFloat(obj);\n      if (this.selectedObject !== obj && obj < this.objList.length && obj < this.constants.MAX_OBJECTS && obj >= 0) {\n        this.selectedObject = obj;\n        this.redraw();\n        this.digest();\n      }\n    };\n    kit.prototype.addObject = function () {\n      if (this.objList.length >= constants.MAX_OBJECTS) {\n        return;\n      }\n      this.objList.push(new PetalFlower(this, constants.DEFAULT_RAYS, 1, this.canvasHeight / constants.DEFAULT_INNER_RADIUS_SCALAR, this.canvasHeight / constants.DEFAULT_OUTER_RADIUS_SCALAR, Vector.create(this.midWidth, this.midHeight)));\n      this.objTypes.push([\n        'flower',\n        constants.DEFAULT_RAYS,\n        1\n      ]);\n      for (var i = 0; i < this.keyFrames.length; i++) {\n        this.keyFrames[i].obj[this.objList.length - 1] = this.objList[this.objList.length - 1].getState();\n        this.keyFrames[i].obj[this.objList.length - 1].timing = document.getElementById('length').value;\n      }\n      var ind = this.objList.length - 1;\n      this.selectedObject = ind;\n      this.redraw();\n      this.digest();\n    };\n    kit.prototype.removeObject = function () {\n      if (this.objList.length < 2) {\n        return;\n      }\n      _u.removeArrayEntry(this.objList, this.selectedObject);\n      _u.removeArrayEntry(this.objTypes, this.selectedObject);\n      var kit = this;\n      _u.each(this.keyFrames, function (keyFrame) {\n        _u.removeArrayEntry(keyFrame.obj, kit.selectedObject);\n      });\n      if (this.selectedObject === this.objList.length) {\n        this.selectedObject--;\n      }\n      this.redraw();\n      this.digest();\n    };\n    kit.prototype.getImage = function () {\n      this.setTempModes(constants.EDIT_NONE, false);\n      this.redraw();\n      window.open(this.canvas.toDataURL('image/png'));\n      this.restoreModes();\n      this.redraw();\n    };\n    return kit;\n  }({}, core, constants, util, Vector, PetalFlower, FillImage);\nvar settingsEvents = function (require, core, constants, util, PetalFlower, Vector) {\n    \n    var kit = core;\n    var constants = constants;\n    var _u = util;\n    var PetalFlower = PetalFlower;\n    var Vector = Vector;\n    kit.prototype.getSettings = function (data, preinit) {\n      return {\n        'backgroundColor': this.backgroundColor,\n        'backgroundAlpha': this.backgroundAlpha,\n        'lineColor': this.lineColor,\n        'sourceMode': this.sourceMode,\n        'seamlessAnimation': this.seamlessAnimation\n      };\n    };\n    kit.prototype.loadData = function (data, preinit) {\n      this.objList = [];\n      this.objTypes = [];\n      this.resourceList = data[1];\n      this.objTypes = data[2];\n      this.keyFrames = data[3];\n      this.objList = [];\n      for (var i = 0; i < this.objTypes.length; i++) {\n        if (this.objTypes[i][0] === 'flower') {\n          this.objList.push(new PetalFlower(this, this.objTypes[i][1], this.objTypes[i][2], this.canvasHeight / constants.DEFAULT_INNER_RADIUS_SCALAR, this.canvasHeight / constants.DEFAULT_OUTER_RADIUS_SCALAR, Vector.create(this.midWidth, this.midHeight)));\n        }\n      }\n      this.options = data[0];\n      if (_u.exists(this.options.backgroundColor)) {\n        this.backgroundColor = this.options.backgroundColor;\n      } else {\n        this.backgroundColor = constants.BACKGROUND_COLOR;\n      }\n      if (_u.exists(this.options.backgroundAlpha)) {\n        this.backgroundAlpha = this.options.backgroundAlpha;\n      } else {\n        this.backgroundAlpha = constants.BACKGROUND_ALPHA;\n      }\n      if (_u.exists(this.options.lineColor)) {\n        this.lineColor = this.options.lineColor;\n      } else {\n        this.lineColor = constants.LINE_COLOR;\n      }\n      this.currentSelector = 'bg-color';\n      window.setColor('#' + this.backgroundColor);\n      this.currentSelector = 'line-color';\n      window.setColor('#' + this.lineColor);\n      if (_u.exists(this.options.sourceMode)) {\n        this.sourceMode = this.options.sourceMode;\n      } else {\n        this.sourceMode = constants.SOURCE_MODE;\n      }\n      if (_u.exists(this.options.seamlessAnimation)) {\n        this.seamlessAnimation = this.options.seamlessAnimation;\n      } else {\n        this.seamlessAnimation = true;\n      }\n      this.backgroundImageExists = false;\n      this.fillImageExists = false;\n      if (typeof this.resourceList.backgroundImageSource === 'string') {\n        this.addBackgroundImage(this.resourceList.backgroundImageSource);\n      }\n      if (typeof this.resourceList.fillImageSource === 'string') {\n        this.addFillImage(this.resourceList.fillImageSource);\n      }\n      this.selectedObject = 0;\n      this.segment = 0;\n      this.setState();\n    };\n    kit.prototype.setTempModes = function (editMode, toggleCurveColor) {\n      this.settingShelf = {\n        'editMode': this.editMode,\n        'toggleCurveColor': this.toggleCurveColor\n      };\n      this.editMode = editMode;\n      this.toggleCurveColor = toggleCurveColor;\n    };\n    kit.prototype.restoreModes = function () {\n      this.editMode = this.settingShelf.editMode;\n      this.toggleCurveColor = this.settingShelf.toggleCurveColor;\n    };\n    return kit;\n  }({}, core, constants, util, PetalFlower, Vector);\nvar src_app = function (require, core, constants, Vector, CPoint, Transform, FillImage, PetalFlower, canvasEvents, sceneEvents, objectEvents, settingsEvents) {\n    \n    var kit = core;\n    var _globalInit = function () {\n      window.kit = new kit();\n      initKeyboard();\n      kit.encoder = new GIFEncoder();\n      setTimeout(window.initInterface, 400);\n    };\n    if (document.readyState === 'complete') {\n      _globalInit();\n    } else {\n      window.addEventListener('load', _globalInit, false);\n    }\n    return window.kit;\n  }({}, core, constants, Vector, CPoint, Transform, FillImage, PetalFlower, canvasEvents, sceneEvents, objectEvents, settingsEvents);\n"]}