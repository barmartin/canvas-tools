/*! cKit.min.js v0.4.2 November 24, 2014 */

var constants=function(){var t=Math.PI;return{SCENE_NORMAL:0,SCENE_GIF:1,EDIT_SHAPE:0,EDIT_TRANSFORM:1,EDIT_NONE:2,PI:t,TWOPIDIV360:2*Math.PI/360,TWOPI:2*Math.PI,MAX_OBJECTS:4,DEFAULT_RAYS:6,DEFAULT_INNER_RADIUS_SCALAR:17,DEFAULT_OUTER_RADIUS_SCALAR:2.2,CONTROL_POINT_RADIUS:6,DEFAULT_LENGTH:1.5,MAX_CP_SIGS:4,BACKGROUND_COLOR:"010201",BACKGROUND_ALPHA:"1",LINE_COLOR:"9fb4f4",BODY_BACKGROUND_COLOR:"020202",MAX_CLICK_DISTANCE:2,SOURCE_MODES:{lighter:"lighter",darker:"darker",xor:"xor","source-atop":"atop","source-out":"out","source-over":"over","destination-atop":"bottom","destination-out":"bottom-out"}}}({}),util=function(t,e){"use strict";var e=e;return{getPosition:function(t,e){var i=e.getBoundingClientRect();return{x:t.clientX-i.left,y:t.clientY-i.top}},clone:function(t){if(null==t||"object"!=typeof t)return t;var e=t.constructor();for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);return e},dnexist:function(t){return"undefined"==typeof t},exists:function(t){return"undefined"!=typeof t},encodeToHex:function(t){return parseInt(255*t).toString(16)},decodeFromHex:function(t){return parseInt(t,16)},parseIntOrDefault:function(t,e){return t=parseInt(t),Number.isInteger(t)?t:e},parseFloatOrDefault:function(t,e){return t=parseFloat(t),isNaN(t)?e:t},reduceSig:function(t,e){var i=Math.pow(10,e);return Math.round(t*i+1e-5)/i},degreesToRadians:function(t){return e.TWOPIDIV360*t},toRGB:function(t){return[this.decodeFromHex(t.substring(0,2)),this.decodeFromHex(t.substring(2,4)),this.decodeFromHex(t.substring(4,6))]},msTime:function(){return(new Date).getTime()},each:function(t,e){if(null==t)return t;var i,s=t.length;if(s===+s)for(i=0;s>i;i++)e(t[i],i,t);else{var n=window.kit._u.getKeys(t);for(i=0,s=n.length;s>i;i++)e(t[n[i]],n[i],t)}return t},getKeys:function(t){var e=[];for(var i in t)t.hasOwnProperty(i)&&e.push(i);return e},range:function(t,e){for(var i=[],s=t;e>s;s++)i.push(s);return i},indexOf:function(t,e){for(var i=0;i<t.length;i++)if(t[i]===e)return i;return console.log("There is a bug with a call to indexOf"),-1},removeArrayEntry:function(t,e){t.splice(e,1)},debugConsole:function(){document.getElementById("console")}}}({},constants),Vector=function(t,e){"use strict";var e=e;return{create:function(t,e){return{x:t,y:e}},multiply:function(t,e){return t.x*=e,t.y*=e,t},add:function(t,e){return t.x+=e.x,t.y+=e.y,t},getPoint:function(t,e,i,s){var n=t+i*Math.sin(s),o=e-i*Math.cos(s),a=this.create(n,o);return a},getPolarPoint:function(t,e,i){var s=t.x+e*Math.sin(i),n=t.y-e*Math.cos(i),o=this.create(s,n);return o},rotate:function(t,e,i,s){var n=Math.cos(s),o=Math.sin(s),a=n*(i.x-t)-o*(i.y-e)+t,r=o*(i.x-t)+n*(i.y-e)+e;return this.create(a,r)},distance:function(t,e){var i=t.x-e.x,s=t.y-e.y;return Math.sqrt(i*i+s*s)},getRadians:function(t,i){var s=i.x-t.x,n=t.y-i.y,o=Math.atan2(s,n);return 0>o&&(o+=e.TWOPI),o},getDegrees:function(t,i){var s=i.x-t.x,n=t.y-i.y,o=Math.atan2(s,n)*e.TWOPIDIV360;return 0>o&&(o+=360),o},zeroVector:function(){return{x:0,y:0}},reflectMatrix:function(t){return[Math.cos(2*t),Math.sin(2*t),Math.sin(2*t),-Math.cos(2*t)]}}}({},constants),CPoint=function(t,e,i){"use strict";var e=e,i=i,s=function(t,s,n,o,a){this.kit=t,this.x=s,this.y=n,this.parentObject=o,this.index=a,this.inDrag=!1,this.draw=function(){var t;if(t=this.kit.editMode!==e.EDIT_TRANSFORM||2!==this.index?i.rotate(0,0,this,o.rotation):this,this.inDrag){var s,n=o.shapePoints;this.kit.editMode===e.EDIT_TRANSFORM&&(n=o.transformPoints),1===this.index?(s=i.rotate(0,0,n[0],o.rotation),this.kit.context.beginPath(),this.kit.context.moveTo(t.x,t.y),this.kit.context.lineTo(s.x,s.y),this.kit.context.stroke()):2===this.index&&(s=this.kit.editMode===e.EDIT_TRANSFORM?n[0]:i.rotate(0,0,n[3],o.rotation),this.kit.context.beginPath(),this.kit.context.moveTo(t.x,t.y),this.kit.context.lineTo(s.x,s.y),this.kit.context.stroke())}this.kit.context.beginPath(),this.kit.context.arc(t.x,t.y,this.kit.controlPointRadius,0,2*Math.PI,!0),this.kit.context.closePath(),this.kit.context.lineWidth=1,this.inDrag?(this.kit.context.fillStyle="#999999",this.kit.context.fill()):(this.kit.context.fillStyle="#FFFFFF",this.kit.context.fill()),this.kit.context.stroke()},this.mouseInside=function(t){return this.kit.controlPointRadius+e.MAX_CLICK_DISTANCE>i.distance(t,this)*this.parentObject.scale}};return s}({},constants,Vector),Transform=function(){"use strict";var t=function(t,e,i){this.position=t,this.scale=e,this.rotation=i};return t.prototype.getMatrix=function(){var t=Math.cos(this.rotation),e=Math.sin(this.rotation);return[this.scale*t,e,-e,this.scale*t,this.position.x,this.position.y]},t}({}),PetalFlower=function(t,e,i,s,n){"use strict";var e=e,i=i,s=s,o=n,a=function(t,s,n,o,a,r){this.kit=t,this.petalCount=s,this.radialAccent=n,this.allPetals=[],this.firstPetal=[],this.thisAngle=0,this.increment=2*Math.PI/s,this.firstInnerAngle=-.5*this.increment*n,this.shapePoints=[],this.transformPoints=[],this.rotation=0,this.center=r,this.scaleDistance=this.kit.midWidth/2,this.scale=1,this.lastScale=1;var h,c,l,d;h=i.getPoint(0,0,o,this.firstInnerAngle);var m=(a-o)/2+o;c=i.getPoint(0,0,m,this.firstInnerAngle),l=i.getPoint(0,0,a,0),l.x=l.x-40,d=i.getPoint(0,0,a,0),this.firstPetal.push(h),this.shapePoints.push(new e(t,h.x,h.y,this,0)),this.shapePoints.push(new e(t,c.x,c.y,this,1)),this.firstPetal.push(c),this.shapePoints.push(new e(t,l.x,l.y,this,2)),this.firstPetal.push(l),this.shapePoints.push(new e(t,d.x,d.y,this,3)),this.firstPetal.push(d),this.firstPetal.push(i.create(-l.x,l.y)),this.firstPetal.push(i.create(-c.x,c.y)),this.firstPetal.push(i.create(-h.x,h.y)),this.transformPoints.push(new e(this.kit,0,0,this,0));var u=i.create(0,-this.kit.midHeight/2.5);i.rotate(0,0,u,this.rotation),this.transformPoints.push(new e(this.kit,u.x,u.y,this,1)),this.transformPoints.push(new e(this.kit,this.scaleDistance,0,this,2)),this.createPetals()};return a.prototype.draw=function(){var t=0,e=this,n=this.kit;n.context.beginPath(),o.each(this.allPetals,function(s){if(0===e.rotation)n.context.moveTo(s[0].x,s[0].y),n.context.bezierCurveTo(s[1].x,s[1].y,s[2].x,s[2].y,s[3].x,s[3].y),n.context.bezierCurveTo(s[4].x,s[4].y,s[5].x,s[5].y,s[6].x,s[6].y),n.context.moveTo(s[6].x,s[6].y),n.context.lineTo(s[0].x,s[0].y);else{for(var o=[],a=0;a<s.length;a++)o.push(i.rotate(0,0,s[a],e.rotation));n.context.moveTo(o[0].x,o[0].y),n.context.bezierCurveTo(o[1].x,o[1].y,o[2].x,o[2].y,o[3].x,o[3].y),n.context.bezierCurveTo(o[4].x,o[4].y,o[5].x,o[5].y,o[6].x,o[6].y),n.context.moveTo(o[6].x,o[6].y),n.context.lineTo(o[0].x,o[0].y)}t++}),n.context.closePath(),n.fillImageExists?(n.context.globalCompositeOperation=n.sourceMode,n.context.clip(),n.fillImage.draw(new s(this.center,this.scale,this.rotation),this),n.highlightCurve===!0&&(n.context.globalCompositeOperation="source-over",n.context.lineWidth=1.9,n.context.stroke())):(n.context.globalCompositeOperation="source-over",n.context.stroke())},a.prototype.createPetals=function(){this.allPetals.push(this.firstPetal);for(var t=1;t<this.petalCount;t++){var e=[],s=t*this.increment;o.each(this.firstPetal,function(t){var n=i.rotate(0,0,t,s);e.push(n)}),this.allPetals.push(e)}},a.prototype.updatePetal=function(t,e){var s=i.create(e.x,e.y);if(3===t)s.x=0,this.firstPetal[3].x=0,this.firstPetal[t].y=e.y;else if(0===t){var n=i.distance(i.create(0,0),i.create(e.x,e.y));s=i.getPoint(0,0,n,this.firstInnerAngle),s.x=o.reduceSig(s.x,constants.MAX_CP_SIGS),s.y=o.reduceSig(s.y,constants.MAX_CP_SIGS),this.firstPetal[0].x=s.x,this.firstPetal[0].y=s.y,this.firstPetal[6].x=-s.x,this.firstPetal[6].y=s.y}else this.firstPetal[t].x=e.x,this.firstPetal[6-t].x=-e.x,this.firstPetal[6-t].y=e.y,this.firstPetal[t].y=e.y;this.allPetals=[],this.createPetals(),this.shapePoints[t].x=s.x,this.shapePoints[t].y=s.y},a.prototype.updateTransform=function(t,e){var s=i.create(e.x,e.y);this.transformPoints[t].x=s.x,this.transformPoints[t].y=s.y},a.prototype.transform=function(){this.kit.context.transform(this.scale,0,0,this.scale,this.center.x,this.center.y)},a.prototype.translateTranform=function(){this.kit.context.transform(1,0,0,1,this.center.x,this.center.y)},a.prototype.reverseTransformPoint=function(t){var e=i.create(t.x-this.center.x,t.y-this.center.y);return e.x/=this.scale,e.y/=this.scale,e=i.rotate(0,0,e,-this.rotation)},a.prototype.setScale=function(t){this.scale=this.lastScale*t/this.scaleDistance},a.prototype.resetScalePoint=function(){this.transformPoints[2].x=this.scaleDistance},a.prototype.updateFirstPetal=function(){this.firstPetal[0].x=this.shapePoints[0].x,this.firstPetal[0].y=this.shapePoints[0].y,this.firstPetal[1].x=this.shapePoints[1].x,this.firstPetal[1].y=this.shapePoints[1].y,this.firstPetal[2].x=this.shapePoints[2].x,this.firstPetal[2].y=this.shapePoints[2].y,this.firstPetal[3].x=this.shapePoints[3].x,this.firstPetal[3].y=this.shapePoints[3].y,this.firstPetal[4].x=-this.shapePoints[2].x,this.firstPetal[4].y=this.shapePoints[2].y,this.firstPetal[5].x=-this.shapePoints[1].x,this.firstPetal[5].y=this.shapePoints[1].y,this.firstPetal[6].x=-this.shapePoints[0].x,this.firstPetal[6].y=this.shapePoints[0].y},a.prototype.setControlPoint=function(t,e){this.shapePoints[this.kit.indexOf(this.shapePoints,t)]=e},a.prototype.updateRadialPoint=function(){this.increment=2*Math.PI/this.petalCount,this.firstInnerAngle=-.5*this.increment*this.radialAccent;var t=this.kit,e=this;o.each(t.keyFrames,function(s){var n=s.obj[t.selectedObject].shapePoints[0],o=i.distance(i.zeroVector(),i.create(n.x,n.y)),a=i.getPolarPoint(i.zeroVector(),o,e.firstInnerAngle);n.x=a.x,n.y=a.y})},a.prototype.accentRadialPoint=function(t){this.radialAccent=t,this.increment=2*Math.PI/this.petalCount,this.firstInnerAngle=-.5*this.increment*t;var e=this.kit,s=this;o.each(e.keyFrames,function(t){var n=t.obj[e.selectedObject].shapePoints[0],o=i.distance(i.zeroVector(),i.create(n.x,n.y)),a=i.getPolarPoint(i.zeroVector(),o,s.firstInnerAngle);n.x=a.x,n.y=a.y})},a.prototype.drawShapePoints=function(){this.kit.context.save(),this.kit.context.transform(1,0,0,1,this.center.x,this.center.y);var t=this;o.each(this.shapePoints,function(i){var s=new e(t.kit,i.x*t.scale,i.y*t.scale,t,i.index);s.draw()}),this.kit.context.restore()},a.prototype.drawTransformPoints=function(){this.kit.context.save(),this.translateTranform(),this.transformPoints[0].draw(),this.transformPoints[1].draw(),this.transformPoints[2].draw(),this.kit.context.restore()},a.prototype.getState=function(){var t=[];return o.each(this.shapePoints,function(e){t.push(i.create(e.x,e.y))}),{shapePoints:t,rotation:this.rotation,scale:this.scale,position:this.center}},a.prototype.setState=function(t){var e=this.kit;this.rotation=t.rotation,this.center=t.position,this.scale=t.scale,e.index=0,o.each(this.shapePoints,function(i){i.x=t.shapePoints[e.index].x,i.y=t.shapePoints[e.index].y,e.index++}),this.allPetals=[],this.updateFirstPetal(),this.createPetals(),e.redraw()},a}({},CPoint,Vector,Transform,util),core=function(t,e,i,s,n){"use strict";var e=e,o=i,s=s,n=n,a=function(){this.constants=e,this._u=o,this.initialized=!1,this.keyFrames=[],this.updateMode=!1,this.animationMode=!1,this.segmentStartTime=0,this.segment=0,this.loopStartTime=0,this.setTime=0,this.pauseTime=0,this.frameDelay=30,this.gifFramerate=100,this.delta=-this.frameDelay,this.sceneMode=e.SCENE_NORMAL,this.encoder="",this.delayTime=0,this.initList=["flower"],this.pattern=null,this.bodybg=e.BODY_BACKGROUND_COLOR,this.backgroundColor=e.BACKGROUND_COLOR,this.lineColor=e.LINE_COLOR,this.backgroundAlpha=e.BACKGROUND_ALPHA;var t=this._u.getKeys(e.SOURCE_MODES)[0];this.sourceMode=e.SOURCE_MODES[t],this.canvasWidth=500,this.canvasHeight=500,this.midWidth=this.canvasWidth/2,this.midHeight=this.canvasHeight/2,this.maxRadius=Math.sqrt(this.midWidth*this.midWidth+this.midHeight*this.midHeight),this.controlPointRadius=e.CONTROL_POINT_RADIUS,this.editMode=e.EDIT_SHAPE,this.highlightCurve=!1,this.seamlessAnimation=!0,this.fieldFocus=!1,this.settingShelf={toggleCurveColor:this.toggleCurveColor,editMode:this.editMode},this.objList=[],this.objTypes=[],this.selectedObject=0,this.resourceList={},this.backgroundImageExists=!1,this.fillImageExists=!1,this.debugMode=!0,this.initializeCanvas=function(){if(this.canvas=document.getElementById("canvas"),this.context=this.canvas.getContext("2d"),this.bindEvents(),this.build(),this.debugMode===!0){var t=window.getSampleJSON();this.loadData(t,!1)}this.initialized=!0,this.redraw()}};return a.prototype.digest=function(){},a.prototype.build=function(){var t=this;o.each(o.range(0,this.initList.length),function(i){"flower"===t.initList[i]&&(t.objList.push(new s(t,e.DEFAULT_RAYS,1,t.canvasHeight/e.DEFAULT_INNER_RADIUS_SCALAR,t.canvasHeight/e.DEFAULT_OUTER_RADIUS_SCALAR,n.create(t.midWidth,t.midHeight))),t.objTypes.push(["flower",e.DEFAULT_RAYS,1]))}),this.initFrame()},a.prototype.redraw=function(){if(this.initialized){if(this.context.save(),this.context.setTransform(1,0,0,1,0,0),this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.context.restore(),this.context.strokeStyle="#"+this.lineColor,this.backgroundImageExists)this.context.drawImage(this.backgroundImage,0,0,this.canvasWidth,this.canvasHeight);else{var t=o.toRGB(this.backgroundColor);this.context.fillStyle="rgba("+t[0]+", "+t[1]+", "+t[2]+", "+this.backgroundAlpha+")",this.context.fillRect(0,0,this.canvasWidth,this.canvasHeight)}var i=this;o.each(this.objList,function(t){i.context.save(),t.transform(),t.draw(),i.context.restore()}),this.editMode===e.EDIT_SHAPE&&this.objList[i.selectedObject].drawShapePoints(),this.editMode===e.EDIT_TRANSFORM&&this.objList[i.selectedObject].drawTransformPoints()}},a}({},constants,util,PetalFlower,Vector),FillImage=function(t,e,i){"use strict";var e=e,i=i,s=function(t,e,i){this.src=t,this.page=e,this.label=i,this.image=new Image,this.image.onload=function(){window.kit.fillImageExists=!0,window.kit.redraw()},this.image.src=this.src};return s.prototype.draw=function(t,s){var n=s.kit,o=e.getPolarPoint(e.create(0,0),n.maxRadius,s.firstInnerAngle/s.radialAccent+t.rotation),a=e.getPolarPoint(e.create(0,0),n.maxRadius,t.rotation),r=document.createElement("canvas");r.width=n.canvasWidth,r.height=n.canvasHeight;var h=r.getContext("2d");h.setTransform(1,0,0,1,s.center.x,s.center.y),h.save(),h.beginPath(),h.moveTo(0,0),h.lineTo(o.x,o.y),h.lineTo(a.x,a.y),h.closePath(),h.clip(),h.drawImage(this.image,-n.midWidth,-n.midHeight,n.canvasWidth,n.canvasHeight),h.stroke(),h.restore(),h.save();var c=e.reflectMatrix(t.rotation);h.setTransform(c[0],c[1],c[2],c[3],s.center.x,s.center.y),h.beginPath(),h.moveTo(0,0),h.lineTo(o.x,o.y),h.lineTo(a.x,a.y),h.closePath(),h.clip(),h.drawImage(this.image,-n.midWidth,-n.midHeight,n.canvasWidth,n.canvasHeight),h.stroke(),h.restore(),n.context.save(),n.context.translate(-s.center.x,-s.center.y);for(var l=0;l<s.petalCount;l++){var d=n.getRotationMatrix(i.TWOPI/s.petalCount);n.context.transform(d[0],d[1],d[2],d[3],s.center.x,s.center.y),n.context.translate(-s.center.x,-s.center.y),n.context.drawImage(r,0,0)}n.context.restore()},s}({},Vector,constants),canvasEvents=function(t,e,i,s,n,o){"use strict";var a=e,i=i,s=s,r=n,o=o;return a.prototype.bindEvents=function(){this.canvas.addEventListener("touchstart",this.startDrag,!1),this.canvas.addEventListener("touchend",this.endDrag,!1),this.canvas.addEventListener("touchmove",this.move,!1),this.canvas.addEventListener("mousedown",this.startDrag,!1),this.canvas.addEventListener("mouseup",this.endDrag,!1),this.canvas.addEventListener("mousemove",this.move,!1)},a.prototype.startDrag=function(t){var e=window.kit;if(e.animationMode!==!0){var n=r.getPosition(t,e.canvas),o=e.objList[e.selectedObject];e.editMode===s.EDIT_SHAPE?r.each(o.shapePoints,function(t){var i=o.reverseTransformPoint(n);return t.mouseInside(i)?(t.inDrag=!0,e.canvasMode="cpDrag",void e.redraw()):void 0}):e.editMode===s.EDIT_TRANSFORM&&r.each(o.transformPoints,function(t){var s;return 2!==t.index?(s=i.create(n.x-o.center.x,n.y-o.center.y),s=i.rotate(0,0,s,-o.rotation)):(o.lastScale=o.scale,s=i.create(n.x-o.center.x,n.y-o.center.y)),t.mouseInside(s)?(t.inDrag=!0,e.canvasMode="cpDrag",void e.redraw()):void 0})}},a.prototype.endDrag=function(t){var e=window.kit;if(e.animationMode!==!0){e.canvasMode="static",e.position=r.getPosition(t,e.canvas);var i=e.objList[e.selectedObject];e.editMode===s.EDIT_SHAPE?r.each(i.shapePoints,function(t){t.inDrag===!0&&(t.inDrag=!1,e.redraw())}):e.editMode===s.EDIT_TRANSFORM&&r.each(i.transformPoints,function(t){t.inDrag===!0&&(t.inDrag=!1,2===t.index&&(t.x=i.scaleDistance),e.redraw())}),e.getState(),e.digest()}},a.prototype.move=function(t){var e=window.kit;if("cpDrag"===e.canvasMode&&e.animationMode!==!0){var n=e.objList[e.selectedObject],a=r.getPosition(t,e.canvas),h=n.reverseTransformPoint(a),c=0;e.editMode===e.constants.EDIT_SHAPE?r.each(n.shapePoints,function(t){if(t.inDrag){var i=new o(e,r.reduceSig(h.x,s.MAX_CP_SIGS),r.reduceSig(h.y,s.MAX_CP_SIGS),n,c);return i.inDrag=!0,n.updatePetal(c,i),void e.redraw()}c++}):e.editMode===e.constants.EDIT_TRANSFORM&&r.each(n.transformPoints,function(t){if(t.inDrag){if(0===c)n.center=a;else if(1===c){var s=i.create(a.x-n.center.x,a.y-n.center.y),o=i.getRadians(i.create(0,0),s);e.setRotation(o),e._u.debugConsole(o)}else if(2===c){var r=a.x-n.center.x;n.setScale(r),t.x=r}return void e.redraw()}c++})}},a.prototype.constrain=function(t){t.x<0?t.x=0:t.x>this.canvasWidth&&(t.x=this.canvasWidth),t.y<0?t.y=0:t.y>this.canvasHeight&&(t.y=this.canvasHeight)},a}({},core,Vector,constants,util,CPoint),sceneEvents=function(t,e,i,s,n,o,a){"use strict";var r=e,i=i,h=s,n=n,o=o,a=a;return r.prototype.sceneLoop=function(){if(!this.animationMode||this.keyFrames.length<2)return this.stopScene(),void this.digest();this.sceneMode===i.SCENE_GIF?this.delta+=this.gifFramerate:this.delta=h.msTime()-this.segmentStartTime;var t=h.msTime();if(0===this.segment&&this.delta>=this.pauseTime)this.segment=1,this.delta=0,this.segmentStartTime=h.msTime();else if(0!==this.segment)if(this.delta>1e3*this.keyFrames[this.segment-1].timing)if(this.segment===this.keyFrames.length-1&&this.seamlessAnimation===!1)this.segment=0,this.setState(),this.segment=1,this.delta=0,this.segmentStartTime=h.msTime();else if(this.segment<this.keyFrames.length)this.setState(),this.segment++,this.sceneMode===this.GIF?this.delta=0:this.segmentStartTime=h.msTime();else{if(this.sceneMode===i.SCENE_GIF)return void this.gifComplete();this.segment=0,this.setState(),this.segmentStartTime=h.msTime()}else this.updateSegment(this.delta);if(this.digest(),this.sceneMode===i.SCENE_GIF)this.encoder.addFrame(this.context),setTimeout(function(){window.kit.sceneLoop()},.01);else{var e=h.msTime()-t;setTimeout(function(){window.kit.sceneLoop()},Math.max(0,window.kit.frameDelay-e))}},r.prototype.updateSegment=function(t){var e=this.segment;this.segment===this.keyFrames.length&&(e=0);var i=t/(1e3*this.keyFrames[e].timing),s=0,n=this;h.each(this.keyFrames[e].obj,function(t){var e=0,r=[],c=n.keyFrames[n.segment-1].obj[s];h.each(t.shapePoints,function(t){var a=c.shapePoints[e].x*(1-i)+t.x*i,h=c.shapePoints[e].y*(1-i)+t.y*i,l=new o(n,a,h,n.objList[s],e);r.push(l),e++});var l={shapePoints:r},d=c.rotation,m=t.rotation,u=m-d;Math.abs(u)>Math.PI&&(0>u?m+=2*Math.PI:d+=2*Math.PI),l.rotation=(d*(1-i)+m*i)%360,l.position=a.create(c.position.x*(1-i)+t.position.x*i,c.position.y*(1-i)+t.position.y*i),l.scale=c.scale*(1-i)+t.scale*i,n.objList[s].setState(l),s++})},r.prototype.segmentLoop=function(){if(!this.animationMode||0===this.segment)return this.setState(),void this.digest();var t=h.msTime()-this.loopStartTime-this.pauseTime;if(0>t)0!==this.setTime&&(this.segment--,this.setState(),this.segment++,this.setTime=0);else if(t>1e3*this.keyFrames[this.segment].timing)t>1e3*this.keyFrames[this.segment].timing+this.pauseTime?(this.loopStartTime=h.msTime(),this.segment--,this.setState(),this.segment++,this.setTime=0):this.setTime!==1e3*this.keyFrames[this.segment].timing&&(this.setState(),this.setTime=1e3*this.keyFrames[this.segment].timing);else{var e=t/(1e3*this.keyFrames[this.segment].timing),i=0,s=this;h.each(this.keyFrames[this.segment].obj,function(t){var n=0,r=[];h.each(t.shapePoints,function(t){var a=s.keyFrames[s.segment-1].obj[i].shapePoints[n].x*(1-e)+t.x*e,h=s.keyFrames[s.segment-1].obj[i].shapePoints[n].y*(1-e)+t.y*e,c=new o(s,a,h,s.objList[i],n);r.push(c),n++});var c={shapePoints:r},l=s.keyFrames[s.segment-1].obj[i],d=l.rotation,m=t.rotation,u=m-d;Math.abs(u)>180&&(0>u?m+=360:d+=360),c.rotation=(d*(1-e)+m*e)%360,c.position=a.create(l.center.x*(1-e)+t.center.x*e,l.center.y*(1-e)+t.center.y*e),c.scale=l.scale*(1-e)+t.scale*e,s.objList[i].setState(c),i++})}setTimeout(function(){window.kit.segmentLoop()},window.kit.frameDelay)},r.prototype.initFrame=function(){if(this.keyFrames[this.segment]={},this.keyFrames[this.segment].obj=[],this.segment>0){this.keyFrames[this.segment].timing=this.keyFrames[this.segment-1].timing;for(var t=0;t<this.objList;t++)this.keyFrames[this.segment].obj[t].rotation=this.keyFrames[this.segment-1].obj[t].rotation,this.keyFrames[this.segment].obj[t].center=this.keyFrames[this.segment-1].obj[t].center,this.keyFrames[this.segment].obj[t].scale=this.keyFrames[this.segment-1].obj[t].scale}else{this.keyFrames[this.segment].timing=i.DEFAULT_LENGTH;for(var e=0;e<this.objList;e++)this.keyFrames[this.segment].obj[e].rotation=0,this.keyFrames[this.segment].obj[e].position=new a(this.objList[0].center.x,this.objList[0].center.y),this.keyFrames[this.segment].obj[e].scale=1}this.storeFrame()},r.prototype.clearScene=function(){this.objList=[],this.objTypes=[],this.resourceList={},this.backgroundImageExists=!1,this.fillImageExists=!1,this.keyFrames=[],this.segment=0,this.objList.push(new n(this,i.DEFAULT_RAYS,1,this.canvasHeight/i.DEFAULT_INNER_RADIUS_SCALAR,this.canvasHeight/i.DEFAULT_OUTER_RADIUS_SCALAR,a.create(this.midWidth,this.midHeight))),this.objTypes.push(["flower",i.DEFAULT_RAYS,1]),this.selectedObject=0,this.initFrame(),this.redraw(),this.digest()},r.prototype.storeFrame=function(){for(var t=0;t<this.objList.length;t++)this.keyFrames[this.segment].obj[t]=this.objList[t].getState();this.objList[this.selectedObject].rotation},r.prototype.removeKeyframe=function(){this.keyFrames.length<2||(h.removeArrayEntry(this.keyFrames,this.segment),this.segment===this.keyFrames.length&&this.segment--,this.setState(),this.redraw(),this.digest())},r.prototype.removeLast=function(){this.keyFrames.length<2||(h.removeArrayEntry(this.keyFrames,this.keyFrames.length-1),this.segment===this.keyFrames.length&&this.segment--,this.setState(),this.redraw(),this.digest())},r.prototype.gifInit=function(){this.encoder.setRepeat(-1),this.encoder.setDelay(this.gifFramerate),this.encoder.setSize(this.canvasWidth,this.canvasHeight),this.encoder.start(),this.sceneMode=i.SCENE_GIF,this.loopInit(),this.redraw()},r.prototype.gifComplete=function(){this.encoder.finish();var t=this.encoder.stream().getData(),e="data:image/gif;base64,"+window.encode64(t);window.open(e,"_blank"),this.sceneMode=i.SCENE_NORMAL,this.stopScene()},r.prototype.loopInit=function(){this.animationMode=!0,this.segment=0,this.loopStartTime=h.msTime(),this.segmentStartTime=this.loopStartTime,this.setTempModes(i.EDIT_NONE,!1)},r.prototype.stopScene=function(){this.restoreModes(),this.sceneReset()},r.prototype.sceneReset=function(){this.animationMode=!1,this.segment=0,this.setState(),this.redraw()},r.prototype.playSegment=function(){r.keyFrames.length<2||(r.animationMode=!0,0!==r.segment&&r.segment--,r.setState(),r.segment++,r.setTime=0,r.loopStartTime=(new Date).getTime(),r.segmentLoop())},r.prototype.setState=function(){for(var t=0;t<this.objList.length;t++)this.objList[t].setState(this.keyFrames[this.segment].obj[t])},r.prototype.selectFirst=function(){this.segment=0,this.setState()},r.prototype.selectPrev=function(){if(this.segment>0){this.segment--;for(var t=0;t<this.objList.length;t++)this.objList[t].setState(this.keyFrames[this.segment].obj[t])}},r.prototype.selectNext=function(){this.segment++,this.segment>=this.keyFrames.length?this.initFrame():this.setState()},r.prototype.selectLast=function(){this.segment=this.keyFrames.length-1,this.setState()},r.prototype.getSegment=function(){return this.initialized?this.animationMode?(this.segment+this.keyFrames.length-1)%this.keyFrames.length:this.segment:0},r}({},core,constants,util,PetalFlower,CPoint,Vector),objectEvents=function(t,e,i,s,n,o,a){"use strict";var r=e,i=i,h=s,n=n,o=o,a=a;return r.prototype.setState=function(){for(var t=0;t<this.objList.length;t++)this.objList[t].setState(this.keyFrames[this.segment].obj[t])},r.prototype.getState=function(){for(var t=0;t<this.objList.length;t++)this.keyFrames[this.segment].obj[t]=this.objList[t].getState();this.keyFrames[this.segment].timing=parseFloat(document.getElementById("length").value)},r.prototype.getRotation=function(){var t=this.keyFrames[this.segment].obj[this.selectedObject].rotation/this.constants.TWOPIDIV360;return Math.floor(100*t)/100},r.prototype.getRotationMatrix=function(t){var e=Math.cos(t),i=Math.sin(t);return[e,i,-i,e,0,0]},r.prototype.setRotation=function(t){this.objList[this.selectedObject].rotation=t,this.keyFrames[this.segment].obj[this.selectedObject].rotation=t,this.objList[this.selectedObject].allPetals=[],this.objList[this.selectedObject].createPetals(),this.redraw()},r.prototype.addFillImage=function(t){this.fillImage=new a(t),this.resourceList.fillImageSource=t},r.prototype.addBackgroundImage=function(t){this.backgroundImage=new Image,this.backgroundImage.onload=function(){window.kit.backgroundImageExists=!0,window.kit.redraw()},this.backgroundImage.src=t,this.resourceList.backgroundImageSource=t},r.prototype.updatePetalCount=function(t){var e=this.objList[this.selectedObject];e instanceof o&&(this.objList[this.selectedObject]=new o(this,t,e.radialAccent,this.canvasHeight/i.DEFAULT_INNER_RADIUS_SCALAR,this.canvasHeight/i.DEFAULT_OUTER_RADIUS_SCALAR,n.create(this.midWidth,this.midHeight)),this.objTypes[this.selectedObject][1]=t,this.objList[this.selectedObject].updateRadialPoint(),this.setState(),this.redraw())},r.prototype.updateRadialAccent=function(t){this.objTypes[this.selectedObject][2]=t;var e=this.objList[this.selectedObject];t>0&&t<e.petalCount&&(e.accentRadialPoint(t),this.setState(),this.redraw())},r.prototype.selectObject=function(t){t=parseFloat(t),this.selectedObject!==t&&t<this.objList.length&&t<this.constants.MAX_OBJECTS&&t>=0&&(this.selectedObject=t,this.redraw(),this.digest())},r.prototype.addObject=function(){if(!(this.objList.length>=i.MAX_OBJECTS)){this.objList.push(new o(this,i.DEFAULT_RAYS,1,this.canvasHeight/i.DEFAULT_INNER_RADIUS_SCALAR,this.canvasHeight/i.DEFAULT_OUTER_RADIUS_SCALAR,n.create(this.midWidth,this.midHeight))),this.objTypes.push(["flower",i.DEFAULT_RAYS,1]);for(var t=0;t<this.keyFrames.length;t++)this.keyFrames[t].obj[this.objList.length-1]=this.objList[this.objList.length-1].getState(),this.keyFrames[t].obj[this.objList.length-1].timing=document.getElementById("length").value;var e=this.objList.length-1;this.selectedObject=e,this.redraw(),this.digest()}},r.prototype.removeObject=function(){if(!(this.objList.length<2)){h.removeArrayEntry(this.objList,this.selectedObject),h.removeArrayEntry(this.objTypes,this.selectedObject);var t=this;h.each(this.keyFrames,function(e){h.removeArrayEntry(e.obj,t.selectedObject)}),this.selectedObject===this.objList.length&&this.selectedObject--,this.redraw(),this.digest()}},r.prototype.getImage=function(){this.setTempModes(i.EDIT_NONE,!1),this.redraw(),window.open(this.canvas.toDataURL("image/png")),this.restoreModes(),this.redraw()},r.prototype.setAlpha=function(t){t=h.parseFloatOrDefault(t,1),this.backgroundAlpha=t>1?1:0>t?0:t,this.redraw()},r}({},core,constants,util,Vector,PetalFlower,FillImage),settingsEvents=function(t,e,i,s,n,o){"use strict";var a=e,i=i,r=s,n=n,o=o;return a.prototype.getSettings=function(){return{backgroundColor:this.backgroundColor,backgroundAlpha:this.backgroundAlpha,lineColor:this.lineColor,sourceMode:this.sourceMode,seamlessAnimation:this.seamlessAnimation}},a.prototype.loadData=function(t){this.objList=[],this.objTypes=[],this.resourceList=t[1],this.objTypes=t[2],this.keyFrames=t[3],this.objList=[];for(var e=0;e<this.objTypes.length;e++)"flower"===this.objTypes[e][0]&&this.objList.push(new n(this,this.objTypes[e][1],this.objTypes[e][2],this.canvasHeight/i.DEFAULT_INNER_RADIUS_SCALAR,this.canvasHeight/i.DEFAULT_OUTER_RADIUS_SCALAR,o.create(this.midWidth,this.midHeight)));this.options=t[0],this.backgroundColor=r.exists(this.options.backgroundColor)?this.options.backgroundColor:i.BACKGROUND_COLOR,this.backgroundAlpha=r.exists(this.options.backgroundAlpha)?this.options.backgroundAlpha:i.BACKGROUND_ALPHA,this.lineColor=r.exists(this.options.lineColor)?this.options.lineColor:i.LINE_COLOR,this.currentSelector="bg-color",window.setColor("#"+this.backgroundColor),this.currentSelector="line-color",window.setColor("#"+this.lineColor),this.sourceMode=r.exists(this.options.sourceMode)?this.options.sourceMode:i.SOURCE_MODE,this.seamlessAnimation=r.exists(this.options.seamlessAnimation)?this.options.seamlessAnimation:!0,this.backgroundImageExists=!1,this.fillImageExists=!1,"string"==typeof this.resourceList.backgroundImageSource&&this.addBackgroundImage(this.resourceList.backgroundImageSource),"string"==typeof this.resourceList.fillImageSource&&this.addFillImage(this.resourceList.fillImageSource),this.selectedObject=0,this.segment=0,this.setState()},a.prototype.setTempModes=function(t,e){this.settingShelf={editMode:this.editMode,toggleCurveColor:this.toggleCurveColor},this.editMode=t,this.toggleCurveColor=e},a.prototype.restoreModes=function(){this.editMode=this.settingShelf.editMode,this.toggleCurveColor=this.settingShelf.toggleCurveColor},a}({},core,constants,util,PetalFlower,Vector),src_app=function(t,e){"use strict";var i=e,s=function(){window.kit=new i,initKeyboard(),i.encoder=new GIFEncoder,setTimeout(window.initInterface,400)};return"complete"===document.readyState?s():window.addEventListener("load",s,!1),window.kit}({},core,constants,Vector,CPoint,Transform,FillImage,PetalFlower,canvasEvents,sceneEvents,objectEvents,settingsEvents);