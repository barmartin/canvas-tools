/*! cKit.min.js v0.0.3 October 23, 2014 */

var constants=function(){var t=Math.PI;return{SCENE_NORMAL:0,SCENE_GIF:1,PI:t,TWOPIDIV360:2*Math.PI/360,MAX_OBJECTS:4}}({}),Vector=function(){"use strict";return{create:function(t,i){return{x:t||-1,y:i||-1}},multiply:function(t,i){return t.x*=i,t.y*=i,t},add:function(t,i){return t.x+=i.x,t.y+=i.y,t},getPoint:function(t,i,e,s){var o=t+e*Math.sin(s),n=i-e*Math.cos(s),h=this.create(o,n);return h},rotate:function(t,i,e,s){var o=Math.cos(s),n=Math.sin(s),h=o*(e.x-t)-n*(e.y-i)+t,r=n*(e.x-t)+o*(e.y-i)+i;return this.create(h,r)},distance:function(t,i){var e=t.x-i.x,s=t.y-i.y;return Math.sqrt(e*e+s*s)}}}({}),CPoint=function(t,i){"use strict";var i=i,e=function(t,e,s,o,n){this.kit=t,this.x=e,this.y=s,this.index=n,this.inDrag=!1,this.draw=function(){if(this.kit.inCurveEditMode){var e=this.kit.Vector.rotate(t.midWidth,t.midHeight,this,o.rotation*i.TWOPIDIV360);if(this.inDrag)if(1===n){var s=this.kit.Vector.rotate(t.midWidth,t.midHeight,o.controlPoints[0],o.rotation*i.TWOPIDIV360);t.context.beginPath(),t.context.moveTo(e.x,e.y),t.context.lineTo(s.x,s.y),t.context.stroke()}else if(2===n){var h=this.kit.Vector.rotate(t.midWidth,t.midHeight,o.controlPoints[3],o.rotation*i.TWOPIDIV360);t.context.beginPath(),t.context.moveTo(e.x,e.y),t.context.lineTo(h.x,h.y),t.context.stroke()}t.context.beginPath(),t.context.arc(e.x,e.y,this.kit.controlPointRadius,0,2*Math.PI,!0),t.context.closePath(),t.context.lineWidth=1,this.inDrag?(t.context.fillStyle="#999999",t.context.fill()):(t.context.fillStyle="#FFFFFF",t.context.fill()),t.context.stroke()}},this.mouseInside=function(t){return this.kit.controlPointRadius+2>this.kit.Vector.distance(t,this)}};return e}({},constants),PedalFlower=function(t,i,e){"use strict";var i=i,e=e,s=function(t,i,s,o){this.kit=t,this.rotation=0,this.pedalCount=i,this.increment=2*Math.PI/i,this.firstInnerAngle=-.5*this.increment,this.innerRadius=s,this.outerRadius=o,this.allPedals=[],this.firstPedal=[],this.controlPoints=[],this.thisAngle=0;var n,h,r,a;if(8===this.kit.curve.length)n=this.kit.Vector.create(t.curve[0],this.kit.curve[1]),h=this.kit.Vector.create(t.curve[2],this.kit.curve[3]),r=this.kit.Vector.create(t.curve[4],this.kit.curve[5]),a=this.kit.Vector.create(t.curve[6],this.kit.curve[7]);else{n=this.kit.Vector.getPoint(this.kit.midWidth,this.kit.midHeight,this.innerRadius,this.firstInnerAngle);var c=(this.outerRadius-this.innerRadius)/2+this.innerRadius;h=this.kit.Vector.getPoint(this.kit.midWidth,this.kit.midHeight,c,this.firstInnerAngle),r=this.kit.Vector.getPoint(this.kit.midWidth,this.kit.midHeight,this.outerRadius,this.thisAngle),r.x=r.x-40,a=this.kit.Vector.getPoint(this.kit.midWidth,this.kit.midHeight,this.outerRadius,this.thisAngle)}this.firstPedal.push(n),this.controlPoints.push(new e(t,n.x,n.y,this,0)),this.controlPoints.push(new e(t,h.x,h.y,this,1)),this.firstPedal.push(h),this.controlPoints.push(new e(t,r.x,r.y,this,2)),this.firstPedal.push(r),this.controlPoints.push(new e(t,a.x,a.y,this,3)),this.firstPedal.push(a),this.firstPedal.push(this.kit.Vector.create(-1*(r.x-this.kit.midWidth)+this.kit.midWidth,r.y)),this.firstPedal.push(this.kit.Vector.create(-1*(h.x-this.kit.midWidth)+this.kit.midWidth,h.y)),this.firstPedal.push(this.kit.Vector.create(-1*(n.x-this.kit.midWidth)+this.kit.midWidth,n.y)),this.createPedals()};return s.prototype.createPedals=function(){this.allPedals.push(this.firstPedal);for(var t=this.kit,i=1;i<this.pedalCount;i++){this.thisAngle=i*this.increment;var e=[],s=this.thisAngle;t.each(this.firstPedal,function(i){var o=t.Vector.rotate(t.midWidth,t.midHeight,i,s);e.push(o)}),this.allPedals.push(e)}},s.prototype.updatePedal=function(t,i){var e=this.kit.Vector.create(i.x,i.y);e.x<10&&(e.x=10),e.x>this.kit.canvasWidth-10&&(e.x=this.kit.canvasWidth-10),e.y<10&&(e.y=10),e.y>this.kit.canvasWidth-10&&(e.y=this.kit.canvasHeight-10),3===t?(e.x=this.kit.canvasWidth/2,this.firstPedal[3].x=e.x,this.firstPedal[t].y=i.y):0===t?(this.innerRadius=this.kit.Vector.distance(this.kit.Vector.create(this.kit.midWidth,this.kit.midHeight),this.kit.Vector.create(i.x,i.y)),e=this.kit.Vector.getPoint(this.kit.midWidth,this.kit.midHeight,this.innerRadius,this.firstInnerAngle),this.firstPedal[0].x=e.x,this.firstPedal[0].y=e.y,this.firstPedal[6].x=2*this.kit.canvasWidth/2-e.x,this.firstPedal[6].y=e.y):(this.firstPedal[t].x=i.x,this.firstPedal[6-t].x=2*this.kit.canvasWidth/2-i.x,this.firstPedal[6-t].y=i.y,this.firstPedal[t].y=i.y),this.allPedals=[],this.createPedals(),this.controlPoints[t].x=e.x,this.controlPoints[t].y=e.y},s.prototype.updateFirstPedal=function(){this.firstPedal[0].x=this.controlPoints[0].x,this.firstPedal[0].y=this.controlPoints[0].y,this.firstPedal[1].x=this.controlPoints[1].x,this.firstPedal[1].y=this.controlPoints[1].y,this.firstPedal[2].x=this.controlPoints[2].x,this.firstPedal[2].y=this.controlPoints[2].y,this.firstPedal[3].x=this.controlPoints[3].x,this.firstPedal[3].y=this.controlPoints[3].y,this.firstPedal[4].x=-1*(this.controlPoints[2].x-this.kit.midWidth)+this.kit.midWidth,this.firstPedal[4].y=this.controlPoints[2].y,this.firstPedal[5].x=-1*(this.controlPoints[1].x-this.kit.midWidth)+this.kit.midWidth,this.firstPedal[5].y=this.controlPoints[1].y,this.firstPedal[6].x=-1*(this.controlPoints[0].x-this.kit.midWidth)+this.kit.midWidth,this.firstPedal[6].y=this.controlPoints[0].y},s.prototype.setControlPoint=function(t,i){this.controlPoints[this.kit.indexOf(this.controlPoints,t)]=i},s.prototype.draw=function(){var t=0,e=this,s=this.kit;s.each(this.allPedals,function(o){if(0===t&&s.toggleCurveColor&&(s.context.strokeStyle="#00ff00"),s.context.lineWidth=1,s.context.beginPath(),0===e.rotation)s.context.moveTo(o[0].x,o[0].y),s.context.bezierCurveTo(o[1].x,o[1].y,o[2].x,o[2].y,o[3].x,o[3].y),s.context.stroke(),s.context.bezierCurveTo(o[4].x,o[4].y,o[5].x,o[5].y,o[6].x,o[6].y);else{for(var n=[],h=0;h<o.length;h++)n.push(s.Vector.rotate(s.midWidth,s.midHeight,o[h],e.rotation*i.TWOPIDIV360));s.context.moveTo(n[0].x,n[0].y),s.context.bezierCurveTo(n[1].x,n[1].y,n[2].x,n[2].y,n[3].x,n[3].y),s.context.stroke(),s.context.bezierCurveTo(n[4].x,n[4].y,n[5].x,n[5].y,n[6].x,n[6].y)}s.context.closePath(),s.context.stroke(),s.context.strokeStyle="#"+s.lineColor,t++});var o=this.controlPoints;s.indexOf(s.objList,this)===s.selectedObject&&s.each(this.controlPoints,function(t){t.draw(o)})},s.prototype.getState=function(){var t=[],i=this.kit;return i.each(this.controlPoints,function(e){t.push(i.Vector.create(e.x,e.y))}),{controlPoints:t,rotation:this.rotation}},s.prototype.setState=function(t){var i=this.kit;this.rotation=t.rotation,i.index=0,i.each(this.controlPoints,function(e){e.x=t.controlPoints[i.index].x,e.y=t.controlPoints[i.index].y,i.index++}),this.allPedals=[],this.updateFirstPedal(),this.createPedals(),i.redraw()},s}({},constants,CPoint),core=function(t,i,e,s,o){"use strict";var i=i,e=e,s=s,o=o,n=function(){this.constants=i,this.canvas=document.getElementById("myCanvas"),this.context="",this.canvasMode="static",this.keyFrames=[],this.updateMode=!1,this.animationMode=!1,this.segmentStartTime=0,this.segment=0,this.loopStartTime=0,this.setTime=0,this.pauseTime=200,this.frameDelay=15,this.savedSettings={},this.delta=-this.frameDelay,this.Vector=e,this.sceneMode=i.SCENE_NORMAL,this.encoder=11,this.delayTime=0,this.initList=["flower"],this.curve=[],this.k=6,this.pattern=null,this.bodybg="020202",this.selectedObject=0,this.controlPointRadius=6,this.canvasWidth=640,this.canvasHeight=640,this.midWidth=this.canvasWidth/2,this.midHeight=this.canvasHeight/2,this.inCurveEditMode=!0,this.toggleCurveColor=!1,this.objList=[],this.objTypes=[],this.initializeCanvas=function(){this.initConstants(),this.bindEvents(),this.context=this.canvas.getContext("2d");var t=document.getElementById("k");t.value=this.k,0===this.objList.length?this.build():this.setState(),this.redraw(),this.initFrame()},this.initConstants=function(){if(this.dnexist(this.k)&&(this.k=6),this.dnexist(this.backgroundColor)&&(this.backgroundColor="010201"),this.dnexist(this.backgroundAlpha)?this.backgroundAlpha=1:document.getElementById("bgAlpha").value=this.backgroundAlpha,this.dnexist(this.lineColor)&&(this.lineColor="8fa4f4"),this.exists(this.positions)){if(24!==this.positions.length)return;this.curve.push(this.validateInt(this.positions.substring(0,3))),this.curve.push(this.validateInt(this.positions.substring(3,6))),this.curve.push(this.validateInt(this.positions.substring(6,9))),this.curve.push(this.validateInt(this.positions.substring(9,12))),this.curve.push(this.validateInt(this.positions.substring(12,15))),this.curve.push(this.validateInt(this.positions.substring(15,18))),this.curve.push(this.validateInt(this.positions.substring(18,21))),this.curve.push(this.validateInt(this.positions.substring(21,24)))}},this.build=function(){var t=this;this.each(this.range(0,this.initList.length),function(i){"polar"===t.initList[i]||"flower"===t.initList[i]&&(t.objList.push(new o(t,t.k,20,250,"seperated")),t.objTypes.push(["flower",t.k]))})},this.redraw=function(){this.context.save(),this.context.setTransform(1,0,0,1,0,0),this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.context.restore(),this.context.strokeStyle="#"+this.lineColor;var t=this.toRGB(this.backgroundColor);this.context.fillStyle="rgba("+t[0]+", "+t[1]+", "+t[2]+", "+this.backgroundAlpha+")",this.context.fillRect(0,0,this.canvasWidth,this.canvasHeight),this.each(this.objList,function(t){t.draw()})},this.update=function(){var t=document.getElementById("k").value;isNaN(t)||(this.objList[this.selectedObject]=new o(this,t,20,this.canvasHeight/6*2.5,"seperated"),this.objTypes[this.selectedObject][1]=t,this.setState(),this.redraw())},this.initFrame=function(){this.keyFrames[this.segment]={},this.keyFrames[this.segment].obj=[],this.setFrame()},this.setState=function(){for(var t=0;t<this.objList.length;t++)this.objList[t].setState(this.keyFrames[this.segment].obj[t])},this.getState=function(){for(var t=0;t<this.objList.length;t++)this.keyFrames[this.segment].obj[t]=this.objList[t].getState();this.keyFrames[this.segment].timing=parseFloat(document.getElementById("length").value)},this.initializeCanvas()};n.prototype.addObject=function(){if(!(this.objList.length>=i.MAX_OBJECTS)){this.objList.push(new o(this,this.k,20,250,"seperated")),this.objTypes.push(["flower",this.k]);for(var t=0;t<this.keyFrames.length;t++)this.keyFrames[t].obj[this.objList.length-1]=this.objList[this.objList.length-1].getState(),this.keyFrames[t].obj[this.objList.length-1].timing=document.getElementById("length").value;var e=this.objList.length-1;this.selectedObject=e,this.redraw()}},n.prototype.cpFormat=function(t){return 10>t?"00"+Math.floor(t):100>t?"0"+Math.floor(t):Math.floor(t).toString()},n.prototype.getPosition=function(t){var i=this.canvas.getBoundingClientRect();return{x:t.clientX-i.left,y:t.clientY-i.top}},Array.prototype.insert=function(t,i){this.splice(t,0,i)},n.prototype.clone=function(t){if(null==t||"object"!=typeof t)return t;var i=t.constructor();for(var e in t)t.hasOwnProperty(e)&&(i[e]=t[e]);return i},n.prototype.dnexist=function(t){return"undefined"==typeof t},n.prototype.exists=function(t){return"undefined"!=typeof t},n.prototype.encodeToHex=function(t){return parseInt(255*t).toString(16)},n.prototype.decodeFromHex=function(t){return parseInt(t,16)},n.prototype.validateInt=function(t){return parseInt(t)},n.prototype.toRGB=function(t){return[this.decodeFromHex(t.substring(0,2)),this.decodeFromHex(t.substring(2,4)),this.decodeFromHex(t.substring(4,6))]},n.prototype.msTime=function(){return(new Date).getTime()},n.prototype.each=function(t,i){if(null==t)return t;var e,s=t.length;if(s===+s)for(e=0;s>e;e++)i(t[e],e,t);return t},n.prototype.range=function(t,i){for(var e=[],s=t;i>s;s++)e.push(s);return e},n.prototype.indexOf=function(t,i){for(var e=0;e<t.length;e++)if(t[e]===i)return e;return console.log("Item not Found, IndexOf (likely bug)"),-1},n.prototype.startDrag=function(t){var i=window.kit;i.position=i.getPosition(t),i.debugConsole("startDrag x:"+i.position.x+" y:"+i.position.y);var e=i.Vector.rotate(i.midWidth,i.midHeight,i.position,-i.objList[i.selectedObject].rotation*i.constants.TWOPIDIV360);i.each(i.objList[i.selectedObject].controlPoints,function(t){return t.mouseInside(e)?(t.inDrag=!0,i.canvasMode="cpDrag",void i.redraw()):void 0})},n.prototype.endDrag=function(t){var i=window.kit;i.canvasMode="static",i.position=i.getPosition(t),i.debugConsole("endDrag x:"+i.position.x+" y:"+i.position.y),window.each(i.objList,function(t){window.each(t.controlPoints,function(t){t.inDrag===!0&&(t.inDrag=!1,i.redraw())})}),i.getState()},n.prototype.move=function(t){var i=window.kit;"cpDrag"===i.canvasMode&&(i.position=i.getPosition(t),i.each(i.objList,function(t){var e=0;i.each(t.controlPoints,function(o){if(o.inDrag){var n=i.Vector.rotate(i.midWidth,i.midHeight,i.position,-i.objList[0].rotation*i.constants.TWOPIDIV360),h=new s(i,n.x,n.y,t,e);return h.inDrag=!0,t.updatePedal(e,h),i.debugConsole("newPoint.x/y::"+n.x+"/"+n.y+" indexof::"+i.indexOf(t.controlPoints,o)+" object type:"+t.type+"</p>"),void i.redraw()}e++})}),i.debugConsole("mousemove x:"+i.position.x+" y:"+i.position.y))},n.prototype.bindEvents=function(){this.canvas.addEventListener("touchstart",this.startDrag,!1),this.canvas.addEventListener("touchend",this.endDrag,!1),this.canvas.addEventListener("touchmove",this.move,!1),this.canvas.addEventListener("mousedown",this.startDrag,!1),this.canvas.addEventListener("mouseup",this.endDrag,!1),this.canvas.addEventListener("mousemove",this.move,!1)},n.prototype.setFrame=function(){for(var t=0;t<this.objList.length;t++)this.keyFrames[this.segment].obj[t]=this.objList[t].getState();this.keyFrames[this.segment].timing=parseFloat(document.getElementById("length").value);var i=document.getElementById("rotation").value;this.keyFrames[this.segment].obj[this.selectedObject].rotation=parseFloat(i)},n.prototype.setupGif=function(){},n.prototype.gripImg=function(){},n.prototype.gifInit=function(){},n.prototype.gifComplete=function(){},n.prototype.loopInit=function(){this.animationMode=!0,this.segment=0,this.loopStartTime=this.msTime(),this.segmentStartTime=this.loopStartTime},n.prototype.sceneReset=function(){this.animationMode=!1;for(var t=0;t<this.objList.length;t++)this.objList[t].setState(this.keyFrames[0].obj[t]);this.segment=0,this.redraw()},n.prototype.sceneLoop=function(){if(!this.animationMode)return this.segment=0,void this.setState();if(this.sceneMode===i.SCENE_GIF?this.delta+=this.frameDelay:this.delta=this.msTime()-this.segmentStartTime,0===this.segment&&this.delta>=this.pauseTime)this.segment=1,this.delta=0,this.segmentStartTime=this.msTime();else if(0!==this.segment)if(this.delta>1e3*this.keyFrames[this.segment-1].timing)if(this.segment<this.keyFrames.length)this.setState(),this.segment++,this.sceneMode===this.GIF?this.delta=0:this.segmentStartTime=this.msTime();else{if(this.sceneMode===i.SCENE_GIF)return void this.gifComplete();this.segment=0,this.setState(),this.segmentStartTime=this.msTime()}else this.updateSegment(this.delta);this.sceneMode===i.SCENE_GIF?setTimeout(function(){window.kit.sceneLoop()},1):setTimeout(function(){window.kit.sceneLoop()},window.kit.frameDelay)},n.prototype.updateSegment=function(t){var i=this.segment;this.segment===this.keyFrames.length&&(i=0);var e=t/(1e3*this.keyFrames[i].timing),o=0,n=this;this.each(this.keyFrames[i].obj,function(t){var h=0,r=[];n.each(t.controlPoints,function(t){var i=n.keyFrames[n.segment-1].obj[o].controlPoints[h].x*(1-e)+t.x*e,a=n.keyFrames[n.segment-1].obj[o].controlPoints[h].y*(1-e)+t.y*e,c=new s(n,i,a,n.objList[o],h);r.push(c),h++});var a={controlPoints:r},c=n.keyFrames[n.segment-1].obj[o].rotation,d=n.keyFrames[i].obj[o].rotation,l=d-c;Math.abs(l)>180&&(0>l?d+=360:c+=360),a.rotation=(c*(1-e)+d*e)%360,n.objList[o].setState(a),o++})},n.prototype.segmentLoop=function(){if(!this.animationMode||0===this.segment)return void this.setState();var t=this.msTime()-this.loopStartTime-this.pauseTime;if(0>t)0!==this.setTime&&(this.segment--,this.setState(),this.segment++,this.setTime=0);else if(t>1e3*this.keyFrames[this.segment].timing)t>1e3*this.keyFrames[this.segment].timing+this.pauseTime?(this.loopStartTime=this.msTime(),this.segment--,this.setState(),this.segment++,this.setTime=0):this.setTime!==1e3*this.keyFrames[this.segment].timing&&(this.setState(),this.setTime=1e3*this.keyFrames[this.segment].timing);else{var i=t/(1e3*this.keyFrames[this.segment].timing),e=0,o=this;this.each(this.keyFrames[this.segment].obj,function(t){var n=0,h=[];o.each(t.controlPoints,function(t){var r=o.keyFrames[o.segment-1].obj[e].controlPoints[n].x*(1-i)+t.x*i,a=o.keyFrames[o.segment-1].obj[e].controlPoints[n].y*(1-i)+t.y*i,c=new s(o,r,a,o.objList[e],n);h.push(c),n++});var r={controlPoints:h},a=o.keyFrames[o.segment-1].obj[e].rotation,c=o.keyFrames[o.segment].obj[e].rotation,d=c-a;Math.abs(d)>180&&(0>d?c+=360:a+=360),r.rotation=(a*(1-i)+c*i)%360,o.objList[e].setState(r),e++})}setTimeout(function(){window.kit.segmentLoop()},window.kit.frameDelay)},n.prototype.loadData=function(t){this.objList=[],this.objTypes=[],this.keyFrames=t[2],this.objTypes=t[1],this.objList=[];for(var i=0;i<this.objTypes.length;i++)"flower"===this.objTypes[i][0]?this.objList.push(new o(this,this.objTypes[i][1],20,250,"seperated")):"polar"===this.objTypes[i][0];for(var e=1;e<this.objList.length+1;e++);this.selectedObject=0,this.options=t[0],this.currentSelector="bg-color",this.backgroundColor=this.options.backgroundColor,this.preinit||window.setColor("#"+this.backgroundColor),this.backgroundAlpha=this.options.backgroundAlpha,this.lineColor=this.options.lineColor,this.currentSelector="line-color",this.preinit||window.setColor("#"+this.lineColor),this.segment=0,this.setState(),this.redraw(),window.updateInterface()},n.prototype.debugConsole=function(t){var i=document.getElementById("console");i.firstChild&&i.removeChild(i.firstChild),i.appendChild(document.createTextNode(t))},n.prototype.addEventHandler=function(t,i,e,s){this.exists(t.attachEvent)?t.attachEvent("on"+i,e):t.addEventListener(i,e,s)},n.prototype.setUpClickEvent=function(){this.addEventHandler(document.getElementById("clickLink"),"click",this.onLinkClicked,!1)},n.prototype.removeEventHandler=function(){n.exists(window.event)};for(var h in n.prototype)"function"==typeof n.prototype[h]&&(window[h]=n.prototype[h]);return n.prototype._preloadMethods=[],n.prototype._registeredMethods={pre:[],post:[],remove:[]},n.prototype.registerPreloadMethod=function(t){n.prototype._preloadMethods.push(t)}.bind(this),n.prototype.registerMethod=function(t,i){n.prototype._registeredMethods.hasOwnProperty(t)||(n.prototype._registeredMethods[t]=[]),n.prototype._registeredMethods[t].push(i)}.bind(this),n}({},constants,Vector,CPoint,PedalFlower),src_app=function(t,i){"use strict";var e=i,s=function(){window.kit=new e,window.initInterface()};return"complete"===document.readyState?s():window.addEventListener("load",s,!1),window.kit}({},core,constants,Vector,CPoint,PedalFlower);