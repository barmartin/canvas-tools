/*! cKit.min.js v0.2.3 November 09, 2014 */

var constants=function(){var t=Math.PI;return{SCENE_NORMAL:0,SCENE_GIF:1,PI:t,TWOPIDIV360:2*Math.PI/360,MAX_OBJECTS:4,DEFAULT_RAYS:6,DEFAULT_INNER_RADIUS_SCALAR:17,DEFAULT_OUTER_RADIUS_SCALAR:2.2,MAX_CLICK_DISTANCE:2,SOURCE_MODES:{lighter:"lighter",darker:"darker",xor:"xor","source-atop":"atop","source-out":"out","source-over":"over","destination-atop":"bottom","destination-out":"bottom-out"}}}({}),Vector=function(){"use strict";return{create:function(t,e){return{x:t||-1,y:e||-1}},multiply:function(t,e){return t.x*=e,t.y*=e,t},add:function(t,e){return t.x+=e.x,t.y+=e.y,t},getPoint:function(t,e,i,s){var n=t+i*Math.sin(s),o=e-i*Math.cos(s),r=this.create(n,o);return r},getPolarPoint:function(t,e,i){var s=t.x+e*Math.sin(i),n=t.y-e*Math.cos(i),o=this.create(s,n);return o},rotate:function(t,e,i,s){var n=Math.cos(s),o=Math.sin(s),r=n*(i.x-t)-o*(i.y-e)+t,h=o*(i.x-t)+n*(i.y-e)+e;return this.create(r,h)},distance:function(t,e){var i=t.x-e.x,s=t.y-e.y;return Math.sqrt(i*i+s*s)}}}({}),CPoint=function(t,e,i){"use strict";var e=e,i=i,s=function(t,s,n,o,r){this.kit=t,this.x=s,this.y=n,this.index=r,this.inDrag=!1,this.draw=function(){if(this.kit.inCurveEditMode){var i=this.kit.Vector.rotate(t.midWidth,t.midHeight,this,o.rotation*e.TWOPIDIV360);if(t.constrain(i),this.inDrag)if(1===this.index){var s=this.kit.Vector.rotate(t.midWidth,t.midHeight,o.controlPoints[0],o.rotation*e.TWOPIDIV360);t.context.beginPath(),t.context.moveTo(i.x,i.y),t.context.lineTo(s.x,s.y),t.context.stroke()}else if(2===this.index){var n=this.kit.Vector.rotate(t.midWidth,t.midHeight,o.controlPoints[3],o.rotation*e.TWOPIDIV360);t.context.beginPath(),t.context.moveTo(i.x,i.y),t.context.lineTo(n.x,n.y),t.context.stroke()}t.context.beginPath(),t.context.arc(i.x,i.y,this.kit.controlPointRadius,0,2*Math.PI,!0),t.context.closePath(),t.context.lineWidth=1,this.inDrag?(t.context.fillStyle="#999999",t.context.fill()):(t.context.fillStyle="#FFFFFF",t.context.fill()),t.context.stroke()}},this.mouseInside=function(t){return this.kit.controlPointRadius+e.MAX_CLICK_DISTANCE>i.distance(t,this)}};return s}({},constants,Vector),util=function(){"use strict";return{getPosition:function(t,e){var i=e.getBoundingClientRect();return{x:t.clientX-i.left,y:t.clientY-i.top}},clone:function(t){if(null==t||"object"!=typeof t)return t;var e=t.constructor();for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);return e},dnexist:function(t){return"undefined"==typeof t},exists:function(t){return"undefined"!=typeof t},encodeToHex:function(t){return parseInt(255*t).toString(16)},decodeFromHex:function(t){return parseInt(t,16)},validateInt:function(t){return parseInt(t)},validateFloat:function(t){return parseFloat(t)},toRGB:function(t){return[this.decodeFromHex(t.substring(0,2)),this.decodeFromHex(t.substring(2,4)),this.decodeFromHex(t.substring(4,6))]},msTime:function(){return(new Date).getTime()},each:function(t,e){if(null==t)return t;var i,s=t.length;if(s===+s)for(i=0;s>i;i++)e(t[i],i,t);else{var n=window.kit._u.getKeys(t);for(i=0,s=n.length;s>i;i++)e(t[n[i]],n[i],t)}return t},getKeys:function(t){var e=[];for(var i in t)t.hasOwnProperty(i)&&e.push(i);return e},range:function(t,e){for(var i=[],s=t;e>s;s++)i.push(s);return i},indexOf:function(t,e){for(var i=0;i<t.length;i++)if(t[i]===e)return i;return console.log("Item not Found, IndexOf (should not happen with current config)"),-1},removeArrayEntry:function(t,e){t.splice(e,1)},debugConsole:function(t){var e=document.getElementById("console");e.firstChild&&e.removeChild(e.firstChild),e.appendChild(document.createTextNode(t))}}}({}),PetalFlower=function(t,e,i,s,n){"use strict";var e=e,i=i,s=s,o=n,r=function(t,e,n,o,r,h){this.kit=t,this.rotation=0,this.petalCount=e,this.radialAccent=n,this.increment=2*Math.PI/e,this.firstInnerAngle=-.5*this.increment*n,this.innerRadius=o,this.outerRadius=r,this.center=h,this.allPetals=[],this.firstPetal=[],this.controlPoints=[],this.thisAngle=0;var a,c,l,u;if(8===this.kit.curve.length)a=s.create(t.curve[0],this.kit.curve[1]),c=s.create(t.curve[2],this.kit.curve[3]),l=s.create(t.curve[4],this.kit.curve[5]),u=s.create(t.curve[6],this.kit.curve[7]);else{a=s.getPoint(this.center.x,this.center.y,this.innerRadius,this.firstInnerAngle);var d=(this.outerRadius-this.innerRadius)/2+this.innerRadius;c=s.getPoint(this.center.x,this.center.y,d,this.firstInnerAngle),l=s.getPoint(this.center.x,this.center.y,this.outerRadius,this.thisAngle),l.x=l.x-40,u=s.getPoint(this.center.x,this.center.y,this.outerRadius,this.thisAngle)}this.firstPetal.push(a),this.controlPoints.push(new i(t,a.x,a.y,this,0)),this.controlPoints.push(new i(t,c.x,c.y,this,1)),this.firstPetal.push(c),this.controlPoints.push(new i(t,l.x,l.y,this,2)),this.firstPetal.push(l),this.controlPoints.push(new i(t,u.x,u.y,this,3)),this.firstPetal.push(u),this.firstPetal.push(s.create(-1*(l.x-this.center.x)+this.center.x,l.y)),this.firstPetal.push(s.create(-1*(c.x-this.center.x)+this.center.x,c.y)),this.firstPetal.push(s.create(-1*(a.x-this.center.x)+this.center.x,a.y)),this.createPetals()};return r.prototype.createPetals=function(){this.allPetals.push(this.firstPetal);for(var t=1;t<this.petalCount;t++){this.thisAngle=t*this.increment;var e=[],i=this.thisAngle,n=this;o.each(this.firstPetal,function(t){var o=s.rotate(n.center.x,n.center.y,t,i);e.push(o)}),this.allPetals.push(e)}},r.prototype.updatePetal=function(t,e){var i=s.create(e.x,e.y);i.x<10&&(i.x=10),i.x>this.kit.canvasWidth-10&&(i.x=this.kit.canvasWidth-10),i.y<10&&(i.y=10),i.y>this.kit.canvasWidth-10&&(i.y=this.kit.canvasHeight-10),3===t?(i.x=this.kit.canvasWidth/2,this.firstPetal[3].x=i.x,this.firstPetal[t].y=e.y):0===t?(this.innerRadius=s.distance(s.create(this.center.x,this.center.y),s.create(e.x,e.y)),i=s.getPoint(this.center.x,this.center.y,this.innerRadius,this.firstInnerAngle),this.firstPetal[0].x=i.x,this.firstPetal[0].y=i.y,this.firstPetal[6].x=2*this.kit.canvasWidth/2-i.x,this.firstPetal[6].y=i.y):(this.firstPetal[t].x=e.x,this.firstPetal[6-t].x=2*this.kit.canvasWidth/2-e.x,this.firstPetal[6-t].y=e.y,this.firstPetal[t].y=e.y),this.allPetals=[],this.createPetals(),this.controlPoints[t].x=i.x,this.controlPoints[t].y=i.y},r.prototype.updateFirstPetal=function(){this.firstPetal[0].x=this.controlPoints[0].x,this.firstPetal[0].y=this.controlPoints[0].y,this.firstPetal[1].x=this.controlPoints[1].x,this.firstPetal[1].y=this.controlPoints[1].y,this.firstPetal[2].x=this.controlPoints[2].x,this.firstPetal[2].y=this.controlPoints[2].y,this.firstPetal[3].x=this.controlPoints[3].x,this.firstPetal[3].y=this.controlPoints[3].y,this.firstPetal[4].x=-1*(this.controlPoints[2].x-this.center.x)+this.center.x,this.firstPetal[4].y=this.controlPoints[2].y,this.firstPetal[5].x=-1*(this.controlPoints[1].x-this.center.x)+this.center.x,this.firstPetal[5].y=this.controlPoints[1].y,this.firstPetal[6].x=-1*(this.controlPoints[0].x-this.center.x)+this.center.x,this.firstPetal[6].y=this.controlPoints[0].y},r.prototype.setControlPoint=function(t,e){this.controlPoints[this.kit.indexOf(this.controlPoints,t)]=e},r.prototype.draw=function(){var t=0,i=this,n=this.kit;n.context.save(),n.context.beginPath(),o.each(this.allPetals,function(o){if(n.context.lineWidth=1,0===i.rotation)n.context.moveTo(o[0].x,o[0].y),n.context.bezierCurveTo(o[1].x,o[1].y,o[2].x,o[2].y,o[3].x,o[3].y),n.context.bezierCurveTo(o[4].x,o[4].y,o[5].x,o[5].y,o[6].x,o[6].y),n.context.moveTo(o[6].x,o[6].y),n.context.lineTo(o[0].x,o[0].y);else{for(var r=[],h=0;h<o.length;h++)r.push(s.rotate(i.center.x,i.center.y,o[h],i.rotation*e.TWOPIDIV360));n.context.moveTo(r[0].x,r[0].y),n.context.bezierCurveTo(r[1].x,r[1].y,r[2].x,r[2].y,r[3].x,r[3].y),n.context.bezierCurveTo(r[4].x,r[4].y,r[5].x,r[5].y,r[6].x,r[6].y),n.context.moveTo(r[6].x,r[6].y),n.context.lineTo(r[0].x,r[0].y)}t++}),n.context.closePath(),n.fillImageExists?(n.context.globalCompositeOperation=n.sourceMode,n.context.clip(),n.context.drawImage(n.fillImage,0,0,n.canvasWidth,n.canvasHeight),n.toggleCurveColor===!0&&(n.context.globalCompositeOperation="source-over",n.context.lineWidth=1.9,n.context.stroke())):(n.context.globalCompositeOperation="source-over",n.context.stroke()),n.context.restore()},r.prototype.updateRadialPoint=function(){this.increment=2*Math.PI/this.petalCount,this.firstInnerAngle=-.5*this.increment*this.radialAccent;var t=this.kit,e=this;o.each(t.keyFrames,function(i){var n=i.obj[t.selectedObject].controlPoints[0],o=s.distance(e.center,s.create(n.x,n.y)),r=s.getPolarPoint(e.center,o,e.firstInnerAngle);n.x=r.x,n.y=r.y})},r.prototype.accentRadialPoint=function(t){this.radialAccent=t,this.increment=2*Math.PI/this.petalCount,this.firstInnerAngle=-.5*this.increment*t;var e=this.kit,i=this;o.each(e.keyFrames,function(t){var n=t.obj[e.selectedObject].controlPoints[0],o=s.distance(i.center,s.create(n.x,n.y)),r=s.getPolarPoint(i.center,o,i.firstInnerAngle);n.x=r.x,n.y=r.y})},r.prototype.drawControlPoints=function(){var t=this.controlPoints;o.each(t,function(e){e.draw(t)})},r.prototype.getState=function(){var t=[];return o.each(this.controlPoints,function(e){t.push(s.create(e.x,e.y))}),{controlPoints:t,rotation:this.rotation}},r.prototype.setState=function(t){var e=this.kit;this.rotation=t.rotation,e.index=0,o.each(this.controlPoints,function(i){i.x=t.controlPoints[e.index].x,i.y=t.controlPoints[e.index].y,e.index++}),this.allPetals=[],this.updateFirstPetal(),this.createPetals(),e.redraw()},r}({},constants,CPoint,Vector,util),core=function(t,e,i,s,n,o){"use strict";var e=e,i=i,s=s,n=n,r=o,h=function(){this.constants=e,this._u=r,this.canvas=document.getElementById("myCanvas"),this.context="",this.canvasMode="static",this.keyFrames=[],this.updateMode=!1,this.animationMode=!1,this.segmentStartTime=0,this.segment=0,this.loopStartTime=0,this.setTime=0,this.pauseTime=200,this.frameDelay=60,this.gifFramerate=200,this.delta=-this.frameDelay,this.Vector=i,this.sceneMode=e.SCENE_NORMAL,this.encoder="",this.delayTime=0,this.initList=["flower"],this.curve=[],this.pattern=null,this.bodybg="020202",this.backgroundColor="010201",this.lineColor="9fb4f4",this.backgroundAlpha=1,document.getElementById("bgAlpha").value=this.backgroundAlpha;var t=this._u.getKeys(e.SOURCE_MODES)[0];this.sourceMode=e.SOURCE_MODES[t],this.controlPointRadius=6,this.canvasWidth=640,this.canvasHeight=640,this.midWidth=this.canvasWidth/2,this.midHeight=this.canvasHeight/2,this.center=i.create(this.midWidth,this.midHeight),this.inCurveEditMode=!0,this.toggleCurveColor=!1,this.fieldFocus=!1,this.settingShelf={toggleCurveColor:this.toggleCurveColor,inCurveEditMode:this.inCurveEditMode},this.objList=[],this.objTypes=[],this.selectedObject=0,this.debugMode=!0,this.resourceList={},this.backgroundImageExists=!1,this.fillImageExists=!1,this.initializeCanvas=function(){this.initConstants(),this.bindEvents(),this.context=this.canvas.getContext("2d");var t=document.getElementById("k");if(t.value=e.DEFAULT_RAYS,0===this.objList.length?this.build():this.setState(),this.initFrame(),this.debugMode===!0){var i=window.getSampleJSON();this.loadData(i,!1)}this.redraw()},this.initConstants=function(){if(r.exists(this.positions)){if(24!==this.positions.length)return;this.curve.push(this.validateInt(this.positions.substring(0,3))),this.curve.push(this.validateInt(this.positions.substring(3,6))),this.curve.push(this.validateInt(this.positions.substring(6,9))),this.curve.push(this.validateInt(this.positions.substring(9,12))),this.curve.push(this.validateInt(this.positions.substring(12,15))),this.curve.push(this.validateInt(this.positions.substring(15,18))),this.curve.push(this.validateInt(this.positions.substring(18,21))),this.curve.push(this.validateInt(this.positions.substring(21,24)))}},this.build=function(){var t=this;r.each(r.range(0,this.initList.length),function(i){"polar"===t.initList[i]||"flower"===t.initList[i]&&(t.objList.push(new n(t,e.DEFAULT_RAYS,1,t.canvasHeight/e.DEFAULT_INNER_RADIUS_SCALAR,t.canvasHeight/e.DEFAULT_OUTER_RADIUS_SCALAR,t.center)),t.objTypes.push(["flower",e.DEFAULT_RAYS,1]))})},this.redraw=function(){if(this.context.save(),this.context.setTransform(1,0,0,1,0,0),this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.context.restore(),this.context.strokeStyle="#"+this.lineColor,this.backgroundImageExists)this.context.drawImage(this.backgroundImage,0,0,this.canvasWidth,this.canvasHeight);else{var t=r.toRGB(this.backgroundColor);this.context.fillStyle="rgba("+t[0]+", "+t[1]+", "+t[2]+", "+this.backgroundAlpha+")",this.context.fillRect(0,0,this.canvasWidth,this.canvasHeight)}var e=this;r.each(this.objList,function(t){t.draw()}),r.each(this.objList,function(t){r.indexOf(e.objList,t)===e.selectedObject&&t.drawControlPoints()})},this.updatePetalCount=function(){var t=document.getElementById("k").value;isNaN(t)||this.objList[this.selectedObject]instanceof n&&(this.objList[this.selectedObject]=new n(this,t,1,this.canvasHeight/e.DEFAULT_INNER_RADIUS_SCALAR,this.canvasHeight/e.DEFAULT_OUTER_RADIUS_SCALAR,this.center),this.objTypes[this.selectedObject][1]=t,this.objList[this.selectedObject].updateRadialPoint(),this.setState(),this.redraw())},this.accentRadial=function(){var t=document.getElementById("radialScalar").value;if(!isNaN(t)){t=r.validateFloat(t),this.objTypes[this.selectedObject][2]=t;var e=this.objList[this.selectedObject];t>0&&t<e.petalCount&&(e.accentRadialPoint(t),this.setState(),this.redraw())}},this.initFrame=function(){if(this.keyFrames[this.segment]={},this.keyFrames[this.segment].obj=[],this.segment>0)for(var t=0;t<this.objList;t++)this.keyFrames[this.segment].obj[t].rotation=this.keyFrames[this.segment-1].obj[t].rotation,this.keyFrames[this.segment].obj[t].timing=this.keyFrames[this.segment-1].obj[t].timing;else for(var e=0;e<this.objList;e++)this.keyFrames[this.segment].obj[e].rotation=0,this.keyFrames[this.segment].obj[e].timing=1;this.storeFrame()},this.setState=function(){for(var t=0;t<this.objList.length;t++)this.objList[t].setState(this.keyFrames[this.segment].obj[t])},this.getState=function(){for(var t=0;t<this.objList.length;t++)this.keyFrames[this.segment].obj[t]=this.objList[t].getState();this.keyFrames[this.segment].timing=parseFloat(document.getElementById("length").value)},this.clearScene=function(){this.objList=[],this.objTypes=[],this.resourceList={},this.backgroundImageExists=!1,this.fillImageExists=!1,this.keyFrames=[],this.segment=0,this.objList.push(new n(this,e.DEFAULT_RAYS,1,this.canvasHeight/e.DEFAULT_INNER_RADIUS_SCALAR,this.canvasHeight/e.DEFAULT_OUTER_RADIUS_SCALAR,this.center)),this.objTypes.push(["flower",e.DEFAULT_RAYS,1]),this.selectedObject=0,this.initFrame(),this.redraw(),window.updateInterface()},this.initializeCanvas()};h.prototype.addObject=function(){if(!(this.objList.length>=e.MAX_OBJECTS)){this.objList.push(new n(this,e.DEFAULT_RAYS,1,this.canvasHeight/e.DEFAULT_INNER_RADIUS_SCALAR,this.canvasHeight/e.DEFAULT_OUTER_RADIUS_SCALAR,this.center)),this.objTypes.push(["flower",e.DEFAULT_RAYS,1]);for(var t=0;t<this.keyFrames.length;t++)this.keyFrames[t].obj[this.objList.length-1]=this.objList[this.objList.length-1].getState(),this.keyFrames[t].obj[this.objList.length-1].timing=document.getElementById("length").value;var i=this.objList.length-1;this.selectedObject=i,this.redraw()}},h.prototype.removeObject=function(){if(!(this.objList.length<2)){r.removeArrayEntry(this.objList,this.selectedObject),r.removeArrayEntry(this.objTypes,this.selectedObject);var t=this;r.each(this.keyFrames,function(e){r.removeArrayEntry(e.obj,t.selectedObject)}),this.selectedObject===this.objList.length&&this.selectedObject--,this.redraw(),window.updateInterface()}},h.prototype.removeSegment=function(){this.keyFrames.length<2||(r.removeArrayEntry(this.keyFrames,this.segment),this.segment===this.keyFrames.length&&this.segment--,window.updateInterface(),this.setState(),this.redraw())},h.prototype.removeLast=function(){this.keyFrames.length<2||(r.removeArrayEntry(this.keyFrames,this.keyFrames.length-1),this.segment===this.keyFrames.length&&this.segment--,window.updateInterface(),this.setState(),this.redraw())},h.prototype.addFillImage=function(t,e,i){this.fillImage=new Image,this.fillImage.onload=function(){window.kit.fillImageExists=!0,window.kit.redraw()},this.fillImage.src=t,this.resourceList.fillImageSource=t,this.resourceList.fillImageLabel=e,this.resourceList.fillImagePage=i},h.prototype.addBackGroundImage=function(t,e,i){this.backgroundImage=new Image,this.backgroundImage.onload=function(){window.kit.backgroundImageExists=!0,window.kit.redraw()},this.backgroundImage.src=t,this.resourceList.backgroundImageSource=t,this.resourceList.backgroundImageLabel=e,this.resourceList.backgroundImagePage=i},h.prototype.constrain=function(t){t.x<0?t.x=0:t.x>this.canvasWidth&&(t.x=this.canvasWidth),t.y<0?t.y=0:t.y>this.canvasHeight&&(t.y=this.canvasHeight)},h.prototype.startDrag=function(t){var e=window.kit,n=e.objList[e.selectedObject],o=n.center,h=r.getPosition(t,e.canvas);r.each(e.objList[e.selectedObject].controlPoints,function(t){var r=i.rotate(o.x,o.y,t,n.rotation*e.constants.TWOPIDIV360);return r=new s(e,r.x,r.y),e.constrain(r),r.mouseInside(h)?(t.inDrag=!0,e.canvasMode="cpDrag",void e.redraw()):void 0})},h.prototype.endDrag=function(t){var e=window.kit;e.canvasMode="static",e.position=r.getPosition(t,e.canvas),r.debugConsole("endDrag x:"+e.position.x+" y:"+e.position.y),r.each(e.objList,function(t){r.each(t.controlPoints,function(t){t.inDrag===!0&&(t.inDrag=!1,e.redraw())})}),e.getState()},h.prototype.move=function(t){var e=window.kit;"cpDrag"===e.canvasMode&&(e.position=r.getPosition(t,e.canvas),r.each(e.objList,function(t){var i=0;r.each(t.controlPoints,function(n){if(n.inDrag){var o=e.Vector.rotate(e.midWidth,e.midHeight,e.position,-t.rotation*e.constants.TWOPIDIV360),h=new s(e,o.x,o.y,t,i);return h.inDrag=!0,t.updatePetal(i,h),r.debugConsole("newPoint.x/y::"+o.x+"/"+o.y+" indexof::"+r.indexOf(t.controlPoints,n)+" object type:"+t.type+"</p>"),void e.redraw()}i++})}),r.debugConsole("mousemove x:"+e.position.x+" y:"+e.position.y))},h.prototype.bindEvents=function(){this.canvas.addEventListener("touchstart",this.startDrag,!1),this.canvas.addEventListener("touchend",this.endDrag,!1),this.canvas.addEventListener("touchmove",this.move,!1),this.canvas.addEventListener("mousedown",this.startDrag,!1),this.canvas.addEventListener("mouseup",this.endDrag,!1),this.canvas.addEventListener("mousemove",this.move,!1)},h.prototype.storeFrame=function(){for(var t=0;t<this.objList.length;t++)this.keyFrames[this.segment].obj[t]=this.objList[t].getState();this.keyFrames[this.segment].timing=parseFloat(document.getElementById("length").value);var e=document.getElementById("rotation").value;this.keyFrames[this.segment].obj[this.selectedObject].rotation=parseFloat(e)},h.prototype.gifInit=function(){this.encoder.setRepeat(-1),this.encoder.setDelay(this.gifFramerate),this.encoder.setSize(this.canvasWidth,this.canvasHeight),this.encoder.start(),this.sceneMode=e.SCENE_GIF,this.loopInit(),this.redraw()},h.prototype.gifComplete=function(){this.encoder.finish();var t=this.encoder.stream().getData(),i="data:image/gif;base64,"+window.encode64(t);window.open(i,"_blank"),this.sceneMode=e.SCENE_NORMAL,this.stopScene()},h.prototype.loopInit=function(){this.animationMode=!0,this.segment=0,this.loopStartTime=r.msTime(),this.segmentStartTime=this.loopStartTime,this.settingShelf={inCurveEditMode:this.inCurveEditMode,toggleCurveColor:this.toggleCurveColor},this.inCurveEditMode=!1,this.toggleCurveColor=!1,window.updateInterface()},h.prototype.stopScene=function(){this.inCurveEditMode=this.settingShelf.inCurveEditMode,this.toggleCurveColor=this.settingShelf.toggleCurveColor,this.sceneReset()},h.prototype.sceneReset=function(){this.animationMode=!1,this.segment=0,this.setState(),this.redraw()},h.prototype.setState=function(){for(var t=0;t<this.objList.length;t++)this.objList[t].setState(this.keyFrames[this.segment].obj[t])},h.prototype.sceneLoop=function(){if(!this.animationMode||this.keyFrames.length<2)return this.stopScene(),void window.updateInterface();if(this.sceneMode===e.SCENE_GIF?this.delta+=this.gifFramerate:this.delta=r.msTime()-this.segmentStartTime,0===this.segment&&this.delta>=this.pauseTime)this.segment=1,this.delta=0,this.segmentStartTime=r.msTime();else if(0!==this.segment)if(this.delta>1e3*this.keyFrames[this.segment-1].timing)if(this.segment<this.keyFrames.length)this.setState(),this.segment++,this.sceneMode===this.GIF?this.delta=0:this.segmentStartTime=r.msTime();else{if(this.sceneMode===e.SCENE_GIF)return void this.gifComplete();this.segment=0,this.setState(),this.segmentStartTime=r.msTime()}else this.updateSegment(this.delta);this.sceneMode===e.SCENE_GIF?(this.encoder.addFrame(this.context),setTimeout(function(){window.kit.sceneLoop()},.01)):setTimeout(function(){window.kit.sceneLoop()},window.kit.frameDelay)},h.prototype.updateSegment=function(t){var e=this.segment;this.segment===this.keyFrames.length&&(e=0);var i=t/(1e3*this.keyFrames[e].timing),n=0,o=this;r.each(this.keyFrames[e].obj,function(t){var h=0,a=[];r.each(t.controlPoints,function(t){var e=o.keyFrames[o.segment-1].obj[n].controlPoints[h].x*(1-i)+t.x*i,r=o.keyFrames[o.segment-1].obj[n].controlPoints[h].y*(1-i)+t.y*i,c=new s(o,e,r,o.objList[n],h);a.push(c),h++});var c={controlPoints:a},l=o.keyFrames[o.segment-1].obj[n].rotation,u=o.keyFrames[e].obj[n].rotation,d=u-l;Math.abs(d)>180&&(0>d?u+=360:l+=360),c.rotation=(l*(1-i)+u*i)%360,o.objList[n].setState(c),n++})},h.prototype.segmentLoop=function(){if(!this.animationMode||0===this.segment)return this.setState(),void window.updateInterface();var t=r.msTime()-this.loopStartTime-this.pauseTime;if(0>t)0!==this.setTime&&(this.segment--,this.setState(),this.segment++,this.setTime=0);else if(t>1e3*this.keyFrames[this.segment].timing)t>1e3*this.keyFrames[this.segment].timing+this.pauseTime?(this.loopStartTime=r.msTime(),this.segment--,this.setState(),this.segment++,this.setTime=0):this.setTime!==1e3*this.keyFrames[this.segment].timing&&(this.setState(),this.setTime=1e3*this.keyFrames[this.segment].timing);else{var e=t/(1e3*this.keyFrames[this.segment].timing),i=0,n=this;r.each(this.keyFrames[this.segment].obj,function(t){var o=0,h=[];r.each(t.controlPoints,function(t){var r=n.keyFrames[n.segment-1].obj[i].controlPoints[o].x*(1-e)+t.x*e,a=n.keyFrames[n.segment-1].obj[i].controlPoints[o].y*(1-e)+t.y*e,c=new s(n,r,a,n.objList[i],o);h.push(c),o++});var a={controlPoints:h},c=n.keyFrames[n.segment-1].obj[i].rotation,l=n.keyFrames[n.segment].obj[i].rotation,u=l-c;Math.abs(u)>180&&(0>u?l+=360:c+=360),a.rotation=(c*(1-e)+l*e)%360,n.objList[i].setState(a),i++})}setTimeout(function(){window.kit.segmentLoop()},window.kit.frameDelay)},h.prototype.loadData=function(t){this.objList=[],this.objTypes=[],this.resourceList=t[1],this.objTypes=t[2],this.keyFrames=t[3],this.objList=[];for(var i=0;i<this.objTypes.length;i++)"flower"===this.objTypes[i][0]?this.objList.push(new n(this,this.objTypes[i][1],this.objTypes[i][2],this.canvasHeight/e.DEFAULT_INNER_RADIUS_SCALAR,this.canvasHeight/e.DEFAULT_OUTER_RADIUS_SCALAR,this.center)):"polar"===this.objTypes[i][0];this.selectedObject=0,this.options=t[0],this.currentSelector="bg-color",this.backgroundColor=this.options.backgroundColor,this.backgroundAlpha=this.options.backgroundAlpha,this.lineColor=this.options.lineColor,this.backgroundImageExists=!1,this.fillImageExists=!1,this.sourceMode=this.options.sourceMode,"string"==typeof this.resourceList.backgroundImageSource&&this.addBackGroundImage(this.resourceList.backgroundImageSource,this.resourceList.backgroundImageLabel,this.resourceList.backgroundImagePage),"string"==typeof this.resourceList.fillImageSource&&this.addFillImage(this.resourceList.fillImageSource,this.resourceList.fillImageLabel,this.resourceList.fillImagePage),this.preinit||window.setColor("#"+this.backgroundColor),this.currentSelector="line-color",this.preinit||window.setColor("#"+this.lineColor),this.segment=0,this.setState(),this.redraw()};for(var a in h.prototype)"function"==typeof h.prototype[a]&&(window[a]=h.prototype[a]);return h.prototype._preloadMethods=[],h.prototype._registeredMethods={pre:[],post:[],remove:[]},h.prototype.registerPreloadMethod=function(t){h.prototype._preloadMethods.push(t)}.bind(this),h.prototype.registerMethod=function(t,e){h.prototype._registeredMethods.hasOwnProperty(t)||(h.prototype._registeredMethods[t]=[]),h.prototype._registeredMethods[t].push(e)}.bind(this),h}({},constants,Vector,CPoint,PetalFlower,util),src_app=function(t,e){"use strict";var i=e,s=function(){window.kit=new i,window.initInterface()};return"complete"===document.readyState?s():window.addEventListener("load",s,!1),window.kit}({},core,constants,Vector,CPoint,PetalFlower);