{"version":3,"file":"cKit.js","sources":["../../build/scripts/cKit.js"],"names":["constants","PI","Math","SCENE_NORMAL","SCENE_GIF","EDIT_SHAPE","EDIT_TRANSFORM","EDIT_NONE","TWOPIDIV360","TWOPI","MAX_OBJECTS","DEFAULT_RAYS","DEFAULT_INNER_RADIUS_SCALAR","DEFAULT_OUTER_RADIUS_SCALAR","CONTROL_POINT_RADIUS","DEFAULT_LENGTH","MAX_CP_SIGS","BACKGROUND_COLOR","BACKGROUND_ALPHA","LINE_COLOR","BODY_BACKGROUND_COLOR","MAX_CLICK_DISTANCE","SOURCE_MODES","lighter","darker","xor","source-atop","source-out","source-over","destination-atop","destination-out","util","require","getPosition","e","canvas","rect","getBoundingClientRect","x","clientX","left","y","clientY","top","clone","obj","copy","constructor","attr","hasOwnProperty","dnexist","item","exists","encodeToHex","floatString","parseInt","toString","decodeFromHex","str","parseIntOrDefault","i","def","Number","isInteger","parseFloatOrDefault","f","parseFloat","isNaN","reduceSig","num","sig","mult","pow","round","degreesToRadians","angle","toRGB","this","substring","msTime","Date","getTime","each","func","length","keys","window","kit","_u","getKeys","key","push","range","st","end","r","indexOf","console","log","removeArrayEntry","arr","index","splice","debugConsole","document","getElementById","Vector","create","multiply","vector","scaleFactor","add","vector1","vector2","getPoint","centerX","centerY","radius","thisX","sin","thisY","cos","nP","getPolarPoint","center","rotate","point","thisAngle","cosTheta","sinTheta","xNew","yNew","distance","pointA","pointB","xDist","yDist","sqrt","getRadians","xDelta","yDelta","rads","atan2","getDegrees","degrees","zeroVector","reflectMatrix","theta","CPoint","parentObject","inDrag","draw","realPoint","editMode","rotation","anchorPoint","points","shapePoints","transformPoints","context","beginPath","moveTo","lineTo","stroke","arc","controlPointRadius","closePath","lineWidth","fillStyle","fill","mouseInside","scale","Transform","position","prototype","getMatrix","PetalFlower","petals","radialAccent","innerRadius","outerRadius","petalCount","allPetals","firstPetal","increment","firstInnerAngle","scaleDistance","midWidth","lastScale","cp","cp2","cp3","cp4","secondCPRadius","rotatePoint","midHeight","createPetals","flower","Petal","bezierCurveTo","rotated","fillImageExists","globalCompositeOperation","sourceMode","clip","fillImage","highlightCurve","newPetal","thisPoint","updatePetal","newPoint","newCoords","updateTransform","transform","translateTranform","reverseTransformPoint","actual","setScale","xPosition","resetScalePoint","updateFirstPetal","setControlPoint","updateRadialPoint","keyFrames","keyFrame","selectedObject","newPosition","accentRadialPoint","drawShapePoints","save","controlPoint","restore","drawTransformPoints","getState","cps","setState","state","redraw","core","initialized","updateMode","animationMode","segmentStartTime","segment","loopStartTime","setTime","pauseTime","frameDelay","gifFramerate","delta","sceneMode","encoder","delayTime","initList","pattern","bodybg","backgroundColor","lineColor","backgroundAlpha","canvasWidth","canvasHeight","maxRadius","seamlessAnimation","fieldFocus","settingShelf","toggleCurveColor","objList","objTypes","resourceList","backgroundImageExists","debugMode","initializeCanvas","getContext","bindEvents","build","dataz","getSampleJSON","loadData","digest","initFrame","setTransform","clearRect","width","height","strokeStyle","drawImage","backgroundImage","rgb","fillRect","FillImage","src","page","label","image","Image","onload","object","sweepFrom","sweepTo","temp_canvas","createElement","tempContext","reflectionMatrix","translate","matrix","getRotationMatrix","canvasEvents","addEventListener","startDrag","endDrag","move","event","actualPosition","canvasMode","positionInsideObject","angleVector","setRotation","newX","constrain","sceneEvents","sceneLoop","stopScene","lastStartTime","timing","GIF","gifComplete","updateSegment","addFrame","setTimeout","processTime","max","keyTo","objIndex","ob","newCps","obFrom","newY","newState","fromRotation","toRotation","del","abs","segmentLoop","ind","storeFrame","clearScene","removeKeyframe","removeLast","gifInit","setRepeat","setDelay","setSize","start","loopInit","finish","binary_gif","stream","getData","data_url","encode64","open","setTempModes","restoreModes","sceneReset","playSegment","selectFirst","selectPrev","selectNext","selectLast","getSegment","objectEvents","value","getRotation","rotationDegrees","floor","val","addFillImage","fillImageSource","addBackgroundImage","backgroundImageSource","updatePetalCount","updateRadialAccent","radialScalar","thisObject","selectObject","addObject","removeObject","getImage","toDataURL","setAlpha","newAlpha","settingsEvents","getSettings","data","options","currentSelector","setColor","SOURCE_MODE","src_app","_globalInit","initKeyboard","GIFEncoder","initInterface","readyState"],"mappings":"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","sourcesContent":["/*! cKit.js v0.4.2 November 24, 2014 */\nvar constants = function (require) {\n    var PI = Math.PI;\n    return {\n      SCENE_NORMAL: 0,\n      SCENE_GIF: 1,\n      EDIT_SHAPE: 0,\n      EDIT_TRANSFORM: 1,\n      EDIT_NONE: 2,\n      PI: PI,\n      TWOPIDIV360: 2 * Math.PI / 360,\n      TWOPI: 2 * Math.PI,\n      MAX_OBJECTS: 4,\n      DEFAULT_RAYS: 6,\n      DEFAULT_INNER_RADIUS_SCALAR: 17,\n      DEFAULT_OUTER_RADIUS_SCALAR: 2.2,\n      CONTROL_POINT_RADIUS: 6,\n      DEFAULT_LENGTH: 1.5,\n      MAX_CP_SIGS: 4,\n      BACKGROUND_COLOR: '010201',\n      BACKGROUND_ALPHA: '1',\n      LINE_COLOR: '9fb4f4',\n      BODY_BACKGROUND_COLOR: '020202',\n      MAX_CLICK_DISTANCE: 2,\n      SOURCE_MODES: {\n        'lighter': 'lighter',\n        'darker': 'darker',\n        'xor': 'xor',\n        'source-atop': 'atop',\n        'source-out': 'out',\n        'source-over': 'over',\n        'destination-atop': 'bottom',\n        'destination-out': 'bottom-out'\n      }\n    };\n  }({});\nvar util = function (require, constants) {\n    \n    var constants = constants;\n    return {\n      getPosition: function (e, canvas) {\n        var rect = canvas.getBoundingClientRect();\n        return {\n          x: e.clientX - rect.left,\n          y: e.clientY - rect.top\n        };\n      },\n      clone: function (obj) {\n        if (obj == null || 'object' !== typeof obj) {\n          return obj;\n        }\n        var copy = obj.constructor();\n        for (var attr in obj) {\n          if (obj.hasOwnProperty(attr)) {\n            copy[attr] = obj[attr];\n          }\n        }\n        return copy;\n      },\n      dnexist: function (item) {\n        return typeof item === 'undefined';\n      },\n      exists: function (item) {\n        return typeof item !== 'undefined';\n      },\n      encodeToHex: function (floatString) {\n        return parseInt(255 * floatString).toString(16);\n      },\n      decodeFromHex: function (str) {\n        return parseInt(str, 16);\n      },\n      parseIntOrDefault: function (i, def) {\n        i = parseInt(i);\n        if (Number.isInteger(i)) {\n          return i;\n        } else {\n          return def;\n        }\n      },\n      parseFloatOrDefault: function (f, def) {\n        f = parseFloat(f);\n        if (isNaN(f)) {\n          return def;\n        } else {\n          return f;\n        }\n      },\n      reduceSig: function (num, sig) {\n        var mult = Math.pow(10, sig);\n        return Math.round(num * mult + 0.00001) / mult;\n      },\n      degreesToRadians: function (angle) {\n        return constants.TWOPIDIV360 * angle;\n      },\n      toRGB: function (str) {\n        return [\n          this.decodeFromHex(str.substring(0, 2)),\n          this.decodeFromHex(str.substring(2, 4)),\n          this.decodeFromHex(str.substring(4, 6))\n        ];\n      },\n      msTime: function () {\n        return new Date().getTime();\n      },\n      each: function (obj, func) {\n        if (obj == null) {\n          return obj;\n        }\n        var i, length = obj.length;\n        if (length === +length) {\n          for (i = 0; i < length; i++) {\n            func(obj[i], i, obj);\n          }\n        } else {\n          var keys = window.kit._u.getKeys(obj);\n          for (i = 0, length = keys.length; i < length; i++) {\n            func(obj[keys[i]], keys[i], obj);\n          }\n        }\n        return obj;\n      },\n      getKeys: function (obj) {\n        var keys = [];\n        for (var key in obj) {\n          if (obj.hasOwnProperty(key)) {\n            keys.push(key);\n          }\n        }\n        return keys;\n      },\n      range: function (st, end) {\n        var r = [];\n        for (var i = st; i < end; i++) {\n          r.push(i);\n        }\n        return r;\n      },\n      indexOf: function (obj, item) {\n        for (var i = 0; i < obj.length; i++) {\n          if (obj[i] === item) {\n            return i;\n          }\n        }\n        console.log('There is a bug with a call to indexOf');\n        return -1;\n      },\n      removeArrayEntry: function (arr, index) {\n        arr.splice(index, 1);\n      },\n      debugConsole: function (text) {\n        var HUD = document.getElementById('console');\n      }\n    };\n  }({}, constants);\nvar Vector = function (require, constants) {\n    \n    var constants = constants;\n    return {\n      create: function (x, y) {\n        return {\n          'x': x,\n          'y': y\n        };\n      },\n      multiply: function (vector, scaleFactor) {\n        vector.x *= scaleFactor;\n        vector.y *= scaleFactor;\n        return vector;\n      },\n      add: function (vector1, vector2) {\n        vector1.x += vector2.x;\n        vector1.y += vector2.y;\n        return vector1;\n      },\n      getPoint: function (centerX, centerY, radius, angle) {\n        var thisX = centerX + radius * Math.sin(angle);\n        var thisY = centerY - radius * Math.cos(angle);\n        var nP = this.create(thisX, thisY);\n        return nP;\n      },\n      getPolarPoint: function (center, radius, angle) {\n        var thisX = center.x + radius * Math.sin(angle);\n        var thisY = center.y - radius * Math.cos(angle);\n        var nP = this.create(thisX, thisY);\n        return nP;\n      },\n      rotate: function (centerX, centerY, point, thisAngle) {\n        var cosTheta = Math.cos(thisAngle);\n        var sinTheta = Math.sin(thisAngle);\n        var xNew = cosTheta * (point.x - centerX) - sinTheta * (point.y - centerY) + centerX;\n        var yNew = sinTheta * (point.x - centerX) + cosTheta * (point.y - centerY) + centerY;\n        return this.create(xNew, yNew);\n      },\n      distance: function (pointA, pointB) {\n        var xDist = pointA.x - pointB.x;\n        var yDist = pointA.y - pointB.y;\n        return Math.sqrt(xDist * xDist + yDist * yDist);\n      },\n      getRadians: function (center, point) {\n        var xDelta = point.x - center.x;\n        var yDelta = center.y - point.y;\n        var rads = Math.atan2(xDelta, yDelta);\n        if (rads < 0) {\n          rads += constants.TWOPI;\n        }\n        return rads;\n      },\n      getDegrees: function (center, point) {\n        var xDelta = point.x - center.x;\n        var yDelta = center.y - point.y;\n        var degrees = Math.atan2(xDelta, yDelta) * constants.TWOPIDIV360;\n        if (degrees < 0) {\n          degrees += 360;\n        }\n        return degrees;\n      },\n      zeroVector: function () {\n        return {\n          'x': 0,\n          'y': 0\n        };\n      },\n      reflectMatrix: function (theta) {\n        return [\n          Math.cos(2 * theta),\n          Math.sin(2 * theta),\n          Math.sin(2 * theta),\n          -Math.cos(2 * theta)\n        ];\n      }\n    };\n  }({}, constants);\nvar CPoint = function (require, constants, Vector) {\n    \n    var constants = constants;\n    var Vector = Vector;\n    var CPoint = function (kit, x, y, parentObject, index) {\n      this.kit = kit;\n      this.x = x;\n      this.y = y;\n      this.parentObject = parentObject;\n      this.index = index;\n      this.inDrag = false;\n      this.draw = function () {\n        var realPoint;\n        if (this.kit.editMode !== constants.EDIT_TRANSFORM || this.index !== 2) {\n          realPoint = Vector.rotate(0, 0, this, parentObject.rotation);\n        } else {\n          realPoint = this;\n        }\n        if (this.inDrag) {\n          var anchorPoint;\n          var points = parentObject.shapePoints;\n          if (this.kit.editMode === constants.EDIT_TRANSFORM) {\n            points = parentObject.transformPoints;\n          }\n          if (this.index === 1) {\n            anchorPoint = Vector.rotate(0, 0, points[0], parentObject.rotation);\n            this.kit.context.beginPath();\n            this.kit.context.moveTo(realPoint.x, realPoint.y);\n            this.kit.context.lineTo(anchorPoint.x, anchorPoint.y);\n            this.kit.context.stroke();\n          } else if (this.index === 2) {\n            if (this.kit.editMode === constants.EDIT_TRANSFORM) {\n              anchorPoint = points[0];\n            } else {\n              anchorPoint = Vector.rotate(0, 0, points[3], parentObject.rotation);\n            }\n            this.kit.context.beginPath();\n            this.kit.context.moveTo(realPoint.x, realPoint.y);\n            this.kit.context.lineTo(anchorPoint.x, anchorPoint.y);\n            this.kit.context.stroke();\n          }\n        }\n        this.kit.context.beginPath();\n        this.kit.context.arc(realPoint.x, realPoint.y, this.kit.controlPointRadius, 0, Math.PI * 2, true);\n        this.kit.context.closePath();\n        this.kit.context.lineWidth = 1;\n        if (this.inDrag) {\n          this.kit.context.fillStyle = '#999999';\n          this.kit.context.fill();\n        } else {\n          this.kit.context.fillStyle = '#FFFFFF';\n          this.kit.context.fill();\n        }\n        this.kit.context.stroke();\n      };\n      this.mouseInside = function (point) {\n        return this.kit.controlPointRadius + constants.MAX_CLICK_DISTANCE > Vector.distance(point, this) * this.parentObject.scale;\n      };\n    };\n    return CPoint;\n  }({}, constants, Vector);\nvar Transform = function (require) {\n    \n    var Transform = function (position, scale, rotation) {\n      this.position = position;\n      this.scale = scale;\n      this.rotation = rotation;\n    };\n    Transform.prototype.getMatrix = function () {\n      var cos = Math.cos(this.rotation);\n      var sin = Math.sin(this.rotation);\n      return [\n        this.scale * cos,\n        sin,\n        -sin,\n        this.scale * cos,\n        this.position.x,\n        this.position.y\n      ];\n    };\n    return Transform;\n  }({});\nvar PetalFlower = function (require, CPoint, Vector, Transform, util) {\n    \n    var CPoint = CPoint;\n    var Vector = Vector;\n    var Transform = Transform;\n    var _u = util;\n    var PetalFlower = function (kit, petals, radialAccent, innerRadius, outerRadius, center) {\n      this.kit = kit;\n      this.petalCount = petals;\n      this.radialAccent = radialAccent;\n      this.allPetals = [];\n      this.firstPetal = [];\n      this.thisAngle = 0;\n      this.increment = 2 * Math.PI / petals;\n      this.firstInnerAngle = -0.5 * this.increment * radialAccent;\n      this.shapePoints = [];\n      this.transformPoints = [];\n      this.rotation = 0;\n      this.center = center;\n      this.scaleDistance = this.kit.midWidth / 2;\n      this.scale = 1;\n      this.lastScale = 1;\n      var cp, cp2, cp3, cp4;\n      cp = Vector.getPoint(0, 0, innerRadius, this.firstInnerAngle);\n      var secondCPRadius = (outerRadius - innerRadius) / 2 + innerRadius;\n      cp2 = Vector.getPoint(0, 0, secondCPRadius, this.firstInnerAngle);\n      cp3 = Vector.getPoint(0, 0, outerRadius, 0);\n      cp3.x = cp3.x - 40;\n      cp4 = Vector.getPoint(0, 0, outerRadius, 0);\n      this.firstPetal.push(cp);\n      this.shapePoints.push(new CPoint(kit, cp.x, cp.y, this, 0));\n      this.shapePoints.push(new CPoint(kit, cp2.x, cp2.y, this, 1));\n      this.firstPetal.push(cp2);\n      this.shapePoints.push(new CPoint(kit, cp3.x, cp3.y, this, 2));\n      this.firstPetal.push(cp3);\n      this.shapePoints.push(new CPoint(kit, cp4.x, cp4.y, this, 3));\n      this.firstPetal.push(cp4);\n      this.firstPetal.push(Vector.create(-cp3.x, cp3.y));\n      this.firstPetal.push(Vector.create(-cp2.x, cp2.y));\n      this.firstPetal.push(Vector.create(-cp.x, cp.y));\n      this.transformPoints.push(new CPoint(this.kit, 0, 0, this, 0));\n      var rotatePoint = Vector.create(0, -this.kit.midHeight / 2.5);\n      Vector.rotate(0, 0, rotatePoint, this.rotation);\n      this.transformPoints.push(new CPoint(this.kit, rotatePoint.x, rotatePoint.y, this, 1));\n      this.transformPoints.push(new CPoint(this.kit, this.scaleDistance, 0, this, 2));\n      this.createPetals();\n    };\n    PetalFlower.prototype.draw = function () {\n      var index = 0;\n      var flower = this;\n      var kit = this.kit;\n      kit.context.beginPath();\n      _u.each(this.allPetals, function (Petal) {\n        if (flower.rotation === 0) {\n          kit.context.moveTo(Petal[0].x, Petal[0].y);\n          kit.context.bezierCurveTo(Petal[1].x, Petal[1].y, Petal[2].x, Petal[2].y, Petal[3].x, Petal[3].y);\n          kit.context.bezierCurveTo(Petal[4].x, Petal[4].y, Petal[5].x, Petal[5].y, Petal[6].x, Petal[6].y);\n          kit.context.moveTo(Petal[6].x, Petal[6].y);\n          kit.context.lineTo(Petal[0].x, Petal[0].y);\n        } else {\n          var rotated = [];\n          for (var i = 0; i < Petal.length; i++) {\n            rotated.push(Vector.rotate(0, 0, Petal[i], flower.rotation));\n          }\n          kit.context.moveTo(rotated[0].x, rotated[0].y);\n          kit.context.bezierCurveTo(rotated[1].x, rotated[1].y, rotated[2].x, rotated[2].y, rotated[3].x, rotated[3].y);\n          kit.context.bezierCurveTo(rotated[4].x, rotated[4].y, rotated[5].x, rotated[5].y, rotated[6].x, rotated[6].y);\n          kit.context.moveTo(rotated[6].x, rotated[6].y);\n          kit.context.lineTo(rotated[0].x, rotated[0].y);\n        }\n        index++;\n      });\n      kit.context.closePath();\n      if (kit.fillImageExists) {\n        kit.context.globalCompositeOperation = kit.sourceMode;\n        kit.context.clip();\n        kit.fillImage.draw(new Transform(this.center, this.scale, this.rotation), this);\n        if (kit.highlightCurve === true) {\n          kit.context.globalCompositeOperation = 'source-over';\n          kit.context.lineWidth = 1.9;\n          kit.context.stroke();\n        }\n      } else {\n        kit.context.globalCompositeOperation = 'source-over';\n        kit.context.stroke();\n      }\n    };\n    PetalFlower.prototype.createPetals = function () {\n      this.allPetals.push(this.firstPetal);\n      for (var i = 1; i < this.petalCount; i++) {\n        var newPetal = [];\n        var thisAngle = i * this.increment;\n        _u.each(this.firstPetal, function (point) {\n          var thisPoint = Vector.rotate(0, 0, point, thisAngle);\n          newPetal.push(thisPoint);\n        });\n        this.allPetals.push(newPetal);\n      }\n    };\n    PetalFlower.prototype.updatePetal = function (index, newPoint) {\n      var newCoords = Vector.create(newPoint.x, newPoint.y);\n      if (index === 3) {\n        newCoords.x = 0;\n        this.firstPetal[3].x = 0;\n        this.firstPetal[index].y = newPoint.y;\n      } else if (index === 0) {\n        var innerRadius = Vector.distance(Vector.create(0, 0), Vector.create(newPoint.x, newPoint.y));\n        newCoords = Vector.getPoint(0, 0, innerRadius, this.firstInnerAngle);\n        newCoords.x = _u.reduceSig(newCoords.x, constants.MAX_CP_SIGS);\n        newCoords.y = _u.reduceSig(newCoords.y, constants.MAX_CP_SIGS);\n        this.firstPetal[0].x = newCoords.x;\n        this.firstPetal[0].y = newCoords.y;\n        this.firstPetal[6].x = -newCoords.x;\n        this.firstPetal[6].y = newCoords.y;\n      } else {\n        this.firstPetal[index].x = newPoint.x;\n        this.firstPetal[6 - index].x = -newPoint.x;\n        this.firstPetal[6 - index].y = newPoint.y;\n        this.firstPetal[index].y = newPoint.y;\n      }\n      this.allPetals = [];\n      this.createPetals();\n      this.shapePoints[index].x = newCoords.x;\n      this.shapePoints[index].y = newCoords.y;\n    };\n    PetalFlower.prototype.updateTransform = function (index, newPoint) {\n      var newCoords = Vector.create(newPoint.x, newPoint.y);\n      this.transformPoints[index].x = newCoords.x;\n      this.transformPoints[index].y = newCoords.y;\n    };\n    PetalFlower.prototype.transform = function () {\n      this.kit.context.transform(this.scale, 0, 0, this.scale, this.center.x, this.center.y);\n    };\n    PetalFlower.prototype.translateTranform = function () {\n      this.kit.context.transform(1, 0, 0, 1, this.center.x, this.center.y);\n    };\n    PetalFlower.prototype.reverseTransformPoint = function (point) {\n      var actual = Vector.create(point.x - this.center.x, point.y - this.center.y);\n      actual.x /= this.scale;\n      actual.y /= this.scale;\n      actual = Vector.rotate(0, 0, actual, -this.rotation);\n      return actual;\n    };\n    PetalFlower.prototype.setScale = function (xPosition) {\n      this.scale = this.lastScale * xPosition / this.scaleDistance;\n    };\n    PetalFlower.prototype.resetScalePoint = function (xPosition) {\n      this.transformPoints[2].x = this.scaleDistance;\n    };\n    PetalFlower.prototype.updateFirstPetal = function () {\n      this.firstPetal[0].x = this.shapePoints[0].x;\n      this.firstPetal[0].y = this.shapePoints[0].y;\n      this.firstPetal[1].x = this.shapePoints[1].x;\n      this.firstPetal[1].y = this.shapePoints[1].y;\n      this.firstPetal[2].x = this.shapePoints[2].x;\n      this.firstPetal[2].y = this.shapePoints[2].y;\n      this.firstPetal[3].x = this.shapePoints[3].x;\n      this.firstPetal[3].y = this.shapePoints[3].y;\n      this.firstPetal[4].x = -this.shapePoints[2].x;\n      this.firstPetal[4].y = this.shapePoints[2].y;\n      this.firstPetal[5].x = -this.shapePoints[1].x;\n      this.firstPetal[5].y = this.shapePoints[1].y;\n      this.firstPetal[6].x = -this.shapePoints[0].x;\n      this.firstPetal[6].y = this.shapePoints[0].y;\n    };\n    PetalFlower.prototype.setControlPoint = function (point, newPoint) {\n      this.shapePoints[this.kit.indexOf(this.shapePoints, point)] = newPoint;\n    };\n    PetalFlower.prototype.updateRadialPoint = function () {\n      this.increment = 2 * Math.PI / this.petalCount;\n      this.firstInnerAngle = -0.5 * this.increment * this.radialAccent;\n      var kit = this.kit;\n      var flower = this;\n      _u.each(kit.keyFrames, function (keyFrame) {\n        var point = keyFrame.obj[kit.selectedObject].shapePoints[0];\n        var radius = Vector.distance(Vector.zeroVector(), Vector.create(point.x, point.y));\n        var newPosition = Vector.getPolarPoint(Vector.zeroVector(), radius, flower.firstInnerAngle);\n        point.x = newPosition.x;\n        point.y = newPosition.y;\n      });\n    };\n    PetalFlower.prototype.accentRadialPoint = function (scale) {\n      this.radialAccent = scale;\n      this.increment = 2 * Math.PI / this.petalCount;\n      this.firstInnerAngle = -0.5 * this.increment * scale;\n      var kit = this.kit;\n      var flower = this;\n      _u.each(kit.keyFrames, function (keyFrame) {\n        var point = keyFrame.obj[kit.selectedObject].shapePoints[0];\n        var radius = Vector.distance(Vector.zeroVector(), Vector.create(point.x, point.y));\n        var newPosition = Vector.getPolarPoint(Vector.zeroVector(), radius, flower.firstInnerAngle);\n        point.x = newPosition.x;\n        point.y = newPosition.y;\n      });\n    };\n    PetalFlower.prototype.drawShapePoints = function () {\n      this.kit.context.save();\n      this.kit.context.transform(1, 0, 0, 1, this.center.x, this.center.y);\n      var flower = this;\n      _u.each(this.shapePoints, function (controlPoint) {\n        var newPoint = new CPoint(flower.kit, controlPoint.x * flower.scale, controlPoint.y * flower.scale, flower, controlPoint.index);\n        newPoint.draw();\n      });\n      this.kit.context.restore();\n    };\n    PetalFlower.prototype.drawTransformPoints = function () {\n      this.kit.context.save();\n      this.translateTranform();\n      this.transformPoints[0].draw();\n      this.transformPoints[1].draw();\n      this.transformPoints[2].draw();\n      this.kit.context.restore();\n    };\n    PetalFlower.prototype.getState = function () {\n      var cps = [];\n      _u.each(this.shapePoints, function (point) {\n        cps.push(Vector.create(point.x, point.y));\n      });\n      return {\n        'shapePoints': cps,\n        'rotation': this.rotation,\n        'scale': this.scale,\n        'position': this.center\n      };\n    };\n    PetalFlower.prototype.setState = function (state) {\n      var kit = this.kit;\n      this.rotation = state.rotation;\n      this.center = state.position;\n      this.scale = state.scale;\n      kit.index = 0;\n      _u.each(this.shapePoints, function (cp) {\n        cp.x = state.shapePoints[kit.index].x;\n        cp.y = state.shapePoints[kit.index].y;\n        kit.index++;\n      });\n      this.allPetals = [];\n      this.updateFirstPetal();\n      this.createPetals();\n      kit.redraw();\n    };\n    return PetalFlower;\n  }({}, CPoint, Vector, Transform, util);\nvar core = function (require, constants, util, PetalFlower, Vector) {\n    \n    var constants = constants;\n    var _u = util;\n    var PetalFlower = PetalFlower;\n    var Vector = Vector;\n    var kit = function () {\n      this.constants = constants;\n      this._u = _u;\n      this.initialized = false;\n      this.keyFrames = [];\n      this.updateMode = false;\n      this.animationMode = false;\n      this.segmentStartTime = 0;\n      this.segment = 0;\n      this.loopStartTime = 0;\n      this.setTime = 0;\n      this.pauseTime = 0;\n      this.frameDelay = 30;\n      this.gifFramerate = 100;\n      this.delta = -this.frameDelay;\n      this.sceneMode = constants.SCENE_NORMAL;\n      this.encoder = '';\n      this.delayTime = 0;\n      this.initList = ['flower'];\n      this.pattern = null;\n      this.bodybg = constants.BODY_BACKGROUND_COLOR;\n      this.backgroundColor = constants.BACKGROUND_COLOR;\n      this.lineColor = constants.LINE_COLOR;\n      this.backgroundAlpha = constants.BACKGROUND_ALPHA;\n      var key = this._u.getKeys(constants.SOURCE_MODES)[0];\n      this.sourceMode = constants.SOURCE_MODES[key];\n      this.canvasWidth = 500;\n      this.canvasHeight = 500;\n      this.midWidth = this.canvasWidth / 2;\n      this.midHeight = this.canvasHeight / 2;\n      this.maxRadius = Math.sqrt(this.midWidth * this.midWidth + this.midHeight * this.midHeight);\n      this.controlPointRadius = constants.CONTROL_POINT_RADIUS;\n      this.editMode = constants.EDIT_SHAPE;\n      this.highlightCurve = false;\n      this.seamlessAnimation = true;\n      this.fieldFocus = false;\n      this.settingShelf = {\n        'toggleCurveColor': this.toggleCurveColor,\n        'editMode': this.editMode\n      };\n      this.objList = [];\n      this.objTypes = [];\n      this.selectedObject = 0;\n      this.resourceList = {};\n      this.backgroundImageExists = false;\n      this.fillImageExists = false;\n      this.debugMode = true;\n      this.initializeCanvas = function () {\n        this.canvas = document.getElementById('canvas');\n        this.context = this.canvas.getContext('2d');\n        this.bindEvents();\n        this.build();\n        if (this.debugMode === true) {\n          var dataz = window.getSampleJSON();\n          this.loadData(dataz, false);\n        }\n        this.initialized = true;\n        this.redraw();\n      };\n    };\n    kit.prototype.digest = function () {\n    };\n    kit.prototype.build = function () {\n      var kit = this;\n      _u.each(_u.range(0, this.initList.length), function (i) {\n        if (kit.initList[i] === 'flower') {\n          kit.objList.push(new PetalFlower(kit, constants.DEFAULT_RAYS, 1, kit.canvasHeight / constants.DEFAULT_INNER_RADIUS_SCALAR, kit.canvasHeight / constants.DEFAULT_OUTER_RADIUS_SCALAR, Vector.create(kit.midWidth, kit.midHeight)));\n          kit.objTypes.push([\n            'flower',\n            constants.DEFAULT_RAYS,\n            1\n          ]);\n        }\n      });\n      this.initFrame();\n    };\n    kit.prototype.redraw = function () {\n      if (!this.initialized) {\n        return;\n      }\n      this.context.save();\n      this.context.setTransform(1, 0, 0, 1, 0, 0);\n      this.context.clearRect(0, 0, this.canvas.width, this.canvas.height);\n      this.context.restore();\n      this.context.strokeStyle = '#' + this.lineColor;\n      if (this.backgroundImageExists) {\n        this.context.drawImage(this.backgroundImage, 0, 0, this.canvasWidth, this.canvasHeight);\n      } else {\n        var rgb = _u.toRGB(this.backgroundColor);\n        this.context.fillStyle = 'rgba(' + rgb[0] + ', ' + rgb[1] + ', ' + rgb[2] + ', ' + this.backgroundAlpha + ')';\n        this.context.fillRect(0, 0, this.canvasWidth, this.canvasHeight);\n      }\n      var kit = this;\n      _u.each(this.objList, function (item) {\n        kit.context.save();\n        item.transform();\n        item.draw();\n        kit.context.restore();\n      });\n      if (this.editMode === constants.EDIT_SHAPE) {\n        this.objList[kit.selectedObject].drawShapePoints();\n      }\n      if (this.editMode === constants.EDIT_TRANSFORM) {\n        this.objList[kit.selectedObject].drawTransformPoints();\n      }\n    };\n    return kit;\n  }({}, constants, util, PetalFlower, Vector);\nvar FillImage = function (require, Vector, constants) {\n    \n    var Vector = Vector;\n    var constants = constants;\n    var FillImage = function (src, page, label) {\n      this.src = src;\n      this.page = page;\n      this.label = label;\n      this.image = new Image();\n      this.image.onload = function () {\n        window.kit.fillImageExists = true;\n        window.kit.redraw();\n      };\n      this.image.src = this.src;\n    };\n    FillImage.prototype.draw = function (transform, object) {\n      var kit = object.kit;\n      var sweepFrom = Vector.getPolarPoint(Vector.create(0, 0), kit.maxRadius, object.firstInnerAngle / object.radialAccent + transform.rotation);\n      var sweepTo = Vector.getPolarPoint(Vector.create(0, 0), kit.maxRadius, transform.rotation);\n      var temp_canvas = document.createElement('canvas');\n      temp_canvas.width = kit.canvasWidth;\n      temp_canvas.height = kit.canvasHeight;\n      var tempContext = temp_canvas.getContext('2d');\n      tempContext.setTransform(1, 0, 0, 1, object.center.x, object.center.y);\n      tempContext.save();\n      tempContext.beginPath();\n      tempContext.moveTo(0, 0);\n      tempContext.lineTo(sweepFrom.x, sweepFrom.y);\n      tempContext.lineTo(sweepTo.x, sweepTo.y);\n      tempContext.closePath();\n      tempContext.clip();\n      tempContext.drawImage(this.image, -kit.midWidth, -kit.midHeight, kit.canvasWidth, kit.canvasHeight);\n      tempContext.stroke();\n      tempContext.restore();\n      tempContext.save();\n      var reflectionMatrix = Vector.reflectMatrix(transform.rotation);\n      tempContext.setTransform(reflectionMatrix[0], reflectionMatrix[1], reflectionMatrix[2], reflectionMatrix[3], object.center.x, object.center.y);\n      tempContext.beginPath();\n      tempContext.moveTo(0, 0);\n      tempContext.lineTo(sweepFrom.x, sweepFrom.y);\n      tempContext.lineTo(sweepTo.x, sweepTo.y);\n      tempContext.closePath();\n      tempContext.clip();\n      tempContext.drawImage(this.image, -kit.midWidth, -kit.midHeight, kit.canvasWidth, kit.canvasHeight);\n      tempContext.stroke();\n      tempContext.restore();\n      kit.context.save();\n      kit.context.translate(-object.center.x, -object.center.y);\n      for (var i = 0; i < object.petalCount; i++) {\n        var matrix = kit.getRotationMatrix(constants.TWOPI / object.petalCount);\n        kit.context.transform(matrix[0], matrix[1], matrix[2], matrix[3], object.center.x, object.center.y);\n        kit.context.translate(-object.center.x, -object.center.y);\n        kit.context.drawImage(temp_canvas, 0, 0);\n      }\n      kit.context.restore();\n    };\n    return FillImage;\n  }({}, Vector, constants);\nvar canvasEvents = function (require, core, Vector, constants, util, CPoint) {\n    \n    var kit = core;\n    var Vector = Vector;\n    var constants = constants;\n    var _u = util;\n    var CPoint = CPoint;\n    kit.prototype.bindEvents = function () {\n      this.canvas.addEventListener('touchstart', this.startDrag, false);\n      this.canvas.addEventListener('touchend', this.endDrag, false);\n      this.canvas.addEventListener('touchmove', this.move, false);\n      this.canvas.addEventListener('mousedown', this.startDrag, false);\n      this.canvas.addEventListener('mouseup', this.endDrag, false);\n      this.canvas.addEventListener('mousemove', this.move, false);\n    };\n    kit.prototype.startDrag = function (event) {\n      var kit = window.kit;\n      if (kit.animationMode === true) {\n        return;\n      }\n      var position = _u.getPosition(event, kit.canvas);\n      var object = kit.objList[kit.selectedObject];\n      if (kit.editMode === constants.EDIT_SHAPE) {\n        _u.each(object.shapePoints, function (thisPoint) {\n          var actualPosition = object.reverseTransformPoint(position);\n          if (thisPoint.mouseInside(actualPosition)) {\n            thisPoint.inDrag = true;\n            kit.canvasMode = 'cpDrag';\n            kit.redraw();\n            return;\n          }\n        });\n      } else if (kit.editMode === constants.EDIT_TRANSFORM) {\n        _u.each(object.transformPoints, function (thisPoint) {\n          var positionInsideObject;\n          if (thisPoint.index !== 2) {\n            positionInsideObject = Vector.create(position.x - object.center.x, position.y - object.center.y);\n            positionInsideObject = Vector.rotate(0, 0, positionInsideObject, -object.rotation);\n          } else {\n            object.lastScale = object.scale;\n            positionInsideObject = Vector.create(position.x - object.center.x, position.y - object.center.y);\n          }\n          if (thisPoint.mouseInside(positionInsideObject)) {\n            thisPoint.inDrag = true;\n            kit.canvasMode = 'cpDrag';\n            kit.redraw();\n            return;\n          }\n        });\n      }\n    };\n    kit.prototype.endDrag = function (event) {\n      var kit = window.kit;\n      if (kit.animationMode === true) {\n        return;\n      }\n      kit.canvasMode = 'static';\n      kit.position = _u.getPosition(event, kit.canvas);\n      var object = kit.objList[kit.selectedObject];\n      if (kit.editMode === constants.EDIT_SHAPE) {\n        _u.each(object.shapePoints, function (thisPoint) {\n          if (thisPoint.inDrag === true) {\n            thisPoint.inDrag = false;\n            kit.redraw();\n          }\n        });\n      } else if (kit.editMode === constants.EDIT_TRANSFORM) {\n        _u.each(object.transformPoints, function (thisPoint) {\n          if (thisPoint.inDrag === true) {\n            thisPoint.inDrag = false;\n            if (thisPoint.index === 2) {\n              thisPoint.x = object.scaleDistance;\n            }\n            kit.redraw();\n          }\n        });\n      }\n      kit.getState();\n      kit.digest();\n    };\n    kit.prototype.move = function (event) {\n      var kit = window.kit;\n      if (kit.canvasMode !== 'cpDrag' || kit.animationMode === true) {\n        return;\n      }\n      var object = kit.objList[kit.selectedObject];\n      var position = _u.getPosition(event, kit.canvas);\n      var actualPosition = object.reverseTransformPoint(position);\n      var index = 0;\n      if (kit.editMode === kit.constants.EDIT_SHAPE) {\n        _u.each(object.shapePoints, function (thisPoint) {\n          if (thisPoint.inDrag) {\n            var newPoint = new CPoint(kit, _u.reduceSig(actualPosition.x, constants.MAX_CP_SIGS), _u.reduceSig(actualPosition.y, constants.MAX_CP_SIGS), object, index);\n            newPoint.inDrag = true;\n            object.updatePetal(index, newPoint);\n            kit.redraw();\n            return;\n          }\n          index++;\n        });\n      } else if (kit.editMode === kit.constants.EDIT_TRANSFORM) {\n        _u.each(object.transformPoints, function (thisPoint) {\n          if (thisPoint.inDrag) {\n            if (index === 0) {\n              object.center = position;\n            } else if (index === 1) {\n              var angleVector = Vector.create(position.x - object.center.x, position.y - object.center.y);\n              var angle = Vector.getRadians(Vector.create(0, 0), angleVector);\n              kit.setRotation(angle);\n              kit._u.debugConsole(angle);\n            } else if (index === 2) {\n              var newX = position.x - object.center.x;\n              object.setScale(newX);\n              thisPoint.x = newX;\n            }\n            kit.redraw();\n            return;\n          }\n          index++;\n        });\n      }\n    };\n    kit.prototype.constrain = function (point) {\n      if (point.x < 0) {\n        point.x = 0;\n      } else if (point.x > this.canvasWidth) {\n        point.x = this.canvasWidth;\n      }\n      if (point.y < 0) {\n        point.y = 0;\n      } else if (point.y > this.canvasHeight) {\n        point.y = this.canvasHeight;\n      }\n    };\n    return kit;\n  }({}, core, Vector, constants, util, CPoint);\nvar sceneEvents = function (require, core, constants, util, PetalFlower, CPoint, Vector) {\n    \n    var kit = core;\n    var constants = constants;\n    var _u = util;\n    var PetalFlower = PetalFlower;\n    var CPoint = CPoint;\n    var Vector = Vector;\n    kit.prototype.sceneLoop = function () {\n      if (!this.animationMode || this.keyFrames.length < 2) {\n        this.stopScene();\n        this.digest();\n        return;\n      }\n      if (this.sceneMode === constants.SCENE_GIF) {\n        this.delta += this.gifFramerate;\n      } else {\n        this.delta = _u.msTime() - this.segmentStartTime;\n      }\n      var lastStartTime = _u.msTime();\n      if (this.segment === 0 && this.delta >= this.pauseTime) {\n        this.segment = 1;\n        this.delta = 0;\n        this.segmentStartTime = _u.msTime();\n      } else if (this.segment !== 0) {\n        if (this.delta > this.keyFrames[this.segment - 1].timing * 1000) {\n          if (this.segment === this.keyFrames.length - 1 && this.seamlessAnimation === false) {\n            this.segment = 0;\n            this.setState();\n            this.segment = 1;\n            this.delta = 0;\n            this.segmentStartTime = _u.msTime();\n          } else if (this.segment < this.keyFrames.length) {\n            this.setState();\n            this.segment++;\n            if (this.sceneMode === this.GIF) {\n              this.delta = 0;\n            } else {\n              this.segmentStartTime = _u.msTime();\n            }\n          } else {\n            if (this.sceneMode === constants.SCENE_GIF) {\n              this.gifComplete();\n              return;\n            }\n            this.segment = 0;\n            this.setState();\n            this.segmentStartTime = _u.msTime();\n          }\n        } else {\n          this.updateSegment(this.delta);\n        }\n      }\n      this.digest();\n      if (this.sceneMode === constants.SCENE_GIF) {\n        this.encoder.addFrame(this.context);\n        setTimeout(function () {\n          window.kit.sceneLoop();\n        }, 0.01);\n      } else {\n        var processTime = _u.msTime() - lastStartTime;\n        setTimeout(function () {\n          window.kit.sceneLoop();\n        }, Math.max(0, window.kit.frameDelay - processTime));\n      }\n    };\n    kit.prototype.updateSegment = function (delta) {\n      var keyTo = this.segment;\n      if (this.segment === this.keyFrames.length) {\n        keyTo = 0;\n      }\n      var sig = delta / (this.keyFrames[keyTo].timing * 1000);\n      var objIndex = 0;\n      var kit = this;\n      _u.each(this.keyFrames[keyTo].obj, function (ob) {\n        var index = 0;\n        var newCps = [];\n        var obFrom = kit.keyFrames[kit.segment - 1].obj[objIndex];\n        _u.each(ob.shapePoints, function (cp) {\n          var newX = obFrom.shapePoints[index].x * (1 - sig) + cp.x * sig;\n          var newY = obFrom.shapePoints[index].y * (1 - sig) + cp.y * sig;\n          var newPoint = new CPoint(kit, newX, newY, kit.objList[objIndex], index);\n          newCps.push(newPoint);\n          index++;\n        });\n        var newState = { shapePoints: newCps };\n        var fromRotation = obFrom.rotation;\n        var toRotation = ob.rotation;\n        var del = toRotation - fromRotation;\n        if (Math.abs(del) > Math.PI) {\n          if (del < 0) {\n            toRotation += 2 * Math.PI;\n          } else {\n            fromRotation += 2 * Math.PI;\n          }\n        }\n        newState.rotation = (fromRotation * (1 - sig) + toRotation * sig) % 360;\n        newState.position = Vector.create(obFrom.position.x * (1 - sig) + ob.position.x * sig, obFrom.position.y * (1 - sig) + ob.position.y * sig);\n        newState.scale = obFrom.scale * (1 - sig) + ob.scale * sig;\n        kit.objList[objIndex].setState(newState);\n        objIndex++;\n      });\n    };\n    kit.prototype.segmentLoop = function () {\n      if (!this.animationMode || this.segment === 0) {\n        this.setState();\n        this.digest();\n        return;\n      }\n      var delta = _u.msTime() - this.loopStartTime - this.pauseTime;\n      if (delta < 0) {\n        if (this.setTime !== 0) {\n          this.segment--;\n          this.setState();\n          this.segment++;\n          this.setTime = 0;\n        }\n      } else if (delta > this.keyFrames[this.segment].timing * 1000) {\n        if (delta > this.keyFrames[this.segment].timing * 1000 + this.pauseTime) {\n          this.loopStartTime = _u.msTime();\n          this.segment--;\n          this.setState();\n          this.segment++;\n          this.setTime = 0;\n        } else if (this.setTime !== this.keyFrames[this.segment].timing * 1000) {\n          this.setState();\n          this.setTime = this.keyFrames[this.segment].timing * 1000;\n        }\n      } else {\n        var sig = delta / (this.keyFrames[this.segment].timing * 1000);\n        var objIndex = 0;\n        var kit = this;\n        _u.each(this.keyFrames[this.segment].obj, function (ob) {\n          var index = 0;\n          var newCps = [];\n          _u.each(ob.shapePoints, function (cp) {\n            var newX = kit.keyFrames[kit.segment - 1].obj[objIndex].shapePoints[index].x * (1 - sig) + cp.x * sig;\n            var newY = kit.keyFrames[kit.segment - 1].obj[objIndex].shapePoints[index].y * (1 - sig) + cp.y * sig;\n            var newPoint = new CPoint(kit, newX, newY, kit.objList[objIndex], index);\n            newCps.push(newPoint);\n            index++;\n          });\n          var newState = { shapePoints: newCps };\n          var obFrom = kit.keyFrames[kit.segment - 1].obj[objIndex];\n          var fromRotation = obFrom.rotation;\n          var toRotation = ob.rotation;\n          var del = toRotation - fromRotation;\n          if (Math.abs(del) > 180) {\n            if (del < 0) {\n              toRotation += 360;\n            } else {\n              fromRotation += 360;\n            }\n          }\n          newState.rotation = (fromRotation * (1 - sig) + toRotation * sig) % 360;\n          newState.position = Vector.create(obFrom.center.x * (1 - sig) + ob.center.x * sig, obFrom.center.y * (1 - sig) + ob.center.y * sig);\n          newState.scale = obFrom.scale * (1 - sig) + ob.scale * sig;\n          kit.objList[objIndex].setState(newState);\n          objIndex++;\n        });\n      }\n      setTimeout(function () {\n        window.kit.segmentLoop();\n      }, window.kit.frameDelay);\n    };\n    kit.prototype.initFrame = function () {\n      this.keyFrames[this.segment] = {};\n      this.keyFrames[this.segment].obj = [];\n      if (this.segment > 0) {\n        this.keyFrames[this.segment].timing = this.keyFrames[this.segment - 1].timing;\n        for (var i = 0; i < this.objList; i++) {\n          this.keyFrames[this.segment].obj[i].rotation = this.keyFrames[this.segment - 1].obj[i].rotation;\n          this.keyFrames[this.segment].obj[i].center = this.keyFrames[this.segment - 1].obj[i].center;\n          this.keyFrames[this.segment].obj[i].scale = this.keyFrames[this.segment - 1].obj[i].scale;\n        }\n      } else {\n        this.keyFrames[this.segment].timing = constants.DEFAULT_LENGTH;\n        for (var ind = 0; ind < this.objList; ind++) {\n          this.keyFrames[this.segment].obj[ind].rotation = 0;\n          this.keyFrames[this.segment].obj[ind].position = new Vector(this.objList[0].center.x, this.objList[0].center.y);\n          this.keyFrames[this.segment].obj[ind].scale = 1;\n        }\n      }\n      this.storeFrame();\n    };\n    kit.prototype.clearScene = function () {\n      this.objList = [];\n      this.objTypes = [];\n      this.resourceList = {};\n      this.backgroundImageExists = false;\n      this.fillImageExists = false;\n      this.keyFrames = [];\n      this.segment = 0;\n      this.objList.push(new PetalFlower(this, constants.DEFAULT_RAYS, 1, this.canvasHeight / constants.DEFAULT_INNER_RADIUS_SCALAR, this.canvasHeight / constants.DEFAULT_OUTER_RADIUS_SCALAR, Vector.create(this.midWidth, this.midHeight)));\n      this.objTypes.push([\n        'flower',\n        constants.DEFAULT_RAYS,\n        1\n      ]);\n      this.selectedObject = 0;\n      this.initFrame();\n      this.redraw();\n      this.digest();\n    };\n    kit.prototype.storeFrame = function () {\n      for (var i = 0; i < this.objList.length; i++) {\n        this.keyFrames[this.segment].obj[i] = this.objList[i].getState();\n      }\n      var val = this.objList[this.selectedObject].rotation;\n    };\n    kit.prototype.removeKeyframe = function () {\n      if (this.keyFrames.length < 2) {\n        return;\n      }\n      _u.removeArrayEntry(this.keyFrames, this.segment);\n      if (this.segment === this.keyFrames.length) {\n        this.segment--;\n      }\n      this.setState();\n      this.redraw();\n      this.digest();\n    };\n    kit.prototype.removeLast = function () {\n      if (this.keyFrames.length < 2) {\n        return;\n      }\n      _u.removeArrayEntry(this.keyFrames, this.keyFrames.length - 1);\n      if (this.segment === this.keyFrames.length) {\n        this.segment--;\n      }\n      this.setState();\n      this.redraw();\n      this.digest();\n    };\n    kit.prototype.gifInit = function () {\n      this.encoder.setRepeat(-1);\n      this.encoder.setDelay(this.gifFramerate);\n      this.encoder.setSize(this.canvasWidth, this.canvasHeight);\n      this.encoder.start();\n      this.sceneMode = constants.SCENE_GIF;\n      this.loopInit();\n      this.redraw();\n    };\n    kit.prototype.gifComplete = function () {\n      this.encoder.finish();\n      var binary_gif = this.encoder.stream().getData();\n      var data_url = 'data:image/gif;base64,' + window.encode64(binary_gif);\n      window.open(data_url, '_blank');\n      this.sceneMode = constants.SCENE_NORMAL;\n      this.stopScene();\n    };\n    kit.prototype.loopInit = function () {\n      this.animationMode = true;\n      this.segment = 0;\n      this.loopStartTime = _u.msTime();\n      this.segmentStartTime = this.loopStartTime;\n      this.setTempModes(constants.EDIT_NONE, false);\n    };\n    kit.prototype.stopScene = function () {\n      this.restoreModes();\n      this.sceneReset();\n    };\n    kit.prototype.sceneReset = function () {\n      this.animationMode = false;\n      this.segment = 0;\n      this.setState();\n      this.redraw();\n    };\n    kit.prototype.playSegment = function () {\n      if (kit.keyFrames.length < 2) {\n        return;\n      }\n      kit.animationMode = true;\n      if (kit.segment !== 0) {\n        kit.segment--;\n      }\n      kit.setState();\n      kit.segment++;\n      kit.setTime = 0;\n      kit.loopStartTime = new Date().getTime();\n      kit.segmentLoop();\n    };\n    kit.prototype.setState = function () {\n      for (var i = 0; i < this.objList.length; i++) {\n        this.objList[i].setState(this.keyFrames[this.segment].obj[i]);\n      }\n    };\n    kit.prototype.selectFirst = function () {\n      this.segment = 0;\n      this.setState();\n    };\n    kit.prototype.selectPrev = function () {\n      if (this.segment > 0) {\n        this.segment--;\n        for (var i = 0; i < this.objList.length; i++) {\n          this.objList[i].setState(this.keyFrames[this.segment].obj[i]);\n        }\n      }\n    };\n    kit.prototype.selectNext = function () {\n      this.segment++;\n      if (this.segment >= this.keyFrames.length) {\n        this.initFrame();\n      } else {\n        this.setState();\n      }\n    };\n    kit.prototype.selectLast = function () {\n      this.segment = this.keyFrames.length - 1;\n      this.setState();\n    };\n    kit.prototype.getSegment = function () {\n      if (!this.initialized) {\n        return 0;\n      } else if (this.animationMode) {\n        return (this.segment + this.keyFrames.length - 1) % this.keyFrames.length;\n      } else {\n        return this.segment;\n      }\n    };\n    return kit;\n  }({}, core, constants, util, PetalFlower, CPoint, Vector);\nvar objectEvents = function (require, core, constants, util, Vector, PetalFlower, FillImage) {\n    \n    var kit = core;\n    var constants = constants;\n    var _u = util;\n    var Vector = Vector;\n    var PetalFlower = PetalFlower;\n    var FillImage = FillImage;\n    kit.prototype.setState = function () {\n      for (var i = 0; i < this.objList.length; i++) {\n        this.objList[i].setState(this.keyFrames[this.segment].obj[i]);\n      }\n    };\n    kit.prototype.getState = function () {\n      for (var i = 0; i < this.objList.length; i++) {\n        this.keyFrames[this.segment].obj[i] = this.objList[i].getState();\n      }\n      this.keyFrames[this.segment].timing = parseFloat(document.getElementById('length').value);\n    };\n    kit.prototype.getRotation = function () {\n      var rotationDegrees = this.keyFrames[this.segment].obj[this.selectedObject].rotation / this.constants.TWOPIDIV360;\n      return Math.floor(rotationDegrees * 100) / 100;\n    };\n    kit.prototype.getRotationMatrix = function (angle) {\n      var cos = Math.cos(angle);\n      var sin = Math.sin(angle);\n      return [\n        cos,\n        sin,\n        -sin,\n        cos,\n        0,\n        0\n      ];\n    };\n    kit.prototype.setRotation = function (val) {\n      this.objList[this.selectedObject].rotation = val;\n      this.keyFrames[this.segment].obj[this.selectedObject].rotation = val;\n      this.objList[this.selectedObject].allPetals = [];\n      this.objList[this.selectedObject].createPetals();\n      this.redraw();\n    };\n    kit.prototype.addFillImage = function (src) {\n      this.fillImage = new FillImage(src);\n      this.resourceList.fillImageSource = src;\n    };\n    kit.prototype.addBackgroundImage = function (src) {\n      this.backgroundImage = new Image();\n      this.backgroundImage.onload = function () {\n        window.kit.backgroundImageExists = true;\n        window.kit.redraw();\n      };\n      this.backgroundImage.src = src;\n      this.resourceList.backgroundImageSource = src;\n    };\n    kit.prototype.updatePetalCount = function (petals) {\n      var object = this.objList[this.selectedObject];\n      if (object instanceof PetalFlower) {\n        this.objList[this.selectedObject] = new PetalFlower(this, petals, object.radialAccent, this.canvasHeight / constants.DEFAULT_INNER_RADIUS_SCALAR, this.canvasHeight / constants.DEFAULT_OUTER_RADIUS_SCALAR, Vector.create(this.midWidth, this.midHeight));\n        this.objTypes[this.selectedObject][1] = petals;\n        this.objList[this.selectedObject].updateRadialPoint();\n        this.setState();\n        this.redraw();\n      }\n    };\n    kit.prototype.updateRadialAccent = function (radialScalar) {\n      this.objTypes[this.selectedObject][2] = radialScalar;\n      var thisObject = this.objList[this.selectedObject];\n      if (radialScalar > 0 && radialScalar < thisObject.petalCount) {\n        thisObject.accentRadialPoint(radialScalar);\n        this.setState();\n        this.redraw();\n      }\n    };\n    kit.prototype.selectObject = function (obj) {\n      obj = parseFloat(obj);\n      if (this.selectedObject !== obj && obj < this.objList.length && obj < this.constants.MAX_OBJECTS && obj >= 0) {\n        this.selectedObject = obj;\n        this.redraw();\n        this.digest();\n      }\n    };\n    kit.prototype.addObject = function () {\n      if (this.objList.length >= constants.MAX_OBJECTS) {\n        return;\n      }\n      this.objList.push(new PetalFlower(this, constants.DEFAULT_RAYS, 1, this.canvasHeight / constants.DEFAULT_INNER_RADIUS_SCALAR, this.canvasHeight / constants.DEFAULT_OUTER_RADIUS_SCALAR, Vector.create(this.midWidth, this.midHeight)));\n      this.objTypes.push([\n        'flower',\n        constants.DEFAULT_RAYS,\n        1\n      ]);\n      for (var i = 0; i < this.keyFrames.length; i++) {\n        this.keyFrames[i].obj[this.objList.length - 1] = this.objList[this.objList.length - 1].getState();\n        this.keyFrames[i].obj[this.objList.length - 1].timing = document.getElementById('length').value;\n      }\n      var ind = this.objList.length - 1;\n      this.selectedObject = ind;\n      this.redraw();\n      this.digest();\n    };\n    kit.prototype.removeObject = function () {\n      if (this.objList.length < 2) {\n        return;\n      }\n      _u.removeArrayEntry(this.objList, this.selectedObject);\n      _u.removeArrayEntry(this.objTypes, this.selectedObject);\n      var kit = this;\n      _u.each(this.keyFrames, function (keyFrame) {\n        _u.removeArrayEntry(keyFrame.obj, kit.selectedObject);\n      });\n      if (this.selectedObject === this.objList.length) {\n        this.selectedObject--;\n      }\n      this.redraw();\n      this.digest();\n    };\n    kit.prototype.getImage = function () {\n      this.setTempModes(constants.EDIT_NONE, false);\n      this.redraw();\n      window.open(this.canvas.toDataURL('image/png'));\n      this.restoreModes();\n      this.redraw();\n    };\n    kit.prototype.setAlpha = function (newAlpha) {\n      newAlpha = _u.parseFloatOrDefault(newAlpha, 1);\n      if (newAlpha > 1) {\n        this.backgroundAlpha = 1;\n      } else if (newAlpha < 0) {\n        this.backgroundAlpha = 0;\n      } else {\n        this.backgroundAlpha = newAlpha;\n      }\n      this.redraw();\n    };\n    return kit;\n  }({}, core, constants, util, Vector, PetalFlower, FillImage);\nvar settingsEvents = function (require, core, constants, util, PetalFlower, Vector) {\n    \n    var kit = core;\n    var constants = constants;\n    var _u = util;\n    var PetalFlower = PetalFlower;\n    var Vector = Vector;\n    kit.prototype.getSettings = function (data, preinit) {\n      return {\n        'backgroundColor': this.backgroundColor,\n        'backgroundAlpha': this.backgroundAlpha,\n        'lineColor': this.lineColor,\n        'sourceMode': this.sourceMode,\n        'seamlessAnimation': this.seamlessAnimation\n      };\n    };\n    kit.prototype.loadData = function (data, preinit) {\n      this.objList = [];\n      this.objTypes = [];\n      this.resourceList = data[1];\n      this.objTypes = data[2];\n      this.keyFrames = data[3];\n      this.objList = [];\n      for (var i = 0; i < this.objTypes.length; i++) {\n        if (this.objTypes[i][0] === 'flower') {\n          this.objList.push(new PetalFlower(this, this.objTypes[i][1], this.objTypes[i][2], this.canvasHeight / constants.DEFAULT_INNER_RADIUS_SCALAR, this.canvasHeight / constants.DEFAULT_OUTER_RADIUS_SCALAR, Vector.create(this.midWidth, this.midHeight)));\n        }\n      }\n      this.options = data[0];\n      if (_u.exists(this.options.backgroundColor)) {\n        this.backgroundColor = this.options.backgroundColor;\n      } else {\n        this.backgroundColor = constants.BACKGROUND_COLOR;\n      }\n      if (_u.exists(this.options.backgroundAlpha)) {\n        this.backgroundAlpha = this.options.backgroundAlpha;\n      } else {\n        this.backgroundAlpha = constants.BACKGROUND_ALPHA;\n      }\n      if (_u.exists(this.options.lineColor)) {\n        this.lineColor = this.options.lineColor;\n      } else {\n        this.lineColor = constants.LINE_COLOR;\n      }\n      this.currentSelector = 'bg-color';\n      window.setColor('#' + this.backgroundColor);\n      this.currentSelector = 'line-color';\n      window.setColor('#' + this.lineColor);\n      if (_u.exists(this.options.sourceMode)) {\n        this.sourceMode = this.options.sourceMode;\n      } else {\n        this.sourceMode = constants.SOURCE_MODE;\n      }\n      if (_u.exists(this.options.seamlessAnimation)) {\n        this.seamlessAnimation = this.options.seamlessAnimation;\n      } else {\n        this.seamlessAnimation = true;\n      }\n      this.backgroundImageExists = false;\n      this.fillImageExists = false;\n      if (typeof this.resourceList.backgroundImageSource === 'string') {\n        this.addBackgroundImage(this.resourceList.backgroundImageSource);\n      }\n      if (typeof this.resourceList.fillImageSource === 'string') {\n        this.addFillImage(this.resourceList.fillImageSource);\n      }\n      this.selectedObject = 0;\n      this.segment = 0;\n      this.setState();\n    };\n    kit.prototype.setTempModes = function (editMode, toggleCurveColor) {\n      this.settingShelf = {\n        'editMode': this.editMode,\n        'toggleCurveColor': this.toggleCurveColor\n      };\n      this.editMode = editMode;\n      this.toggleCurveColor = toggleCurveColor;\n    };\n    kit.prototype.restoreModes = function () {\n      this.editMode = this.settingShelf.editMode;\n      this.toggleCurveColor = this.settingShelf.toggleCurveColor;\n    };\n    return kit;\n  }({}, core, constants, util, PetalFlower, Vector);\nvar src_app = function (require, core, constants, Vector, CPoint, Transform, FillImage, PetalFlower, canvasEvents, sceneEvents, objectEvents, settingsEvents) {\n    \n    var kit = core;\n    var _globalInit = function () {\n      window.kit = new kit();\n      initKeyboard();\n      kit.encoder = new GIFEncoder();\n      setTimeout(window.initInterface, 400);\n    };\n    if (document.readyState === 'complete') {\n      _globalInit();\n    } else {\n      window.addEventListener('load', _globalInit, false);\n    }\n    return window.kit;\n  }({}, core, constants, Vector, CPoint, Transform, FillImage, PetalFlower, canvasEvents, sceneEvents, objectEvents, settingsEvents);\n"]}