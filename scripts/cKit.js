/*! cKit.js v0.4.4 November 24, 2014 */
var constants=function(){var a=Math.PI;return{SCENE_NORMAL:0,SCENE_GIF:1,EDIT_SHAPE:0,EDIT_TRANSFORM:1,EDIT_NONE:2,PI:a,TWOPIDIV360:2*Math.PI/360,TWOPI:2*Math.PI,MAX_OBJECTS:4,DEFAULT_RAYS:6,DEFAULT_INNER_RADIUS_SCALAR:17,DEFAULT_OUTER_RADIUS_SCALAR:2.2,CONTROL_POINT_RADIUS:6,DEFAULT_LENGTH:1.5,MAX_CP_SIGS:4,BACKGROUND_COLOR:"010201",BACKGROUND_ALPHA:"1",LINE_COLOR:"9fb4f4",BODY_BACKGROUND_COLOR:"020202",MAX_CLICK_DISTANCE:2,SOURCE_MODES:{lighter:"lighter",darker:"darker",xor:"xor","source-atop":"atop","source-out":"out","source-over":"over","destination-atop":"bottom","destination-out":"bottom-out"}}}({}),util=function(a,b){var b=b;return{getPosition:function(a,b){var c=b.getBoundingClientRect();return{x:a.clientX-c.left,y:a.clientY-c.top}},clone:function(a){if(null==a||"object"!=typeof a)return a;var b=a.constructor();for(var c in a)a.hasOwnProperty(c)&&(b[c]=a[c]);return b},dnexist:function(a){return"undefined"==typeof a},exists:function(a){return"undefined"!=typeof a},encodeToHex:function(a){return parseInt(255*a).toString(16)},decodeFromHex:function(a){return parseInt(a,16)},parseIntOrDefault:function(a,b){return a=parseInt(a),Number.isInteger(a)?a:b},parseFloatOrDefault:function(a,b){return a=parseFloat(a),isNaN(a)?b:a},reduceSig:function(a,b){var c=Math.pow(10,b);return Math.round(a*c+1e-5)/c},degreesToRadians:function(a){return b.TWOPIDIV360*a},toRGB:function(a){return[this.decodeFromHex(a.substring(0,2)),this.decodeFromHex(a.substring(2,4)),this.decodeFromHex(a.substring(4,6))]},msTime:function(){return(new Date).getTime()},each:function(a,b){if(null==a)return a;var c,d=a.length;if(d===+d)for(c=0;d>c;c++)b(a[c],c,a);else{var e=window.kit._u.getKeys(a);for(c=0,d=e.length;d>c;c++)b(a[e[c]],e[c],a)}return a},getKeys:function(a){return Object.keys(a)},range:function(a,b){for(var c=[],d=a;b>d;d++)c.push(d);return c},indexOf:function(a,b){for(var c=0;c<a.length;c++)if(a[c]===b)return c;return console.log("There is a bug with a call to indexOf"),-1},removeArrayEntry:function(a,b){a.splice(b,1)},debugConsole:function(){document.getElementById("console")}}}({},constants),Vector=function(a,b){var b=b;return{create:function(a,b){return{x:a,y:b}},multiply:function(a,b){return a.x*=b,a.y*=b,a},add:function(a,b){return a.x+=b.x,a.y+=b.y,a},getPoint:function(a,b,c,d){var e=a+c*Math.sin(d),f=b-c*Math.cos(d),g=this.create(e,f);return g},getPolarPoint:function(a,b,c){var d=a.x+b*Math.sin(c),e=a.y-b*Math.cos(c),f=this.create(d,e);return f},rotate:function(a,b,c,d){var e=Math.cos(d),f=Math.sin(d),g=e*(c.x-a)-f*(c.y-b)+a,h=f*(c.x-a)+e*(c.y-b)+b;return this.create(g,h)},distance:function(a,b){var c=a.x-b.x,d=a.y-b.y;return Math.sqrt(c*c+d*d)},getRadians:function(a,c){var d=c.x-a.x,e=a.y-c.y,f=Math.atan2(d,e);return 0>f&&(f+=b.TWOPI),f},getDegrees:function(a,c){var d=c.x-a.x,e=a.y-c.y,f=Math.atan2(d,e)*b.TWOPIDIV360;return 0>f&&(f+=360),f},zeroVector:function(){return{x:0,y:0}},reflectMatrix:function(a){return[Math.cos(2*a),Math.sin(2*a),Math.sin(2*a),-Math.cos(2*a)]}}}({},constants),CPoint=function(a,b,c){var b=b,c=c,d=function(a,d,e,f,g){this.kit=a,this.x=d,this.y=e,this.parentObject=f,this.index=g,this.inDrag=!1,this.draw=function(){var a;if(a=this.kit.editMode!==b.EDIT_TRANSFORM||2!==this.index?c.rotate(0,0,this,f.rotation):this,this.inDrag){var d,e=f.shapePoints;this.kit.editMode===b.EDIT_TRANSFORM&&(e=f.transformPoints),1===this.index?(d=c.rotate(0,0,e[0],f.rotation),this.kit.context.beginPath(),this.kit.context.moveTo(a.x,a.y),this.kit.context.lineTo(d.x,d.y),this.kit.context.stroke()):2===this.index&&(d=this.kit.editMode===b.EDIT_TRANSFORM?e[0]:c.rotate(0,0,e[3],f.rotation),this.kit.context.beginPath(),this.kit.context.moveTo(a.x,a.y),this.kit.context.lineTo(d.x,d.y),this.kit.context.stroke())}this.kit.context.beginPath(),this.kit.context.arc(a.x,a.y,this.kit.controlPointRadius,0,2*Math.PI,!0),this.kit.context.closePath(),this.kit.context.lineWidth=1,this.inDrag?(this.kit.context.fillStyle="#999999",this.kit.context.fill()):(this.kit.context.fillStyle="#FFFFFF",this.kit.context.fill()),this.kit.context.stroke()},this.mouseInside=function(a){return this.kit.controlPointRadius+b.MAX_CLICK_DISTANCE>c.distance(a,this)*this.parentObject.scale}};return d}({},constants,Vector),Transform=function(){var a=function(a,b,c){this.position=a,this.scale=b,this.rotation=c};return a.prototype.getMatrix=function(){var a=Math.cos(this.rotation),b=Math.sin(this.rotation);return[this.scale*a,b,-b,this.scale*a,this.position.x,this.position.y]},a}({}),PetalFlower=function(a,b,c,d,e){var b=b,c=c,d=d,f=e,g=function(a,d,e,f,g,h){this.kit=a,this.petalCount=d,this.radialAccent=e,this.allPetals=[],this.firstPetal=[],this.thisAngle=0,this.increment=2*Math.PI/d,this.firstInnerAngle=-.5*this.increment*e,this.shapePoints=[],this.transformPoints=[],this.rotation=0,this.center=h,this.scaleDistance=this.kit.midWidth/2,this.scale=1,this.lastScale=1;var i,j,k,l;i=c.getPoint(0,0,f,this.firstInnerAngle);var m=(g-f)/2+f;j=c.getPoint(0,0,m,this.firstInnerAngle),k=c.getPoint(0,0,g,0),k.x=k.x-40,l=c.getPoint(0,0,g,0),this.firstPetal.push(i),this.shapePoints.push(new b(a,i.x,i.y,this,0)),this.shapePoints.push(new b(a,j.x,j.y,this,1)),this.firstPetal.push(j),this.shapePoints.push(new b(a,k.x,k.y,this,2)),this.firstPetal.push(k),this.shapePoints.push(new b(a,l.x,l.y,this,3)),this.firstPetal.push(l),this.firstPetal.push(c.create(-k.x,k.y)),this.firstPetal.push(c.create(-j.x,j.y)),this.firstPetal.push(c.create(-i.x,i.y)),this.transformPoints.push(new b(this.kit,0,0,this,0));var n=c.create(0,-this.kit.midHeight/2.5);c.rotate(0,0,n,this.rotation),this.transformPoints.push(new b(this.kit,n.x,n.y,this,1)),this.transformPoints.push(new b(this.kit,this.scaleDistance,0,this,2)),this.createPetals()};return g.prototype.draw=function(){var a=0,b=this,e=this.kit;e.context.beginPath(),f.each(this.allPetals,function(d){if(0===b.rotation)e.context.moveTo(d[0].x,d[0].y),e.context.bezierCurveTo(d[1].x,d[1].y,d[2].x,d[2].y,d[3].x,d[3].y),e.context.bezierCurveTo(d[4].x,d[4].y,d[5].x,d[5].y,d[6].x,d[6].y),e.context.moveTo(d[6].x,d[6].y),e.context.lineTo(d[0].x,d[0].y);else{for(var f=[],g=0;g<d.length;g++)f.push(c.rotate(0,0,d[g],b.rotation));e.context.moveTo(f[0].x,f[0].y),e.context.bezierCurveTo(f[1].x,f[1].y,f[2].x,f[2].y,f[3].x,f[3].y),e.context.bezierCurveTo(f[4].x,f[4].y,f[5].x,f[5].y,f[6].x,f[6].y),e.context.moveTo(f[6].x,f[6].y),e.context.lineTo(f[0].x,f[0].y)}a++}),e.context.closePath(),e.fillImageExists?(e.context.globalCompositeOperation=e.sourceMode,e.context.clip(),e.fillImage.draw(new d(this.center,this.scale,this.rotation),this),e.highlightCurve===!0&&(e.context.globalCompositeOperation="source-over",e.context.lineWidth=1.9,e.context.stroke())):(e.context.globalCompositeOperation="source-over",e.context.stroke())},g.prototype.createPetals=function(){this.allPetals.push(this.firstPetal);for(var a=1;a<this.petalCount;a++){var b=[],d=a*this.increment;f.each(this.firstPetal,function(a){var e=c.rotate(0,0,a,d);b.push(e)}),this.allPetals.push(b)}},g.prototype.updatePetal=function(a,b){var d=c.create(b.x,b.y);if(3===a)d.x=0,this.firstPetal[3].x=0,this.firstPetal[a].y=b.y;else if(0===a){var e=c.distance(c.create(0,0),c.create(b.x,b.y));d=c.getPoint(0,0,e,this.firstInnerAngle),d.x=f.reduceSig(d.x,constants.MAX_CP_SIGS),d.y=f.reduceSig(d.y,constants.MAX_CP_SIGS),this.firstPetal[0].x=d.x,this.firstPetal[0].y=d.y,this.firstPetal[6].x=-d.x,this.firstPetal[6].y=d.y}else this.firstPetal[a].x=b.x,this.firstPetal[6-a].x=-b.x,this.firstPetal[6-a].y=b.y,this.firstPetal[a].y=b.y;this.allPetals=[],this.createPetals(),this.shapePoints[a].x=d.x,this.shapePoints[a].y=d.y},g.prototype.updateTransform=function(a,b){var d=c.create(b.x,b.y);this.transformPoints[a].x=d.x,this.transformPoints[a].y=d.y},g.prototype.transform=function(){this.kit.context.transform(this.scale,0,0,this.scale,this.center.x,this.center.y)},g.prototype.translateTranform=function(){this.kit.context.transform(1,0,0,1,this.center.x,this.center.y)},g.prototype.reverseTransformPoint=function(a){var b=c.create(a.x-this.center.x,a.y-this.center.y);return b.x/=this.scale,b.y/=this.scale,b=c.rotate(0,0,b,-this.rotation)},g.prototype.setScale=function(a){this.scale=this.lastScale*a/this.scaleDistance},g.prototype.resetScalePoint=function(){this.transformPoints[2].x=this.scaleDistance},g.prototype.updateFirstPetal=function(){this.firstPetal[0].x=this.shapePoints[0].x,this.firstPetal[0].y=this.shapePoints[0].y,this.firstPetal[1].x=this.shapePoints[1].x,this.firstPetal[1].y=this.shapePoints[1].y,this.firstPetal[2].x=this.shapePoints[2].x,this.firstPetal[2].y=this.shapePoints[2].y,this.firstPetal[3].x=this.shapePoints[3].x,this.firstPetal[3].y=this.shapePoints[3].y,this.firstPetal[4].x=-this.shapePoints[2].x,this.firstPetal[4].y=this.shapePoints[2].y,this.firstPetal[5].x=-this.shapePoints[1].x,this.firstPetal[5].y=this.shapePoints[1].y,this.firstPetal[6].x=-this.shapePoints[0].x,this.firstPetal[6].y=this.shapePoints[0].y},g.prototype.setControlPoint=function(a,b){this.shapePoints[this.kit.indexOf(this.shapePoints,a)]=b},g.prototype.updateRadialPoint=function(){this.increment=2*Math.PI/this.petalCount,this.firstInnerAngle=-.5*this.increment*this.radialAccent;var a=this.kit,b=this;f.each(a.keyFrames,function(d){var e=d.obj[a.selectedObject].shapePoints[0],f=c.distance(c.zeroVector(),c.create(e.x,e.y)),g=c.getPolarPoint(c.zeroVector(),f,b.firstInnerAngle);e.x=g.x,e.y=g.y})},g.prototype.accentRadialPoint=function(a){this.radialAccent=a,this.increment=2*Math.PI/this.petalCount,this.firstInnerAngle=-.5*this.increment*a;var b=this.kit,d=this;f.each(b.keyFrames,function(a){var e=a.obj[b.selectedObject].shapePoints[0],f=c.distance(c.zeroVector(),c.create(e.x,e.y)),g=c.getPolarPoint(c.zeroVector(),f,d.firstInnerAngle);e.x=g.x,e.y=g.y})},g.prototype.drawShapePoints=function(){this.kit.context.save(),this.kit.context.transform(1,0,0,1,this.center.x,this.center.y);var a=this;f.each(this.shapePoints,function(c){var d=new b(a.kit,c.x*a.scale,c.y*a.scale,a,c.index);d.draw()}),this.kit.context.restore()},g.prototype.drawTransformPoints=function(){this.kit.context.save(),this.translateTranform(),this.transformPoints[0].draw(),this.transformPoints[1].draw(),this.transformPoints[2].draw(),this.kit.context.restore()},g.prototype.getState=function(){var a=[];return f.each(this.shapePoints,function(b){a.push(c.create(b.x,b.y))}),{shapePoints:a,rotation:this.rotation,scale:this.scale,position:this.center}},g.prototype.setState=function(a){var b=this.kit;this.rotation=a.rotation,this.center=a.position,this.scale=a.scale,b.index=0,f.each(this.shapePoints,function(c){c.x=a.shapePoints[b.index].x,c.y=a.shapePoints[b.index].y,b.index++}),this.allPetals=[],this.updateFirstPetal(),this.createPetals(),b.redraw()},g}({},CPoint,Vector,Transform,util),core=function(a,b,c,d,e){var b=b,f=c,d=d,e=e,g=function(){this.constants=b,this._u=f,this.initialized=!1,this.keyFrames=[],this.updateMode=!1,this.animationMode=!1,this.segmentStartTime=0,this.segment=0,this.loopStartTime=0,this.setTime=0,this.pauseTime=0,this.frameDelay=30,this.gifFramerate=100,this.delta=-this.frameDelay,this.sceneMode=b.SCENE_NORMAL,this.encoder="",this.delayTime=0,this.initList=["flower"],this.pattern=null,this.bodybg=b.BODY_BACKGROUND_COLOR,this.backgroundColor=b.BACKGROUND_COLOR,this.lineColor=b.LINE_COLOR,this.backgroundAlpha=b.BACKGROUND_ALPHA;var a=this._u.getKeys(b.SOURCE_MODES)[0];this.sourceMode=b.SOURCE_MODES[a],this.canvasWidth=500,this.canvasHeight=500,this.midWidth=this.canvasWidth/2,this.midHeight=this.canvasHeight/2,this.maxRadius=Math.sqrt(this.midWidth*this.midWidth+this.midHeight*this.midHeight),this.controlPointRadius=b.CONTROL_POINT_RADIUS,this.editMode=b.EDIT_SHAPE,this.highlightCurve=!1,this.seamlessAnimation=!0,this.fieldFocus=!1,this.settingShelf={toggleCurveColor:this.toggleCurveColor,editMode:this.editMode},this.objList=[],this.objTypes=[],this.selectedObject=0,this.resourceList={},this.backgroundImageExists=!1,this.fillImageExists=!1,this.debugMode=!0,this.initializeCanvas=function(){if(this.canvas=document.getElementById("canvas"),this.context=this.canvas.getContext("2d"),this.bindEvents(),this.build(),this.debugMode===!0){var a=window.getSampleJSON();this.loadData(a,!1)}this.initialized=!0,this.redraw()}};return g.prototype.digest=function(){},g.prototype.build=function(){var a=this;f.each(f.range(0,this.initList.length),function(c){"flower"===a.initList[c]&&(a.objList.push(new d(a,b.DEFAULT_RAYS,1,a.canvasHeight/b.DEFAULT_INNER_RADIUS_SCALAR,a.canvasHeight/b.DEFAULT_OUTER_RADIUS_SCALAR,e.create(a.midWidth,a.midHeight))),a.objTypes.push(["flower",b.DEFAULT_RAYS,1]))}),this.initFrame()},g.prototype.redraw=function(){if(this.initialized){if(this.context.save(),this.context.setTransform(1,0,0,1,0,0),this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.context.restore(),this.context.strokeStyle="#"+this.lineColor,this.backgroundImageExists)this.context.drawImage(this.backgroundImage,0,0,this.canvasWidth,this.canvasHeight);else{var a=f.toRGB(this.backgroundColor);this.context.fillStyle="rgba("+a[0]+", "+a[1]+", "+a[2]+", "+this.backgroundAlpha+")",this.context.fillRect(0,0,this.canvasWidth,this.canvasHeight)}var c=this;f.each(this.objList,function(a){c.context.save(),a.transform(),a.draw(),c.context.restore()}),this.editMode===b.EDIT_SHAPE&&this.objList[c.selectedObject].drawShapePoints(),this.editMode===b.EDIT_TRANSFORM&&this.objList[c.selectedObject].drawTransformPoints()}},g}({},constants,util,PetalFlower,Vector),FillImage=function(a,b,c){var b=b,c=c,d=function(a,b,c){this.src=a,this.page=b,this.label=c,this.image=new Image,this.image.onload=function(){window.kit.fillImageExists=!0,window.kit.redraw()},this.image.src=this.src};return d.prototype.draw=function(a,d){var e=d.kit,f=b.getPolarPoint(b.create(0,0),e.maxRadius,d.firstInnerAngle/d.radialAccent+a.rotation),g=b.getPolarPoint(b.create(0,0),e.maxRadius,a.rotation),h=document.createElement("canvas");h.width=e.canvasWidth,h.height=e.canvasHeight;var i=h.getContext("2d");i.setTransform(1,0,0,1,d.center.x,d.center.y),i.save(),i.beginPath(),i.moveTo(0,0),i.lineTo(f.x,f.y),i.lineTo(g.x,g.y),i.closePath(),i.clip(),i.drawImage(this.image,-e.midWidth,-e.midHeight,e.canvasWidth,e.canvasHeight),i.stroke(),i.restore(),i.save();var j=b.reflectMatrix(a.rotation);i.setTransform(j[0],j[1],j[2],j[3],d.center.x,d.center.y),i.beginPath(),i.moveTo(0,0),i.lineTo(f.x,f.y),i.lineTo(g.x,g.y),i.closePath(),i.clip(),i.drawImage(this.image,-e.midWidth,-e.midHeight,e.canvasWidth,e.canvasHeight),i.stroke(),i.restore(),e.context.save(),e.context.translate(-d.center.x,-d.center.y);for(var k=0;k<d.petalCount;k++){var l=e.getRotationMatrix(c.TWOPI/d.petalCount);e.context.transform(l[0],l[1],l[2],l[3],d.center.x,d.center.y),e.context.translate(-d.center.x,-d.center.y),e.context.drawImage(h,0,0)}e.context.restore()},d}({},Vector,constants),canvasEvents=function(a,b,c,d,e,f){var g=b,c=c,d=d,h=e,f=f;return g.prototype.bindEvents=function(){this.canvas.addEventListener("touchstart",this.startDrag,!1),this.canvas.addEventListener("touchend",this.endDrag,!1),this.canvas.addEventListener("touchmove",this.move,!1),this.canvas.addEventListener("mousedown",this.startDrag,!1),this.canvas.addEventListener("mouseup",this.endDrag,!1),this.canvas.addEventListener("mousemove",this.move,!1)},g.prototype.startDrag=function(a){var b=window.kit;if(b.animationMode!==!0){var e=h.getPosition(a,b.canvas),f=b.objList[b.selectedObject];b.editMode===d.EDIT_SHAPE?h.each(f.shapePoints,function(a){var c=f.reverseTransformPoint(e);return a.mouseInside(c)?(a.inDrag=!0,b.canvasMode="cpDrag",void b.redraw()):void 0}):b.editMode===d.EDIT_TRANSFORM&&h.each(f.transformPoints,function(a){var d;return 2!==a.index?(d=c.create(e.x-f.center.x,e.y-f.center.y),d=c.rotate(0,0,d,-f.rotation)):(f.lastScale=f.scale,d=c.create(e.x-f.center.x,e.y-f.center.y)),a.mouseInside(d)?(a.inDrag=!0,b.canvasMode="cpDrag",void b.redraw()):void 0})}},g.prototype.endDrag=function(a){var b=window.kit;if(b.animationMode!==!0){b.canvasMode="static",b.position=h.getPosition(a,b.canvas);var c=b.objList[b.selectedObject];b.editMode===d.EDIT_SHAPE?h.each(c.shapePoints,function(a){a.inDrag===!0&&(a.inDrag=!1,b.redraw())}):b.editMode===d.EDIT_TRANSFORM&&h.each(c.transformPoints,function(a){a.inDrag===!0&&(a.inDrag=!1,2===a.index&&(a.x=c.scaleDistance),b.redraw())}),b.getState(),b.digest()}},g.prototype.move=function(a){var b=window.kit;if("cpDrag"===b.canvasMode&&b.animationMode!==!0){var e=b.objList[b.selectedObject],g=h.getPosition(a,b.canvas),i=e.reverseTransformPoint(g),j=0;b.editMode===b.constants.EDIT_SHAPE?h.each(e.shapePoints,function(a){if(a.inDrag){var c=new f(b,h.reduceSig(i.x,d.MAX_CP_SIGS),h.reduceSig(i.y,d.MAX_CP_SIGS),e,j);return c.inDrag=!0,e.updatePetal(j,c),void b.redraw()}j++}):b.editMode===b.constants.EDIT_TRANSFORM&&h.each(e.transformPoints,function(a){if(a.inDrag){if(0===j)e.center=g;else if(1===j){var d=c.create(g.x-e.center.x,g.y-e.center.y),f=c.getRadians(c.create(0,0),d);b.setRotation(f),b._u.debugConsole(f)}else if(2===j){var h=g.x-e.center.x;e.setScale(h),a.x=h}return void b.redraw()}j++})}},g.prototype.constrain=function(a){a.x<0?a.x=0:a.x>this.canvasWidth&&(a.x=this.canvasWidth),a.y<0?a.y=0:a.y>this.canvasHeight&&(a.y=this.canvasHeight)},g}({},core,Vector,constants,util,CPoint),sceneEvents=function(a,b,c,d,e,f,g){var h=b,c=c,i=d,e=e,f=f,g=g;return h.prototype.sceneLoop=function(){if(!this.animationMode||this.keyFrames.length<2)return this.stopScene(),void this.digest();this.sceneMode===c.SCENE_GIF?this.delta+=this.gifFramerate:this.delta=i.msTime()-this.segmentStartTime;var a=i.msTime();if(0===this.segment&&this.delta>=this.pauseTime)this.segment=1,this.delta=0,this.segmentStartTime=i.msTime();else if(0!==this.segment)if(this.delta>1e3*this.keyFrames[this.segment-1].timing)if(this.segment===this.keyFrames.length-1&&this.seamlessAnimation===!1)this.segment=0,this.setState(),this.segment=1,this.delta=0,this.segmentStartTime=i.msTime();else if(this.segment<this.keyFrames.length)this.setState(),this.segment++,this.sceneMode===this.GIF?this.delta=0:this.segmentStartTime=i.msTime();else{if(this.sceneMode===c.SCENE_GIF)return void this.gifComplete();this.segment=0,this.setState(),this.segmentStartTime=i.msTime()}else this.updateSegment(this.delta);if(this.digest(),this.sceneMode===c.SCENE_GIF)this.encoder.addFrame(this.context),setTimeout(function(){window.kit.sceneLoop()},.01);else{var b=i.msTime()-a;setTimeout(function(){window.kit.sceneLoop()},Math.max(0,window.kit.frameDelay-b))}},h.prototype.updateSegment=function(a){var b=this.segment;this.segment===this.keyFrames.length&&(b=0);var c=a/(1e3*this.keyFrames[b].timing),d=0,e=this;i.each(this.keyFrames[b].obj,function(a){var b=0,h=[],j=e.keyFrames[e.segment-1].obj[d];i.each(a.shapePoints,function(a){var g=j.shapePoints[b].x*(1-c)+a.x*c,i=j.shapePoints[b].y*(1-c)+a.y*c,k=new f(e,g,i,e.objList[d],b);h.push(k),b++});var k={shapePoints:h},l=j.rotation,m=a.rotation,n=m-l;Math.abs(n)>Math.PI&&(0>n?m+=2*Math.PI:l+=2*Math.PI),k.rotation=(l*(1-c)+m*c)%360,k.position=g.create(j.position.x*(1-c)+a.position.x*c,j.position.y*(1-c)+a.position.y*c),k.scale=j.scale*(1-c)+a.scale*c,e.objList[d].setState(k),d++})},h.prototype.segmentLoop=function(){if(!this.animationMode||0===this.segment)return this.setState(),void this.digest();var a=i.msTime()-this.loopStartTime-this.pauseTime;if(0>a)0!==this.setTime&&(this.segment--,this.setState(),this.segment++,this.setTime=0);else if(a>1e3*this.keyFrames[this.segment].timing)a>1e3*this.keyFrames[this.segment].timing+this.pauseTime?(this.loopStartTime=i.msTime(),this.segment--,this.setState(),this.segment++,this.setTime=0):this.setTime!==1e3*this.keyFrames[this.segment].timing&&(this.setState(),this.setTime=1e3*this.keyFrames[this.segment].timing);else{var b=a/(1e3*this.keyFrames[this.segment].timing),c=0,d=this;i.each(this.keyFrames[this.segment].obj,function(a){var e=0,h=[];i.each(a.shapePoints,function(a){var g=d.keyFrames[d.segment-1].obj[c].shapePoints[e].x*(1-b)+a.x*b,i=d.keyFrames[d.segment-1].obj[c].shapePoints[e].y*(1-b)+a.y*b,j=new f(d,g,i,d.objList[c],e);h.push(j),e++});var j={shapePoints:h},k=d.keyFrames[d.segment-1].obj[c],l=k.rotation,m=a.rotation,n=m-l;Math.abs(n)>180&&(0>n?m+=360:l+=360),j.rotation=(l*(1-b)+m*b)%360,j.position=g.create(k.center.x*(1-b)+a.center.x*b,k.center.y*(1-b)+a.center.y*b),j.scale=k.scale*(1-b)+a.scale*b,d.objList[c].setState(j),c++})}setTimeout(function(){window.kit.segmentLoop()},window.kit.frameDelay)},h.prototype.initFrame=function(){if(this.keyFrames[this.segment]={},this.keyFrames[this.segment].obj=[],this.segment>0){this.keyFrames[this.segment].timing=this.keyFrames[this.segment-1].timing;for(var a=0;a<this.objList;a++)this.keyFrames[this.segment].obj[a].rotation=this.keyFrames[this.segment-1].obj[a].rotation,this.keyFrames[this.segment].obj[a].center=this.keyFrames[this.segment-1].obj[a].center,this.keyFrames[this.segment].obj[a].scale=this.keyFrames[this.segment-1].obj[a].scale}else{this.keyFrames[this.segment].timing=c.DEFAULT_LENGTH;for(var b=0;b<this.objList;b++)this.keyFrames[this.segment].obj[b].rotation=0,this.keyFrames[this.segment].obj[b].position=new g(this.objList[0].center.x,this.objList[0].center.y),this.keyFrames[this.segment].obj[b].scale=1}this.storeFrame()},h.prototype.clearScene=function(){this.objList=[],this.objTypes=[],this.resourceList={},this.backgroundImageExists=!1,this.fillImageExists=!1,this.keyFrames=[],this.segment=0,this.objList.push(new e(this,c.DEFAULT_RAYS,1,this.canvasHeight/c.DEFAULT_INNER_RADIUS_SCALAR,this.canvasHeight/c.DEFAULT_OUTER_RADIUS_SCALAR,g.create(this.midWidth,this.midHeight))),this.objTypes.push(["flower",c.DEFAULT_RAYS,1]),this.selectedObject=0,this.initFrame(),this.redraw(),this.digest()},h.prototype.storeFrame=function(){for(var a=0;a<this.objList.length;a++)this.keyFrames[this.segment].obj[a]=this.objList[a].getState();this.objList[this.selectedObject].rotation},h.prototype.removeKeyframe=function(){this.keyFrames.length<2||(i.removeArrayEntry(this.keyFrames,this.segment),this.segment===this.keyFrames.length&&this.segment--,this.setState(),this.redraw(),this.digest())},h.prototype.removeLast=function(){this.keyFrames.length<2||(i.removeArrayEntry(this.keyFrames,this.keyFrames.length-1),this.segment===this.keyFrames.length&&this.segment--,this.setState(),this.redraw(),this.digest())},h.prototype.gifInit=function(){this.encoder.setRepeat(-1),this.encoder.setDelay(this.gifFramerate),this.encoder.setSize(this.canvasWidth,this.canvasHeight),this.encoder.start(),this.sceneMode=c.SCENE_GIF,this.loopInit(),this.redraw()},h.prototype.gifComplete=function(){this.encoder.finish();var a=this.encoder.stream().getData(),b="data:image/gif;base64,"+window.encode64(a);window.open(b,"_blank"),this.sceneMode=c.SCENE_NORMAL,this.stopScene()},h.prototype.loopInit=function(){this.animationMode=!0,this.segment=0,this.loopStartTime=i.msTime(),this.segmentStartTime=this.loopStartTime,this.setTempModes(c.EDIT_NONE,!1)},h.prototype.stopScene=function(){this.restoreModes(),this.sceneReset()},h.prototype.sceneReset=function(){this.animationMode=!1,this.segment=0,this.setState(),this.redraw()},h.prototype.playSegment=function(){h.keyFrames.length<2||(h.animationMode=!0,0!==h.segment&&h.segment--,h.setState(),h.segment++,h.setTime=0,h.loopStartTime=(new Date).getTime(),h.segmentLoop())},h.prototype.setState=function(){for(var a=0;a<this.objList.length;a++)this.objList[a].setState(this.keyFrames[this.segment].obj[a])},h.prototype.selectFirst=function(){this.segment=0,this.setState()},h.prototype.selectPrev=function(){if(this.segment>0){this.segment--;for(var a=0;a<this.objList.length;a++)this.objList[a].setState(this.keyFrames[this.segment].obj[a])}},h.prototype.selectNext=function(){this.segment++,this.segment>=this.keyFrames.length?this.initFrame():this.setState()},h.prototype.selectLast=function(){this.segment=this.keyFrames.length-1,this.setState()},h.prototype.getSegment=function(){return this.initialized?this.animationMode?(this.segment+this.keyFrames.length-1)%this.keyFrames.length:this.segment:0},h}({},core,constants,util,PetalFlower,CPoint,Vector),objectEvents=function(a,b,c,d,e,f,g){var h=b,c=c,i=d,e=e,f=f,g=g;return h.prototype.setState=function(){for(var a=0;a<this.objList.length;a++)this.objList[a].setState(this.keyFrames[this.segment].obj[a])},h.prototype.getState=function(){for(var a=0;a<this.objList.length;a++)this.keyFrames[this.segment].obj[a]=this.objList[a].getState();this.keyFrames[this.segment].timing=parseFloat(document.getElementById("length").value)},h.prototype.getRotation=function(){var a=this.keyFrames[this.segment].obj[this.selectedObject].rotation/this.constants.TWOPIDIV360;return Math.floor(100*a)/100},h.prototype.getRotationMatrix=function(a){var b=Math.cos(a),c=Math.sin(a);return[b,c,-c,b,0,0]},h.prototype.setRotation=function(a){this.objList[this.selectedObject].rotation=a,this.keyFrames[this.segment].obj[this.selectedObject].rotation=a,this.objList[this.selectedObject].allPetals=[],this.objList[this.selectedObject].createPetals(),this.redraw()},h.prototype.addFillImage=function(a){this.fillImage=new g(a),this.resourceList.fillImageSource=a},h.prototype.addBackgroundImage=function(a){this.backgroundImage=new Image,this.backgroundImage.onload=function(){window.kit.backgroundImageExists=!0,window.kit.redraw()},this.backgroundImage.src=a,this.resourceList.backgroundImageSource=a},h.prototype.updatePetalCount=function(a){var b=this.objList[this.selectedObject];b instanceof f&&(this.objList[this.selectedObject]=new f(this,a,b.radialAccent,this.canvasHeight/c.DEFAULT_INNER_RADIUS_SCALAR,this.canvasHeight/c.DEFAULT_OUTER_RADIUS_SCALAR,e.create(this.midWidth,this.midHeight)),this.objTypes[this.selectedObject][1]=a,this.objList[this.selectedObject].updateRadialPoint(),this.setState(),this.redraw())},h.prototype.updateRadialAccent=function(a){this.objTypes[this.selectedObject][2]=a;var b=this.objList[this.selectedObject];a>0&&a<b.petalCount&&(b.accentRadialPoint(a),this.setState(),this.redraw())},h.prototype.selectObject=function(a){a=parseFloat(a),this.selectedObject!==a&&a<this.objList.length&&a<this.constants.MAX_OBJECTS&&a>=0&&(this.selectedObject=a,this.redraw(),this.digest())},h.prototype.addObject=function(){if(!(this.objList.length>=c.MAX_OBJECTS)){this.objList.push(new f(this,c.DEFAULT_RAYS,1,this.canvasHeight/c.DEFAULT_INNER_RADIUS_SCALAR,this.canvasHeight/c.DEFAULT_OUTER_RADIUS_SCALAR,e.create(this.midWidth,this.midHeight))),this.objTypes.push(["flower",c.DEFAULT_RAYS,1]);for(var a=0;a<this.keyFrames.length;a++)this.keyFrames[a].obj[this.objList.length-1]=this.objList[this.objList.length-1].getState(),this.keyFrames[a].obj[this.objList.length-1].timing=document.getElementById("length").value;var b=this.objList.length-1;this.selectedObject=b,this.redraw(),this.digest()}},h.prototype.removeObject=function(){if(!(this.objList.length<2)){i.removeArrayEntry(this.objList,this.selectedObject),i.removeArrayEntry(this.objTypes,this.selectedObject);var a=this;i.each(this.keyFrames,function(b){i.removeArrayEntry(b.obj,a.selectedObject)}),this.selectedObject===this.objList.length&&this.selectedObject--,this.redraw(),this.digest()}},h.prototype.getImage=function(){this.setTempModes(c.EDIT_NONE,!1),this.redraw(),window.open(this.canvas.toDataURL("image/png")),this.restoreModes(),this.redraw()},h.prototype.setAlpha=function(a){a=i.parseFloatOrDefault(a,1),this.backgroundAlpha=a>1?1:0>a?0:a,this.redraw()},h}({},core,constants,util,Vector,PetalFlower,FillImage),settingsEvents=function(a,b,c,d,e,f){var g=b,c=c,h=d,e=e,f=f;return g.prototype.getSettings=function(){return{backgroundColor:this.backgroundColor,backgroundAlpha:this.backgroundAlpha,lineColor:this.lineColor,sourceMode:this.sourceMode,seamlessAnimation:this.seamlessAnimation}},g.prototype.loadData=function(a){this.objList=[],this.objTypes=[],this.resourceList=a[1],this.objTypes=a[2],this.keyFrames=a[3],this.objList=[];for(var b=0;b<this.objTypes.length;b++)"flower"===this.objTypes[b][0]&&this.objList.push(new e(this,this.objTypes[b][1],this.objTypes[b][2],this.canvasHeight/c.DEFAULT_INNER_RADIUS_SCALAR,this.canvasHeight/c.DEFAULT_OUTER_RADIUS_SCALAR,f.create(this.midWidth,this.midHeight)));this.options=a[0],this.backgroundColor=h.exists(this.options.backgroundColor)?this.options.backgroundColor:c.BACKGROUND_COLOR,this.backgroundAlpha=h.exists(this.options.backgroundAlpha)?this.options.backgroundAlpha:c.BACKGROUND_ALPHA,this.lineColor=h.exists(this.options.lineColor)?this.options.lineColor:c.LINE_COLOR,this.currentSelector="bg-color",window.setColor("#"+this.backgroundColor),this.currentSelector="line-color",window.setColor("#"+this.lineColor),this.sourceMode=h.exists(this.options.sourceMode)?this.options.sourceMode:c.SOURCE_MODE,this.seamlessAnimation=h.exists(this.options.seamlessAnimation)?this.options.seamlessAnimation:!0,this.backgroundImageExists=!1,this.fillImageExists=!1,"string"==typeof this.resourceList.backgroundImageSource&&this.addBackgroundImage(this.resourceList.backgroundImageSource),"string"==typeof this.resourceList.fillImageSource&&this.addFillImage(this.resourceList.fillImageSource),this.selectedObject=0,this.segment=0,this.setState()},g.prototype.setTempModes=function(a,b){this.settingShelf={editMode:this.editMode,toggleCurveColor:this.toggleCurveColor},this.editMode=a,this.toggleCurveColor=b},g.prototype.restoreModes=function(){this.editMode=this.settingShelf.editMode,this.toggleCurveColor=this.settingShelf.toggleCurveColor},g}({},core,constants,util,PetalFlower,Vector),src_app=function(a,b){var c=b,d=function(){window.kit=new c,initKeyboard(),c.encoder=new GIFEncoder};return"complete"===document.readyState?d():window.addEventListener("load",d,!1),window.kit}({},core,constants,Vector,CPoint,Transform,FillImage,PetalFlower,canvasEvents,sceneEvents,objectEvents,settingsEvents);
//# sourceMappingURL=cKit.map