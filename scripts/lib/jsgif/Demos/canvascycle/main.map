{"version":3,"file":"main.js","sources":["../../../../../../build/scripts/lib/jsgif/Demos/canvascycle/main.js"],"names":["encoder","GIFEncoder","setRepeat","setDelay","start","FrameCount","visible","CanvasCycle","cookie","CookieTree","ctx","imageData","clock","inGame","bmp","globalTimeStart","Date","getTime","inited","optTween","winSize","globalBrightness","lastBrightness","sceneIdx","highlightColor","defaultMaxVolume","settings","showOptions","targetFPS","zoomFull","blendShiftEnabled","speedAdjust","sound","contentSize","width","optionsWidth","height","scale","init","this","$","style","display","handleResize","pal_disp","idx","len","div","document","createElement","_idx","id","className","onmouseover","onmouseout","appendChild","initialSceneIdx","html","scenes","length","scene","name","title","innerHTML","prefs","get","toggleOptions","setRate","setZoom","setSpeed","setBlendShift","setSound","location","href","match","parseInt","RegExp","$1","loadImage","jumpScene","dir","selectedIndex","switchScene","menu","stopSceneAudio","options","value","ua","mobile","clearRect","fillStyle","fillRect","TweenManager","removeAll","category","tween","target","newSceneName","duration","Math","floor","mode","algo","props","onTweenUpdate","onTweenComplete","loading","left","top","show","url","scr","type","src","getElementsByTagName","processImage","img","hide","Bitmap","optimize","canvas","getContext","createImageData","getImageData","animate","startSceneAudio","colors","palette","clr","backgroundColor","red","green","blue","current","cycle","baseColors","GetTickCount","Color","burnOut","render","lastHighlightColor","putImageData","logic","count","addFrame","console","log","setTimeout","scaleAnimate","totalNativeWidth","maxScaleX","totalNativeHeight","maxScaleY","maxScale","min","abs","sty","webkit","webkitTransform","ff","MozTransform","op","OTransform","transform","marginRight","repositionContainer","getInnerWindowSize","saveSettings","set","save","window","Audio","audioTrack","pause","e","ext","track","volume","loop","autobuffer","autoplay","addEventListener","play","maxVolume","iphone","ipad","currentTime","load","startValue","endValue","opacity","enabled","setClass","rate","speed","CC"],"mappings":"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","sourcesContent":["// Color Cycling in HTML5 Canvas\n// BlendShift Technology conceived, designed and coded by Joseph Huckaby\n// Copyright (c) 2001-2002, 2010 Joseph Huckaby.\n// Released under the LGPL v3.0: http://www.opensource.org/licenses/lgpl-3.0.html\n\nvar encoder = new GIFEncoder();\n  encoder.setRepeat(0); //auto-loop\n  encoder.setDelay(1000/40);\n  encoder.start();\n\nFrameCount.visible = false;\n\nvar CanvasCycle = {\n\t\n\tcookie: new CookieTree(),\n\tctx: null,\n\timageData: null,\n\tclock: 0,\n\tinGame: false,\n\tbmp: null,\n\tglobalTimeStart: (new Date()).getTime(),\n\tinited: false,\n\toptTween: null,\n\twinSize: null,\n\tglobalBrightness: 1.0,\n\tlastBrightness: 0,\n\tsceneIdx: -1,\n\thighlightColor: -1,\n\tdefaultMaxVolume: 0.5,\n\t\n\tsettings: {\n\t\tshowOptions: false,\n\t\ttargetFPS: 60,\n\t\tzoomFull: false,\n\t\tblendShiftEnabled: true,\n\t\tspeedAdjust: 1.0,\n\t\tsound: true\n\t},\n\n\tcontentSize: {\n\t\twidth: 640,\n\t\toptionsWidth: 0,\n\t\theight: 480 + 40,\n\t\tscale: 1.0\n\t},\n\n\tinit: function() {\n\t\t// called when DOM is ready\n\t\tif (!this.inited) {\n\t\t\tthis.inited = true;\n\t\t\t$('container').style.display = 'block';\n\t\t\t$('d_options').style.display = 'none';\n\t\t\n\t\t\tFrameCount.init();\n\t\t\tthis.handleResize();\n\t\t\n\t\t\tvar pal_disp = $('palette_display');\n\t\t\tfor (var idx = 0, len = 256; idx < len; idx++) {\n\t\t\t\tvar div = document.createElement('div');\n\t\t\t\tdiv._idx = idx;\n\t\t\t\tdiv.id = 'pal_' + idx;\n\t\t\t\tdiv.className = 'palette_color';\n\t\t\t\tdiv.onmouseover = function() { CanvasCycle.highlightColor = this._idx; };\n\t\t\t\tdiv.onmouseout = function() { CanvasCycle.highlightColor = -1; };\n\t\t\t\tpal_disp.appendChild( div );\n\t\t\t}\n\t\t\tvar div = document.createElement('div');\n\t\t\tdiv.className = 'clear';\n\t\t\tpal_disp.appendChild( div );\n\t\t\n\t\t\t// pick starting scene\n\t\t\t// var initialSceneIdx = Math.floor( Math.random() * scenes.length );\n\t\t\tvar initialSceneIdx = 0;\n\t\t\t\n\t\t\t// populate scene menu\n\t\t\tvar html = '';\n\t\t\thtml += '<select id=\"fe_scene\" onChange=\"CanvasCycle.switchScene(this)\">';\n\t\t\tfor (var idx = 0, len = scenes.length; idx < len; idx++) {\n\t\t\t\tvar scene = scenes[idx];\n\t\t\t\thtml += '<option value=\"'+scene.name+'\" '+((idx == initialSceneIdx) ? ' selected=\"selected\"' : '')+'>'+scene.title+'</option>';\n\t\t\t}\n\t\t\thtml += '</select>';\n\t\t\t$('d_scene_selector').innerHTML = html;\n\t\t\t\n\t\t\t// read prefs from cookie\n\t\t\tvar prefs = this.cookie.get('settings');\n\t\t\tif (prefs) {\n\t\t\t\tif (prefs.showOptions) this.toggleOptions();\n\t\t\t\tthis.setRate( prefs.targetFPS );\n\t\t\t\tthis.setZoom( prefs.zoomFull );\n\t\t\t\tthis.setSpeed( prefs.speedAdjust );\n\t\t\t\tthis.setBlendShift( prefs.blendShiftEnabled );\n\t\t\t\tthis.setSound( prefs.sound );\n\t\t\t}\n\t\t\t\n\t\t\t// allow query to control sound\n\t\t\tif (location.href.match(/\\bsound\\=(\\d+)/)) {\n\t\t\t\tthis.setSound( !!parseInt(RegExp.$1, 10) );\n\t\t\t}\n\t\t\n\t\t\tthis.loadImage( scenes[initialSceneIdx].name );\n\t\t\tthis.sceneIdx = initialSceneIdx;\n\t\t}\n\t},\n\n\tjumpScene: function(dir) {\n\t\t// next or prev scene\n\t\tthis.sceneIdx += dir;\n\t\tif (this.sceneIdx >= scenes.length) this.sceneIdx = 0;\n\t\telse if (this.sceneIdx < 0) this.sceneIdx = scenes.length - 1;\n\t\t$('fe_scene').selectedIndex = this.sceneIdx;\n\t\tthis.switchScene( $('fe_scene') );\n\t},\n\n\tswitchScene: function(menu) {\n\t\t// switch to new scene (grab menu selection)\n\t\tthis.stopSceneAudio();\n\t\t\n\t\tvar name = menu.options[menu.selectedIndex].value;\n\t\tthis.sceneIdx = menu.selectedIndex;\n\t\t\n\t\tif (ua.mobile) {\n\t\t\t// no transitions on mobile devices, just switch as fast as possible\n\t\t\tthis.inGame = false;\n\t\t\t\n\t\t\tthis.ctx.clearRect(0, 0, this.bmp.width, this.bmp.height);\n\t\t\tthis.ctx.fillStyle = \"rgb(0,0,0)\";\n\t\t\tthis.ctx.fillRect (0, 0, this.bmp.width, this.bmp.height);\n\t\t\t\n\t\t\tCanvasCycle.globalBrightness = 1.0;\n\t\t\tCanvasCycle.loadImage( name );\n\t\t}\n\t\telse {\n\t\t\tTweenManager.removeAll({ category: 'scenefade' });\n\t\t\tTweenManager.tween({\n\t\t\t\ttarget: { value: this.globalBrightness, newSceneName: name },\n\t\t\t\tduration: Math.floor( this.settings.targetFPS / 2 ),\n\t\t\t\tmode: 'EaseInOut',\n\t\t\t\talgo: 'Quadratic',\n\t\t\t\tprops: { value: 0.0 },\n\t\t\t\tonTweenUpdate: function(tween) {\n\t\t\t\t\tCanvasCycle.globalBrightness = tween.target.value;\n\t\t\t\t},\n\t\t\t\tonTweenComplete: function(tween) {\n\t\t\t\t\tCanvasCycle.loadImage( tween.target.newSceneName );\n\t\t\t\t},\n\t\t\t\tcategory: 'scenefade'\n\t\t\t});\n\t\t}\n\t},\n\n\tloadImage: function(name) {\n\t\t// load image JSON from the server\n\t\tvar loading = $('d_loading');\n\t\tloading.style.left = '' + Math.floor( ((this.contentSize.width * this.contentSize.scale) / 2) - 16 ) + 'px';\n\t\tloading.style.top = '' + Math.floor( ((this.contentSize.height * this.contentSize.scale) / 2) - 16 ) + 'px';\n\t\tloading.show();\n\t\t\n\t\tvar url = 'image.php?file='+name+'&callback=CanvasCycle.processImage';\n\t\tvar scr = document.createElement('SCRIPT');\n\t\tscr.type = 'text/javascript';\n\t\tscr.src = url;\n\t\tdocument.getElementsByTagName('HEAD')[0].appendChild(scr);\n\t},\n\n\tprocessImage: function(img) {\n\t\t// initialize, receive image data from server\n\t\t$('d_loading').hide();\n\t\t\n\t\tthis.bmp = new Bitmap(img);\n\t\tthis.bmp.optimize();\n\t\n\t\t// $('d_debug').innerHTML = img.filename;\n\t\t\n\t\tvar canvas = $('mycanvas');\n\t\tif (!canvas.getContext) return; // no canvas support\n\t\n\t\tif (!this.ctx) this.ctx = canvas.getContext('2d');\n\t\tthis.ctx.clearRect(0, 0, this.bmp.width, this.bmp.height);\n\t\tthis.ctx.fillStyle = \"rgb(0,0,0)\";\n\t\tthis.ctx.fillRect (0, 0, this.bmp.width, this.bmp.height);\n\t\n\t\tif (!this.imageData) {\n\t\t\tif (this.ctx.createImageData) {\n\t\t\t\tthis.imageData = this.ctx.createImageData( this.bmp.width, this.bmp.height );\n\t\t\t}\n\t\t\telse if (this.ctx.getImageData) {\n\t\t\t\tthis.imageData = this.ctx.getImageData( 0, 0, this.bmp.width, this.bmp.height );\n\t\t\t}\n\t\t\telse return; // no canvas data support\n\t\t}\n\t\t\n\t\tif (ua.mobile) {\n\t\t\t// no transition on mobile devices\n\t\t\tthis.globalBrightness = 1.0;\n\t\t}\n\t\telse {\n\t\t\tthis.globalBrightness = 0.0;\n\t\t\tTweenManager.removeAll({ category: 'scenefade' });\n\t\t\tTweenManager.tween({\n\t\t\t\ttarget: { value: 0 },\n\t\t\t\tduration: Math.floor( this.settings.targetFPS / 2 ),\n\t\t\t\tmode: 'EaseInOut',\n\t\t\t\talgo: 'Quadratic',\n\t\t\t\tprops: { value: 1.0 },\n\t\t\t\tonTweenUpdate: function(tween) {\n\t\t\t\t\tCanvasCycle.globalBrightness = tween.target.value;\n\t\t\t\t},\n\t\t\t\tcategory: 'scenefade'\n\t\t\t});\n\t\t}\n\t\n\t\tif (!this.inGame) {\n\t\t\tthis.inGame = true;\n\t\t\tthis.animate();\n\t\t}\n\t\t\n\t\tthis.startSceneAudio();\n\t},\n\n\tanimate: function() {\n\t\t// animate one frame. and schedule next\n\t\tif (this.inGame) {\n\t\t\tvar colors = this.bmp.palette.colors;\n\t\n\t\t\tif (this.settings.showOptions) {\n\t\t\t\tfor (var idx = 0, len = colors.length; idx < len; idx++) {\n\t\t\t\t\tvar clr = colors[idx];\n\t\t\t\t\tvar div = $('pal_'+idx);\n\t\t\t\t\tdiv.style.backgroundColor = 'rgb(' + clr.red + ',' + clr.green + ',' + clr.blue + ')';\n\t\t\t\t}\n\t\t\n\t\t\t\tif (this.clock % this.settings.targetFPS == 0) $('d_debug').innerHTML = 'FPS: ' + FrameCount.current;\n\t\t\t}\n\t\n\t\t\tthis.bmp.palette.cycle( this.bmp.palette.baseColors, GetTickCount(), this.settings.speedAdjust, this.settings.blendShiftEnabled );\n\t\t\tif (this.highlightColor > -1) {\n\t\t\t\tthis.bmp.palette.colors[ this.highlightColor ] = new Color(255, 255, 255);\n\t\t\t}\n\t\t\tif (this.globalBrightness < 1.0) {\n\t\t\t\t// bmp.palette.fadeToColor( pureBlack, 1.0 - globalBrightness, 1.0 );\n\t\t\t\tthis.bmp.palette.burnOut( 1.0 - this.globalBrightness, 1.0 );\n\t\t\t}\n\t\t\tthis.bmp.render( this.imageData, (this.lastBrightness == this.globalBrightness) && (this.highlightColor == this.lastHighlightColor) );\n\t\t\tthis.lastBrightness = this.globalBrightness;\n\t\t\tthis.lastHighlightColor = this.highlightColor;\n\t\n\t\t\tthis.ctx.putImageData( this.imageData, 0, 0 );\n\t  \n\t\t\tTweenManager.logic( this.clock );\n\t\t\tthis.clock++;\n\t\t\tFrameCount.count();\n\t\t\t//this.scaleAnimate();\n\t\t\t\n\t\t\t\n\t\t\tif(this.clock > 100 && this.clock < 110){\n\t\t\t  encoder.addFrame(this.ctx);\n\t\t\t  console.log('added frame');\n\t\t\t}\n\t\t\t\n\t\t\t\n\t\t\tif (this.inGame) setTimeout( function() { CanvasCycle.animate(); }, 1000 / this.settings.targetFPS );\n\t\t}\n\t},\n\n\tscaleAnimate: function() {\n\t\t// handle scaling image up or down\n\t\tif (this.settings.zoomFull) {\n\t\t\t// scale up to full size\n\t\t\tvar totalNativeWidth = this.contentSize.width + this.contentSize.optionsWidth;\n\t\t\tvar maxScaleX = (this.winSize.width - 30) / totalNativeWidth;\n\t\t\n\t\t\tvar totalNativeHeight = this.contentSize.height;\n\t\t\tvar maxScaleY = (this.winSize.height - 30) / totalNativeHeight;\n\t\t\n\t\t\tvar maxScale = Math.min( maxScaleX, maxScaleY );\n\t\t\n\t\t\tif (this.contentSize.scale != maxScale) {\n\t\t\t\tthis.contentSize.scale += ((maxScale - this.contentSize.scale) / 8);\n\t\t\t\tif (Math.abs(this.contentSize.scale - maxScale) < 0.001) this.contentSize.scale = maxScale; // close enough\n\t\t\t\n\t\t\t\tvar sty = $('mycanvas').style; \n\t\t\t\n\t\t\t\tif (ua.webkit) sty.webkitTransform = 'translate3d(0px, 0px, 0px) scale('+this.contentSize.scale+')';\n\t\t\t\telse if (ua.ff) sty.MozTransform = 'scale('+this.contentSize.scale+')';\n\t\t\t\telse if (ua.op) sty.OTransform = 'scale('+this.contentSize.scale+')';\n\t\t\t\telse sty.transform = 'scale('+this.contentSize.scale+')';\n\t\t\t\t\n\t\t\t\tsty.marginRight = '' + Math.floor( (this.contentSize.width * this.contentSize.scale) - this.contentSize.width ) + 'px';\n\t\t\t\t$('d_header').style.width = '' + Math.floor(this.contentSize.width * this.contentSize.scale) + 'px';\n\t\t\t\tthis.repositionContainer();\n\t\t\t}\n\t\t}\n\t\telse {\n\t\t\t// scale back down to native\n\t\t\tif (this.contentSize.scale > 1.0) {\n\t\t\t\tthis.contentSize.scale += ((1.0 - this.contentSize.scale) / 8);\n\t\t\t\tif (this.contentSize.scale < 1.001) this.contentSize.scale = 1.0; // close enough\n\t\t\t\n\t\t\t\tvar sty = $('mycanvas').style; \n\t\t\t\n\t\t\t\tif (ua.webkit) sty.webkitTransform = 'translate3d(0px, 0px, 0px) scale('+this.contentSize.scale+')';\n\t\t\t\telse if (ua.ff) sty.MozTransform = 'scale('+this.contentSize.scale+')';\n\t\t\t\telse if (ua.op) sty.OTransform = 'scale('+this.contentSize.scale+')';\n\t\t\t\telse sty.transform = 'scale('+this.contentSize.scale+')';\n\t\t\t\t\n\t\t\t\tsty.marginRight = '' + Math.floor( (this.contentSize.width * this.contentSize.scale) - this.contentSize.width ) + 'px';\n\t\t\t\t$('d_header').style.width = '' + Math.floor(this.contentSize.width * this.contentSize.scale) + 'px';\n\t\t\t\tthis.repositionContainer();\n\t\t\t}\n\t\t}\n\t},\n\t\n\trepositionContainer: function() {\n\t\t// reposition container element based on inner window size\n\t\tvar div = $('container');\n\t\tif (div) {\n\t\t\tthis.winSize = getInnerWindowSize();\n\t\t\tdiv.style.left = '' + Math.floor((this.winSize.width / 2) - (((this.contentSize.width * this.contentSize.scale) + this.contentSize.optionsWidth) / 2)) + 'px';\n\t\t\tdiv.style.top = '' + Math.floor((this.winSize.height / 2) - ((this.contentSize.height * this.contentSize.scale) / 2)) + 'px';\t\t\t\n\t\t}\n\t},\n\n\thandleResize: function() {\n\t\t// called when window resizes\n\t\tthis.repositionContainer();\n\t\tif (this.settings.zoomFull) this.scaleAnimate();\n\t},\n\t\n\tsaveSettings: function() {\n\t\t// save settings in cookie\n\t\tthis.cookie.set( 'settings', this.settings );\n\t\tthis.cookie.save();\n\t},\n\t\n\tstartSceneAudio: function() {\n\t\t// start audio for current scene, if applicable\n\t\tvar scene = scenes[ this.sceneIdx ];\n\t\tif (scene.sound && this.settings.sound && window.Audio) {\n\t\t\tif (this.audioTrack) {\n\t\t\t\ttry { this.audioTrack.pause(); } catch(e) {;}\n\t\t\t}\n\t\t\tTweenManager.removeAll({ category: 'audio' });\n\t\t\t\n\t\t\tvar ext = (ua.ff || ua.op) ? 'ogg' : 'mp3';\n\t\t\tvar track = this.audioTrack = new Audio( 'audio/' + scene.sound + '.' + ext );\n\t\t\ttrack.volume = 0;\n\t\t\ttrack.loop = true;\n\t\t\ttrack.autobuffer = false;\n\t\t\ttrack.autoplay = true;\n\t\t\t\n\t\t\ttrack.addEventListener('canplaythrough', function() {\n\t\t\t\ttrack.play();\n\t\t\t\tTweenManager.tween({\n\t\t\t\t\ttarget: track,\n\t\t\t\t\tduration: Math.floor( CanvasCycle.settings.targetFPS * 2 ),\n\t\t\t\t\tmode: 'EaseOut',\n\t\t\t\t\talgo: 'Linear',\n\t\t\t\t\tprops: { volume: scene.maxVolume || CanvasCycle.defaultMaxVolume },\n\t\t\t\t\tcategory: 'audio'\n\t\t\t\t});\n\t\t\t}, false);\n\t\t\t\n\t\t\tif (ua.iphone || ua.ipad) {\n\t\t\t\t// these may support audio, but just don't invoke events\n\t\t\t\t// try to force it\n\t\t\t\tsetTimeout( function() { track.play(); track.volume = 1.0; }, 1000 );\n\t\t\t}\n\t\t\t\n\t\t\tif (ua.ff || ua.mobile) {\n\t\t\t\t// loop doesn't seem to work on FF or mobile devices, so let's force it\n\t\t\t\ttrack.addEventListener('ended', function() {\n\t\t\t\t\ttrack.currentTime = 0;\n\t\t\t\t\ttrack.play();\n\t\t\t\t}, false);\n\t\t\t}\n\t\t\t\n\t\t\ttrack.load();\n\t\t} // sound enabled and supported\n\t},\n\t\n\tstopSceneAudio: function() {\n\t\t// fade out and stop audio for current scene\n\t\tvar scene = scenes[ this.sceneIdx ];\n\t\tif (scene.sound && this.settings.sound && window.Audio && this.audioTrack) {\n\t\t\tvar track = this.audioTrack;\n\t\t\t\n\t\t\tif (ua.iphone || ua.ipad) {\n\t\t\t\t// no transition here, so just stop sound\n\t\t\t\ttrack.pause();\n\t\t\t}\n\t\t\telse {\n\t\t\t\tTweenManager.removeAll({ category: 'audio' });\n\t\t\t\tTweenManager.tween({\n\t\t\t\t\ttarget: track,\n\t\t\t\t\tduration: Math.floor( CanvasCycle.settings.targetFPS / 2 ),\n\t\t\t\t\tmode: 'EaseOut',\n\t\t\t\t\talgo: 'Linear',\n\t\t\t\t\tprops: { volume: 0 },\n\t\t\t\t\tonTweenComplete: function(tween) {\n\t\t\t\t\t\ttrack.pause();\n\t\t\t\t\t},\n\t\t\t\t\tcategory: 'audio'\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t},\n\n\ttoggleOptions: function() {\n\t\tvar startValue, endValue;\n\t\tTweenManager.removeAll({ category: 'options' });\n\t\n\t\tif (!this.settings.showOptions) {\n\t\t\tstartValue = 0;\n\t\t\tif (this.optTween) startValue = this.optTween.target.value;\n\t\t\tendValue = 1.0;\n\t\t\t$('d_options').style.display = '';\n\t\t\t$('d_options').style.opacity = startValue;\n\t\t\t$('btn_options_toggle').innerHTML = '&#x00AB; Hide Options';\n\t\t}\n\t\telse {\n\t\t\tstartValue = 1.0;\n\t\t\tif (this.optTween) startValue = this.optTween.target.value;\n\t\t\tendValue = 0;\n\t\t\t$('btn_options_toggle').innerHTML = 'Show Options &#x00BB;';\n\t\t}\n\t\n\t\tthis.optTween = TweenManager.tween({\n\t\t\ttarget: { value: startValue },\n\t\t\tduration: Math.floor( this.settings.targetFPS / 3 ),\n\t\t\tmode: 'EaseOut',\n\t\t\talgo: 'Quadratic',\n\t\t\tprops: { value: endValue },\n\t\t\tonTweenUpdate: function(tween) {\n\t\t\t\t// $('d_options').style.left = '' + Math.floor(tween.target.value - 150) + 'px';\n\t\t\t\t$('d_options').style.opacity = tween.target.value;\n\t\t\t\t$('btn_options_toggle').style.left = '' + Math.floor(tween.target.value * 128) + 'px';\n\t\t\t\n\t\t\t\tCanvasCycle.contentSize.optionsWidth = Math.floor( tween.target.value * 150 );\n\t\t\t\tCanvasCycle.handleResize();\n\t\t\t},\n\t\t\tonTweenComplete: function(tween) {\n\t\t\t\tif (tween.target.value == 0) $('d_options').style.display = 'none';\n\t\t\t\tCanvasCycle.optTween = null;\n\t\t\t},\n\t\t\tcategory: 'options'\n\t\t});\n\t\n\t\tthis.settings.showOptions = !this.settings.showOptions;\n\t\tthis.saveSettings();\n\t},\n\n\tsetZoom: function(enabled) {\n\t\tif (enabled != this.settings.zoomFull) {\n\t\t\tthis.settings.zoomFull = enabled;\n\t\t\tthis.saveSettings();\n\t\t\t$('btn_zoom_actual').setClass('selected', !enabled);\n\t\t\t$('btn_zoom_max').setClass('selected', enabled);\n\t\t}\n\t},\n\n\tsetSound: function(enabled) {\n\t\t$('btn_sound_on').setClass('selected', enabled);\n\t\t$('btn_sound_off').setClass('selected', !enabled);\n\t\tthis.settings.sound = enabled;\n\t\t\n\t\tif (this.sceneIdx > -1) {\n\t\t\tif (enabled) {\n\t\t\t\t// enable sound\n\t\t\t\tif (this.audioTrack) this.audioTrack.play();\n\t\t\t\telse this.startSceneAudio();\n\t\t\t}\n\t\t\telse {\n\t\t\t\t// disable sound\n\t\t\t\tif (this.audioTrack) this.audioTrack.pause();\n\t\t\t}\n\t\t}\n\t\t\n\t\tthis.saveSettings();\n\t},\n\n\tsetRate: function(rate) {\n\t\t/* $('btn_rate_30').setClass('selected', rate == 30);\n\t\t$('btn_rate_60').setClass('selected', rate == 60);\n\t\t$('btn_rate_90').setClass('selected', rate == 90); */\n\t\tthis.settings.targetFPS = rate;\n\t\tthis.saveSettings();\n\t},\n\t\n\tsetSpeed: function(speed) {\n\t\t$('btn_speed_025').setClass('selected', speed == 0.25);\n\t\t$('btn_speed_05').setClass('selected', speed == 0.5);\n\t\t$('btn_speed_1').setClass('selected', speed == 1);\n\t\t$('btn_speed_2').setClass('selected', speed == 2);\n\t\t$('btn_speed_4').setClass('selected', speed == 4);\n\t\tthis.settings.speedAdjust = speed;\n\t\tthis.saveSettings();\n\t},\n\n\tsetBlendShift: function(enabled) {\n\t\t$('btn_blendshift_on').setClass('selected', enabled);\n\t\t$('btn_blendshift_off').setClass('selected', !enabled);\n\t\tthis.settings.blendShiftEnabled = enabled;\n\t\tthis.saveSettings();\n\t}\n\n};\n\nvar CC = CanvasCycle; // shortcut\n"]}